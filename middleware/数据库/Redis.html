<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.66" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://Cospk.github.io/vuepress-app/middleware/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis.html"><meta property="og:site_name" content="Golang全栈指南"><meta property="og:title" content="Redis"><meta property="og:description" content="Redis理论 官方网站：https://redis.io/ 中文网站：https://www.redis.net.cn/ 01、Redis 简介 Redis 是完全开源免费的，遵守BSD协议，是一个高性能的key-value数据库。 Redis 特点： Redis支持数据的持久化，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用。 Re..."><meta property="og:type" content="article"><meta property="og:image" content="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/Redis_struct.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-03-18T03:55:25.000Z"><meta property="article:author" content="xiaoxie"><meta property="article:tag" content="db"><meta property="article:published_time" content="2020-01-01T00:00:00.000Z"><meta property="article:modified_time" content="2025-03-18T03:55:25.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Redis","image":["https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/Redis_struct.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/Redis-RDB.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/Redis_RDBConf.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/Redis_AOFConf.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/Redis_Sentinel.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/Redis_cluster.png"],"datePublished":"2020-01-01T00:00:00.000Z","dateModified":"2025-03-18T03:55:25.000Z","author":[{"@type":"Person","name":"xiaoxie"}]}</script><link rel="icon" href="/vuepress-app/favicon.svg"><title>Redis | Golang全栈指南</title><meta name="description" content="Redis理论 官方网站：https://redis.io/ 中文网站：https://www.redis.net.cn/ 01、Redis 简介 Redis 是完全开源免费的，遵守BSD协议，是一个高性能的key-value数据库。 Redis 特点： Redis支持数据的持久化，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用。 Re...">
    <link rel="preload" href="/vuepress-app/assets/style-BU0LSV_n.css" as="style"><link rel="stylesheet" href="/vuepress-app/assets/style-BU0LSV_n.css">
    <link rel="modulepreload" href="/vuepress-app/assets/app-CG6bgqhH.js"><link rel="modulepreload" href="/vuepress-app/assets/Redis.html-BuDd1cTn.js"><link rel="modulepreload" href="/vuepress-app/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/vuepress-app/assets/index.html-DJGt4d0p.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/portfolio.html-BD8UVD4-.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/0.算法.html-QeR9x9qz.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/1.设计模式.html-DVyQUrut.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/git 规范.html-CzexekNk.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/git.html-032anuEx.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/markdown.html-BTFsPn_p.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/好物分享.html-M9qOfCFk.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-Btn-wody.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-BWC3dOv-.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/网络基础.html-DEdgCfKl.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/0.use.html-CB71nnRu.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/1.howWork.html-BFvYNmDk.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-B-LmUlK0.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-DyKMi0yE.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-COjixKZs.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/常用包大全.html-CpegrmsP.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/0.golang.html-D4nJnjAZ.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/1.grammer.html-BuCBHbVm.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/2.datatype.html-DryoA7YL.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/3.variable.html-4ia_Vq9N.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/4.io.html-DcPaUK3s.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/5.condition.html-CYV1UhvI.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/6.data_structures.html-C8qsDXyT.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-CV7cNUsO.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/1.interface.html-CudaSMgf.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/10.cgo.html-C2GOeg2b.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/11.pprof.html-BYKRQVLe.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/12.followUp.html-JqotTJlJ.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/2.generic.html-DE0T38UP.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/3.reflect.html-CQNgvd4A.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/4.types.html-Db8bw65x.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/5.error.html-CCOeGcIu.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/6.file.html-CqoCIlaU.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/7.concurrency.html-DVb1X2ke.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/8.module.html-DnMQisAC.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/9.test.html-CTMbZGSe.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-BE8oefdE.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/notes.html-n6QlJpbJ.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/test.html-B1cbs-5Y.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/1.基础语法.html-DWsuU2ll.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/2.进阶原理.html-F-BEoDmd.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-azVT5kSm.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/大厂面试题.html-J5-a1zik.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/对象池.html-CsHQQa3X.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/极智天下.html-DUr633v9.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/面试题（答案）.html-DkM3AljN.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-BJsA7HQ7.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Consul.html-xywJsBxP.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Docker.html-DJZ8sN8j.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/GRPC.html-MW2pAuZJ.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Jaeger.html-BrFPQpnj.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Kong.html-Df7LgaAW.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Kubernetes.html-CxXGj7rh.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Nacos.html-J6yPpPCB.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-B79T7bMh.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Sentinel.html-BeGZn4Wa.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-BkZ9yN8h.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-B5tmvR5t.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Elasticsearch-Go.html-C9aEJ3FJ.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Elasticsearch.html-CZiIOjzI.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/MYSQL高级.html-D_DxwnLh.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/MongoDB-Go.html-CKFW3GlF.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/MongoDB.html-D0KFEV1P.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/MySQL-Go.html-Dl5PEQoA.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/MySQL.html-BKwc7btD.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-BBfMag8G.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Redis-Go.html-BsVg-IIl.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/EMQX.html-DUsT8Pjq.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Kafka1.html-CqAfByPn.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Kafka_go.html-CUtks8Kt.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-aRIvio30.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/RocketMQ.html-BoXPiuXz.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/kafka.html-Z4wJ17tF.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Kong.html-XX6MT0n2.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Nginx.html-CY_VVDFa.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-Cp7HGJjB.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Docker-Do.html-DIvxwsHu.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Docker.html-CPGMPOPu.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Jenkins.html-BNmrwO8M.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Kubernetes.html-Dx09GAhD.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-DCy_QoxW.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/kubernetes-Do.html-DAYNGrCk.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/casbin.html-Dx0zjnwD.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/0.use.html-aMSYXAcZ.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/1.howWork.html-CQqOnYcd.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-B2-BcHNa.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/0.use.html-DyTJ3_g5.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/1.howWork.html-DudqChHi.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-B6VJS887.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-G1g76VGZ.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Zap.html-C61_-lUo.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/用户认证选型.html-CvfjcLbz.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/监控.html-DX9SDRpD.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/0.intro.html-CghpmdSz.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-z6pteYVZ.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/encode.html-D3NBxjkZ.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/flag.html-D1cdlkLa.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/http.html-C61uwnlN.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/log.html-C2Obw4id.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/math.html-Cwx9xZvu.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/net.html-ygX58gc_.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/sort.html-D3ZMKzcz.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/strconv.html-BuRZCKrl.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/strings.html-hpkND0dv.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/template.html-CKjnHtgU.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/time.html-CXi4thPc.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/unicode.html-lL6scpQR.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/unsafe.html-CBvmoEf5.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/0.runtime.html-Deh4NUh8.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/1.并发.html-BQLX9c5e.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/2.数据结构.html-CZnmAwEs.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/3.错误处理.html-CFf2dWfi.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-DMnp1ev-.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/404.html-BbeqS6w1.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-fnkNcJTg.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-CiGQdepJ.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-Cyk7m9K5.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-BmdunNAc.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-Qzg8KPnC.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-Ta_MqXMa.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/flowchart-CTwbLKUk.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index-izhIXQi-.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index-DRWmbcXV.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index-B2Pezylg.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/mermaid.esm.min-URohNFRN.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/photoswipe.esm-GXRgw7eJ.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/giscus-BZxmVUME.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/SearchResult-TZPv2Nah.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/setupDevtools-7MC2TMWH-D3bvDbm5.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/vuepress-app/" aria-label="带我回家"><img class="vp-nav-logo light" src="/vuepress-app/log.svg" alt><img class="vp-nav-logo dark" src="/vuepress-app/logDark.svg" alt><span class="vp-site-name hide-in-pad">Golang全栈指南</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/vuepress-app/" aria-label="首页"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->首页<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="golang"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>golang<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/golang/%E5%9F%BA%E7%A1%80/" aria-label="Go基础"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-eraser" style=""></span><!--]-->Go基础<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/golang/%E8%BF%9B%E9%98%B6/" aria-label="Go进阶"><!--[--><img class="icon" src="/vuepress-app/assets/icon/up.png" alt aria-hidden no-view style=""><!--]-->Go进阶<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/golang/%E5%8E%9F%E7%90%86/" aria-label="原理"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-gears" style=""></span><!--]-->原理<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/golang/web%E6%A1%86%E6%9E%B6/" aria-label="框架"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-sitemap" style=""></span><!--]-->框架<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/golang/%E9%9D%A2%E8%AF%95/" aria-label="面试"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-feather" style=""></span><!--]-->面试<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="中间件"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-layer-group" style=""></span>中间件<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/middleware/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html" aria-label="MySql"><!--[--><img class="icon" src="/vuepress-app/assets/icon/mysql.png" alt aria-hidden no-view style=""><!--]-->MySql<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/vuepress-app/middleware/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis.html" aria-label="Redis"><!--[--><img class="icon" src="/vuepress-app/assets/icon/redis.png" alt aria-hidden no-view style=""><!--]-->Redis<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/middleware/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB.html" aria-label="MongoDB"><!--[--><img class="icon" src="/vuepress-app/assets/icon/mongodb.png" alt aria-hidden no-view style=""><!--]-->MongoDB<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/middleware/%E6%B6%88%E6%81%AF%E7%BB%84%E4%BB%B6/kafka.html" aria-label="kafka"><!--[--><img class="icon" src="/vuepress-app/assets/icon/Kafka.png" alt aria-hidden no-view style=""><!--]-->kafka<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/middleware/%E7%BD%91%E5%85%B3/Nginx.html" aria-label="Nginx"><!--[--><img class="icon" src="/vuepress-app/assets/icon/Nginx.png" alt aria-hidden no-view style=""><!--]-->Nginx<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/middleware/%E8%BF%90%E7%BB%B4/Docker.html" aria-label="Docker"><!--[--><img class="icon" src="/vuepress-app/assets/icon/docker.png" alt aria-hidden no-view style=""><!--]-->Docker<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/middleware/%E8%BF%90%E7%BB%B4/Kubernetes.html" aria-label="Kubernetes"><!--[--><img class="icon" src="/vuepress-app/assets/icon/kubernetes.png" alt aria-hidden no-view style=""><!--]-->Kubernetes<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="架构"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-network-wired" style=""></span>架构<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/framework/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" aria-label="微服务"><!--[--><img class="icon" src="/vuepress-app/assets/icon/micro.png" alt aria-hidden no-view style=""><!--]-->微服务<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/framework/%E5%88%86%E5%B8%83%E5%BC%8F/" aria-label="分布式"><!--[--><img class="icon" src="/vuepress-app/assets/icon/kubernetes.png" alt aria-hidden no-view style=""><!--]-->分布式<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/framework/%E9%AB%98%E5%8F%AF%E7%94%A8/" aria-label="高可用"><!--[--><img class="icon" src="/vuepress-app/assets/icon/available.png" alt aria-hidden no-view style=""><!--]-->高可用<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/framework/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8/" aria-label="领域驱动"><!--[--><img class="icon" src="/vuepress-app/assets/icon/DDD.png" alt aria-hidden no-view style=""><!--]-->领域驱动<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="计算机"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-computer" style=""></span>计算机<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/computer/%E7%BD%91%E7%BB%9C/" aria-label="计算机网络"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-globe" style=""></span><!--]-->计算机网络<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/computer/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" aria-label="操作系统"><!--[--><img class="icon" src="/vuepress-app/assets/icon/linux.png" alt aria-hidden no-view style=""><!--]-->操作系统<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/computer/0.%E7%AE%97%E6%B3%95.html" aria-label="常用算法"><!--[--><img class="icon" src="/vuepress-app/assets/icon/arithmetic.png" alt aria-hidden no-view style=""><!--]-->常用算法<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/computer/1.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html" aria-label="设计模式"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-pen-ruler" style=""></span><!--]-->设计模式<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="好物分享"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-share-nodes" style=""></span>好物分享<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/share/%E5%A5%BD%E7%89%A9%E5%88%86%E4%BA%AB.html" aria-label="好物分享"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-share-nodes" style=""></span><!--]-->好物分享<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/share/git.html" aria-label="git"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-git-alt" style=""></span><!--]-->git<!----></a></li></ul></button></div></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/Cospk" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="slimsearch-button" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="slimsearch-placeholder">搜索</div><div class="slimsearch-key-hints"><kbd class="slimsearch-key">Ctrl</kbd><kbd class="slimsearch-key">K</kbd></div></button><!--]--><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-database" style=""></span><span class="vp-sidebar-title">数据库</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/vuepress-app/middleware/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html" aria-label="MySQL-基础"><!---->MySQL-基础<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/vuepress-app/middleware/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL-Go.html" aria-label="MySQL-Go"><!---->MySQL-Go<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/vuepress-app/middleware/%E6%95%B0%E6%8D%AE%E5%BA%93/MYSQL%E9%AB%98%E7%BA%A7.html" aria-label="MySQL高级"><!---->MySQL高级<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/vuepress-app/middleware/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis.html" aria-label="Redis"><!---->Redis<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/vuepress-app/middleware/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis-Go.html" aria-label="Redis - Go"><!---->Redis - Go<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/vuepress-app/middleware/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB.html" aria-label="MongoDB"><!---->MongoDB<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/vuepress-app/middleware/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB-Go.html" aria-label="MongoDB - Go"><!---->MongoDB - Go<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/vuepress-app/middleware/%E6%95%B0%E6%8D%AE%E5%BA%93/Elasticsearch.html" aria-label="ElasticSearch - Go"><!---->ElasticSearch - Go<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/vuepress-app/middleware/%E6%95%B0%E6%8D%AE%E5%BA%93/Elasticsearch-Go.html" aria-label="ElasticSearch - Go"><!---->ElasticSearch - Go<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><img class="icon" src="/vuepress-app/assets/icon/MQ.png" alt aria-hidden no-view style=""><span class="vp-sidebar-title">消息组件</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><img class="icon" src="/vuepress-app/assets/icon/network.png" alt aria-hidden no-view style=""><span class="vp-sidebar-title">网关</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><img class="icon" src="/vuepress-app/assets/icon/docker.png" alt aria-hidden no-view style=""><span class="vp-sidebar-title">运维</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">鉴权</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Redis</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">xiaoxie</span></span><span property="author" content="xiaoxie"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2020年1月1日</span><meta property="datePublished" content="2020-01-01T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 49 分钟</span><meta property="timeRequired" content="PT49M"></span><!----><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color5" role>db</span><!--]--><meta property="keywords" content="db"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc" vp-toc><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_01、redis-简介">01、Redis 简介</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#redis-优势">Redis 优势</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#为什么用redis">为什么用redis</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_02、redis的下载和安装">02、Redis的下载和安装</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-window下安装redis服务">1.window下安装Redis服务</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-linux下安装redis服务">2.Linux下安装Redis服务</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-redis配置文件详解">3.Redis配置文件详解</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_03、关于redis-命令">03、关于Redis 命令</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#a-key命令">a.Key命令</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#b-服务端命令">b.服务端命令</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_04、数据结构">04、数据结构</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-字符串string">1. 字符串String</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-列表list">2.列表List</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-哈希表hash">3.哈希表hash</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-集合set">4.集合Set</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-有序集合zset">5.有序集合Zset</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#扩展">扩展</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_05、redis持久化">05、Redis持久化</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rdb-快照模式">RDB-快照模式</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#aof-日志模式">AOF-日志模式</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#aof和rdb对比">AOF和RDB对比</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_06、事务">06、事务</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_07、redis主从复制">07、Redis主从复制</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#好处">好处</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#主从模式实现">主从模式实现</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_08、redis哨兵">08、Redis哨兵</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#原理">原理</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#哨兵的配置和使用">哨兵的配置和使用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#哨兵模式应用">哨兵模式应用</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_09、redis集群">09、Redis集群</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#原理-1">原理</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#组成">组成</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#部署集群">部署集群</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#总结">总结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#优化">优化</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content" vp-content><h1 id="redis理论" tabindex="-1"><a class="header-anchor" href="#redis理论"><span>Redis理论</span></a></h1><p>官方网站：<a href="https://redis.io/" target="_blank" rel="noopener noreferrer">https://redis.io/</a></p><p>中文网站：<a href="https://www.redis.net.cn/" target="_blank" rel="noopener noreferrer">https://www.redis.net.cn/</a></p><h2 id="_01、redis-简介" tabindex="-1"><a class="header-anchor" href="#_01、redis-简介"><span>01、Redis 简介</span></a></h2><p>Redis 是完全开源免费的，遵守BSD协议，是一个高性能的<code>key-value</code>数据库。</p><p>Redis 特点：</p><ul><li>Redis支持数据的持久化，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用。</li><li>Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。</li><li>Redis支持数据的备份，即master-slave模式的数据备份。</li></ul><h3 id="redis-优势" tabindex="-1"><a class="header-anchor" href="#redis-优势"><span>Redis 优势</span></a></h3><ul><li>性能极高 – Redis能读的速度是110000次/s,写的速度是81000次/s 。</li><li>丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。</li><li>原子 – Redis的所有操作都是原子性的，同时Redis还支持对几个操作全并后的原子性执行。</li><li>丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性。</li></ul><h3 id="为什么用redis" tabindex="-1"><a class="header-anchor" href="#为什么用redis"><span>为什么用redis</span></a></h3><h4 id="高性能" tabindex="-1"><a class="header-anchor" href="#高性能"><span>高性能</span></a></h4><ul><li><p><mark>单线程简单、无线程开销</mark> 使用单线程简单，避免了多线程的竞争；同时还省去了多线程切换带来的时间和性能上的开销。</p></li><li><p>redis主要基于内存操作内存的执行效率本身就很快，并且redis还采用了高效的数据结构。</p></li><li><p>在请求上采用I\O多路复用机制多路复用机制是一种基于非阻塞I/O模型，可以使redis高效的进行网络通信，I/O的读写也不再阻塞，就可以处理大量的客户端socket请求。</p></li></ul><h4 id="高并发" tabindex="-1"><a class="header-anchor" href="#高并发"><span>高并发</span></a></h4><ul><li><p>mysql单机一般只能支撑到2000Qps，而redis由于是K/V式的操作，单机可以支撑并发量几万到十几万。</p></li><li><p>redis分布式集群化扩展性极高，而且稳定，能够支撑大量的数据吞吐，只要硬件支持。</p></li></ul><h4 id="与传统关系型数据库对比" tabindex="-1"><a class="header-anchor" href="#与传统关系型数据库对比"><span>与传统关系型数据库对比：</span></a></h4><ul><li><p>redis 的优势比较多，如高性能，高可用，丰富的数据类型、原子性、扩展性比较强、可持久化、生态完善等等，但是比较有决定性的还是高性能和丰富的数据类型支持（string、list、set、sortedset（有序集合）、hash等），</p></li><li><p>一般一个东西好不好用，多数比较出来的，一般我们项目中引入redis 多数是为了减轻关系型数据库压力的，那就跟关系型数据库来比较，常见的关系型数据库是基于磁盘存储的，数据存取IO较高，</p></li></ul><h2 id="_02、redis的下载和安装" tabindex="-1"><a class="header-anchor" href="#_02、redis的下载和安装"><span>02、Redis的下载和安装</span></a></h2><h3 id="_1-window下安装redis服务" tabindex="-1"><a class="header-anchor" href="#_1-window下安装redis服务"><span>1.window下安装Redis服务</span></a></h3><ol><li>Github获取redis安装包，<a href="https://github.com/MSOpenTech/redis" target="_blank" rel="noopener noreferrer">地址：Redis</a></li><li>双击点击安装msi格式的安装包，开始进行安装</li><li>安装注意：添加redis目录到环境变量方便系统自动识别、使用默认端口、设置最大内存学习就100MB</li><li>对Redis进行配置： <ol><li>编辑器编辑redis.windows-service.conf文件</li><li>找到requirepass配置（设置密码），如：输入requirepass 12345。（测试环境可以不用密码）</li><li>确保服务正常启动即可</li></ol></li><li>可正常在命令行操作Redis了</li></ol><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">输入命令：redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">     ---（客户端程序）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">输入密码回车：auth</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 12345</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 返回提示OK表示验证通过</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">auth</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 12345</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Ok</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-linux下安装redis服务" tabindex="-1"><a class="header-anchor" href="#_2-linux下安装redis服务"><span>2.Linux下安装Redis服务</span></a></h3><ol><li><p>安装编译环境gcc （Redis是C编写的，需要C的环境）</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gcc-c++</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>下载，解压，编译（redis下载地址为：<a href="https://redis.io/download/%EF%BC%89" target="_blank" rel="noopener noreferrer">https://redis.io/download/）</a></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://github.com/redis/redis/archive/7.0.8.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tar</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> xzf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 7.0.8.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis-7.0.8</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> make</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>二进制文件是编译完成后在<code>src</code>目录下. 运行如下</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> src/redis-server</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>使用客户端连接服务</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 本地连接</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> src/redis-cli</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 远程连接</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> host</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> password</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="_3-redis配置文件详解" tabindex="-1"><a class="header-anchor" href="#_3-redis配置文件详解"><span>3.Redis配置文件详解</span></a></h3><ul><li>Redis 的配置文件位于 Redis 安装目录下，文件名为 redis.conf。</li><li>你可以通过 <strong>CONFIG</strong> 命令查看或设置配置项。</li></ul><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">参数说明</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis.conf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 配置项说明如下：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Redis默认不是以守护进程的方式运行，可以通过该配置项修改，使用yes启用守护进程</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    daemonize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 当Redis以守护进程方式运行时，Redis默认会把pid写入/var/run/redis.pid文件，可以通过pidfile指定</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    pidfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/run/redis.pid</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">3.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 指定Redis监听端口，默认端口为6379，作者在自己的一篇博文中解释了为什么选用6379作为默认端口，因为6379在手机按键上MERZ对应的号码，而MERZ取自意大利歌女Alessia</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Merz的名字</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">4.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 绑定的主机地址</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    bind</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5.当</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 客户端闲置多长时间后关闭连接，如果指定为0，表示关闭该功能</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    timeout</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 300</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">6.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 指定日志记录级别，Redis总共支持四个级别：debug、verbose、notice、warning，默认为verbose</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    loglevel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> verbose</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">7.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 日志记录方式，默认为标准输出，如果配置Redis为守护进程方式运行，而这里又配置为日志记录方式为标准输出，则日志将会发送给/dev/null</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    logfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stdout</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 设置数据库的数量，默认数据库为0，可以使用SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">dbi</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">d&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">命令在连接上指定数据库id</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    databases</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 16</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">9.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    save</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">second</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">s&gt; &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">change</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">s&gt;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Redis默认配置文件中提供了三个条件：</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    save</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 900</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 900秒（15分钟）内有1个更改，</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    save</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 300</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  300秒（5分钟）内有10个更改</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    save</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 60</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10000</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 60秒内有10000个更改。</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">10.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 指定存储至本地数据库时是否压缩数据，默认为yes，Redis采用LZF压缩，如果为了节省CPU时间，可以关闭该选项，但会导致数据库文件变的巨大</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    rdbcompression</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">11.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 指定本地数据库文件名，默认值为dump.rdb</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    dbfilename</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dump.rdb</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">12.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 指定本地数据库存放目录</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    dir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">13.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 设置当本机为slav服务时，设置master服务的IP地址及端口，在Redis启动时，它会自动从master进行数据同步</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    slaveof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">masteri</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">p&gt; &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">masterpor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">t&gt;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">14.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 当master服务设置了密码保护时，slav服务连接master的密码</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    masterauth</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">master-passwor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">d&gt;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">15.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 设置Redis连接密码，如果配置了连接密码，客户端在连接Redis时需要通过AUTH</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">passwor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">d&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">命令提供密码，默认关闭</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    requirepass</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> foobared</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">16.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 设置同一时间最大客户端连接数，默认无限制，Redis可以同时打开的客户端连接数为Redis进程可以打开的最大文件描述符数，如果设置</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> maxclients</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0，表示不作限制。当客户端连接数到达限制时，Redis会关闭新的连接并向客户端返回max</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> number</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> clients</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reached错误信息</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    maxclients</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 128</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">17.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 指定Redis最大内存限制，Redis在启动时会把数据加载到内存中，达到最大内存后，Redis会先尝试清除已到期或即将到期的Key，当此方法处理</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 后，仍然到达最大内存设置，将无法再进行写入操作，但仍然可以进行读取操作。Redis新的vm机制，会把Key存放内存，Value会存放在swap区</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    maxmemory</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">byte</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">s&gt;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">18.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 指定是否在每次更新操作后进行日志记录，Redis在默认情况下是异步的把数据写入磁盘，如果不开启，可能会在断电时导致一段时间内的数据丢失。因为</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis本身同步数据文件是按上面save条件来同步的，所以有的数据会在一段时间内只存在于内存中。默认为no</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    appendonly</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">19.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 指定更新日志文件名，默认为appendonly.aof</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     appendfilename</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> appendonly.aof</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">20.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 指定更新日志条件，共有3个可选值：</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     no：表示等操作系统进行数据缓存同步到磁盘（快）</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     always：表示每次更新操作后手动调用fsync</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">将数据写到磁盘（慢，安全）</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     everysec：表示每秒同步一次（折衷，默认值）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    appendfsync</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> everysec</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">21.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 指定是否启用虚拟内存机制，默认值为no，简单的介绍一下，VM机制将数据分页存放，由Redis将访问量较少的页即冷数据swap到磁盘上，访问多的页面由磁盘自动换出到内存中（在后面的文章我会仔细分析Redis的VM机制）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     vm-enabled</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 虚拟内存文件路径，默认值为/tmp/redis.swap，不可多个Redis实例共享</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     vm-swap-file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /tmp/redis.swap</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">23.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 将所有大于vm-max-memory的数据存入虚拟内存,无论vm-max-memory设置多小,所有索引数据都是内存存储的</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Redis的索引数据</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 就是keys</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">,也就是说,当vm-max-memory设置为0的时候,其实是所有value都存在于磁盘。默认值为0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     vm-max-memory</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">24.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Redis</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> swap文件分成了很多的page，一个对象可以保存在多个page上面，但一个page上不能被多个对象共享，vm-page-size是要根据存储的</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 数据大小来设定的，作者建议如果存储很多小对象，page大小最好设置为32或者64bytes；如果存储很大大对象，则可以使用更大的page，如果不</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 确定，就使用默认值</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     vm-page-size</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 32</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">25.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 设置swap文件中的page数量，由于页表（一种表示页面空闲或使用的bitmap）是在放在内存中的，，在磁盘上每8个pages将消耗1byte的内存。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     vm-pages</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 134217728</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">26.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 设置访问swap文件的线程数,最好不要超过机器的核数,如果设置为0,那么所有对swap文件的操作都是串行的，可能会造成比较长时间的延迟。默认值为4</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     vm-max-threads</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">27.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 设置在向客户端应答时，是否把较小的包合并为一个包发送，默认为开启</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    glueoutputbuf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">28.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 指定在超过一定的数量或者最大的元素超过某一临界值时，采用一种特殊的哈希算法</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    hash-max-zipmap-entries</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 64</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    hash-max-zipmap-value</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 512</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">29.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 指定是否激活重置哈希，默认为开启（后面在介绍Redis的哈希算法时具体介绍）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    activerehashing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">30.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 指定包含其它的配置文件，可以在同一主机上多个Redis实例之间使用同一份配置文件，而同时各个实例又拥有自己的特定配置文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /path/to/local.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_03、关于redis-命令" tabindex="-1"><a class="header-anchor" href="#_03、关于redis-命令"><span>03、关于Redis 命令</span></a></h2><h3 id="a-key命令" tabindex="-1"><a class="header-anchor" href="#a-key命令"><span>a.Key命令</span></a></h3><p>命令文档：<a href="https://redis.io/commands/" target="_blank" rel="noopener noreferrer">https://redis.io/commands/</a></p><p>下表给出了与 Redis 键相关的基本命令：</p><table><thead><tr><th style="text-align:left;">序号</th><th style="text-align:left;">命令及描述</th></tr></thead><tbody><tr><td style="text-align:left;">1</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3528.html" target="_blank" rel="noopener noreferrer">DEL key</a> 该命令用于在 key 存在是删除 key。</td></tr><tr><td style="text-align:left;">2</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3529.html" target="_blank" rel="noopener noreferrer">DUMP key</a> 序列化给定 key ，并返回被序列化的值。</td></tr><tr><td style="text-align:left;">3</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3530.html" target="_blank" rel="noopener noreferrer">EXISTS key</a> 检查给定 key 是否存在。</td></tr><tr><td style="text-align:left;">4</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3531.html" target="_blank" rel="noopener noreferrer">EXPIRE key</a> seconds 为给定 key 设置过期时间。</td></tr><tr><td style="text-align:left;">5</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3532.html" target="_blank" rel="noopener noreferrer">EXPIREAT key timestamp</a> EXPIREAT 的作用和 EXPIRE 类似，都用于为 key 设置过期时间。 不同在于 EXPIREAT 命令接受的时间参数是 UNIX 时间戳(unix timestamp)。</td></tr><tr><td style="text-align:left;">6</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3533.html" target="_blank" rel="noopener noreferrer">PEXPIRE key milliseconds</a> 设置 key 的过期时间亿以毫秒计。</td></tr><tr><td style="text-align:left;">7</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3534.html" target="_blank" rel="noopener noreferrer">PEXPIREAT key milliseconds-timestamp</a> 设置 key 过期时间的时间戳(unix timestamp) 以毫秒计</td></tr><tr><td style="text-align:left;">8</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3535.html" target="_blank" rel="noopener noreferrer">KEYS pattern</a> 查找所有符合给定模式( pattern)的 key 。</td></tr><tr><td style="text-align:left;">9</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3536.html" target="_blank" rel="noopener noreferrer">MOVE key db</a> 将当前数据库的 key 移动到给定的数据库 db 当中。</td></tr><tr><td style="text-align:left;">10</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3537.html" target="_blank" rel="noopener noreferrer">PERSIST key</a> 移除 key 的过期时间，key 将持久保持。</td></tr><tr><td style="text-align:left;">11</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3538.html" target="_blank" rel="noopener noreferrer">PTTL key</a> 以毫秒为单位返回 key 的剩余的过期时间。</td></tr><tr><td style="text-align:left;">12</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3539.html" target="_blank" rel="noopener noreferrer">TTL key</a> 以秒为单位，返回给定 key 的剩余生存时间(TTL, time to live)。</td></tr><tr><td style="text-align:left;">13</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3540.html" target="_blank" rel="noopener noreferrer">RANDOMKEY</a> 从当前数据库中随机返回一个 key 。</td></tr><tr><td style="text-align:left;">14</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3541.html" target="_blank" rel="noopener noreferrer">RENAME key newkey</a> 修改 key 的名称</td></tr><tr><td style="text-align:left;">15</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3542.html" target="_blank" rel="noopener noreferrer">RENAMENX key newkey</a> 仅当 newkey 不存在时，将 key 改名为 newkey 。</td></tr><tr><td style="text-align:left;">16</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3543.html" target="_blank" rel="noopener noreferrer">TYPE key</a> 返回 key 所储存的值的类型。</td></tr></tbody></table><p><strong>1、查看所有的key</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">keys</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>2、删除的key</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">del</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> key</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>3、检查给定 key 是否存在</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">EXISTS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> key</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>4、 为给定 key 设置过期时间</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">EXPIRE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> key</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> seconds</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>5、PERSIST 用户删除key的过期时间</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PERSIST</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> age</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>6、将当前数据库的 key 移动到给定的数据库 db 当中。</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">move</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> key</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> db</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>7、以秒为单位，返回给定 key 的剩余生存时间(TTL, time to live)。</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ttl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> key</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>8、以毫秒为单位返回 key 的剩余的过期时间</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PTTL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> key</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>9、从当前数据库中随机返回一个 key</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">RANDOMKEY</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>10、修改 key 的名称</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">RENAME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> key</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> newkey</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>11、返回 key 所储存的值的类型</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">TYPE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> key</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>12、用于选择数据库，数据库一共0~15</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="b-服务端命令" tabindex="-1"><a class="header-anchor" href="#b-服务端命令"><span>b.服务端命令</span></a></h3><p><strong>1、ping，如果服务器运行正常的话，使用ping 返回一个pong</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ping</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>2、QUIT 可以通过命令退出当前Redis的客户端链接</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">QUIT</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>3、DBSIZE 查看当前数据库中key的条目，类似于keys</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dbsize</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>4、INFO 用于查看Redis服务器各种信息和统计数值</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">info</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>5、CONFIG GET 查看redis服务器的配置信息</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看redis安装的位置，如果你想获取所有的redis服务配置的信息使用:config get *</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">config</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dir</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>6、FLUSHDB 用于删除当前选择的数据库所有的key</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">flush</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> db</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>7、FLUSHALL 用于删除所有数据库中的key</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">flushall</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_04、数据结构" tabindex="-1"><a class="header-anchor" href="#_04、数据结构"><span>04、数据结构</span></a></h2><p>上面我们说过redis采用了高效的数据结构，Redis支持5种数据类型：string，hash，list，set，zset。</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/Redis_struct.png" alt="数据类型" tabindex="0" loading="lazy"><figcaption>数据类型</figcaption></figure><h3 id="_1-字符串string" tabindex="-1"><a class="header-anchor" href="#_1-字符串string"><span>1. 字符串String</span></a></h3><p>表列出了常用的 redis 字符串命令：</p><table><thead><tr><th style="text-align:left;"><strong>序号</strong></th><th style="text-align:left;"><strong>命令及描述</strong></th></tr></thead><tbody><tr><td style="text-align:left;"><strong>--1--</strong></td><td style="text-align:left;"><strong><code>set key value </code>设置指定 key 的值</strong></td></tr><tr><td style="text-align:left;"><strong>--2--</strong></td><td style="text-align:left;"><strong><code>get key</code> 获取指定 key 的值。</strong></td></tr><tr><td style="text-align:left;">3</td><td style="text-align:left;"><code>getrange key start end</code>返回 key 中字符串值的子字符</td></tr><tr><td style="text-align:left;">4</td><td style="text-align:left;"><code>getset key value</code> 将给定 key 的值设为 value ，并返回 key 的旧值(old value)。</td></tr><tr><td style="text-align:left;"><strong>--5--</strong></td><td style="text-align:left;"><strong><code>getbit key offset</code> 对 key 所储存的字符串值，获取指定偏移量上的位(bit)。</strong></td></tr><tr><td style="text-align:left;"><strong>--6--</strong></td><td style="text-align:left;"><strong><code>mget key1 [key2..]</code> 获取所有(一个或多个)给定 key 的值。</strong></td></tr><tr><td style="text-align:left;"><strong>--7--</strong></td><td style="text-align:left;"><strong><code>setbit key offset value</code>对 key 所储存的字符串值，设置或清除指定偏移量上的位(bit)。</strong></td></tr><tr><td style="text-align:left;"><strong>--8--</strong></td><td style="text-align:left;"><strong><code>setex key seconds value</code>将值 value 关联到 key ，并将 key 的过期时间设为 seconds (以秒为单位)。</strong></td></tr><tr><td style="text-align:left;"><strong>--9--</strong>!</td><td style="text-align:left;"><strong><code>setnx key value</code> 只有在 key 不存在时设置 key 的值。</strong></td></tr><tr><td style="text-align:left;">10</td><td style="text-align:left;"><code>setrange key offset value</code>用 value 参数覆写给定 key 所储存的字符串值，从偏移量 offset 开始。</td></tr><tr><td style="text-align:left;">11</td><td style="text-align:left;"><code>strlen key</code> 返回 key 所储存的字符串值的长度。</td></tr><tr><td style="text-align:left;">12</td><td style="text-align:left;"><code>mset key value key value ...</code> 同时设置一个或多个 key-value 对。</td></tr><tr><td style="text-align:left;">13</td><td style="text-align:left;"><code>msetnx key value [key value ...]</code>同时设置一个或多个 key-value 对，当且仅当所有给定 key 都不存在。</td></tr><tr><td style="text-align:left;">14</td><td style="text-align:left;"><code>psetex key milliseconds value</code> 这个命令和 SETEX 命令相似，但它以毫秒为单位设置 key 的生存时间，而不是像 SETEX 命令那样，以秒为单位。</td></tr><tr><td style="text-align:left;"><strong>--15--</strong></td><td style="text-align:left;"><strong><code>incr key</code> 将 key 中储存的数字值增一。</strong></td></tr><tr><td style="text-align:left;"><strong>--16--</strong></td><td style="text-align:left;"><strong><code>incrby key increment </code>将 key 所储存的值加上给定的增量值（increment）</strong> 。==</td></tr><tr><td style="text-align:left;"><strong>--17--</strong></td><td style="text-align:left;"><strong><code>incrbyfloat key increment </code>将 key 所储存的值加上给定的浮点增量值（increment）</strong> 。</td></tr><tr><td style="text-align:left;"><strong>--18--</strong></td><td style="text-align:left;"><strong><code>decr key </code>将 key 中储存的数字值减一。</strong></td></tr><tr><td style="text-align:left;"><strong>--19--</strong></td><td style="text-align:left;"><strong><code>decrby key decrement key</code> 所储存的值减去给定的减量值（decrement） 。</strong></td></tr><tr><td style="text-align:left;">20</td><td style="text-align:left;"><code>append key value </code>如果 key 已经存在并且是一个字符串， APPEND 命令将 value 追加到 key 原来的值的末尾。</td></tr></tbody></table><h3 id="_2-列表list" tabindex="-1"><a class="header-anchor" href="#_2-列表list"><span>2.列表List</span></a></h3><table><thead><tr><th style="text-align:left;">序号</th><th style="text-align:left;">命令及描述</th></tr></thead><tbody><tr><td style="text-align:left;">1</td><td style="text-align:left;"><code>blpop key1 [key2 ] timeout</code> 移出并获取列表的第一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</td></tr><tr><td style="text-align:left;">2</td><td style="text-align:left;"><code>brpop key1 key2 timeout</code> 移出并获取列表的最后一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</td></tr><tr><td style="text-align:left;">3</td><td style="text-align:left;"><code>brpoplpush source destination timeout </code>从列表中弹出一个值，将弹出的元素插入到另外一个列表中并返回它； 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</td></tr><tr><td style="text-align:left;">4</td><td style="text-align:left;"><code>lindex key index</code>通过索引获取列表中的元素</td></tr><tr><td style="text-align:left;">5</td><td style="text-align:left;">`linsert key before</td></tr><tr><td style="text-align:left;">6</td><td style="text-align:left;"><code>llen key</code>获取列表长度</td></tr><tr><td style="text-align:left;">7</td><td style="text-align:left;"><code>lpop key</code>移出并获取列表的第一个元素</td></tr><tr><td style="text-align:left;">8</td><td style="text-align:left;"><code>lpush key value1 value2</code>将一个或多个值插入到列表头部</td></tr><tr><td style="text-align:left;">9</td><td style="text-align:left;"><code>lpushx key value</code>将一个或多个值插入到已存在的列表头部</td></tr><tr><td style="text-align:left;">10</td><td style="text-align:left;"><code>lrange key start stop</code>获取列表指定范围内的元素</td></tr><tr><td style="text-align:left;">11</td><td style="text-align:left;"><code>lrem key count value</code> 移除列表元素</td></tr><tr><td style="text-align:left;"><strong>--12--</strong></td><td style="text-align:left;"><strong><code>lset key index value</code> 通过索引设置列表元素的值</strong></td></tr><tr><td style="text-align:left;">13</td><td style="text-align:left;"><code>ltrim key start stop</code>对一个列表进行修剪(trim)，就是说，让列表只保留指定区间内的元素，不在指定区间之内的元素都将被删除。</td></tr><tr><td style="text-align:left;">14</td><td style="text-align:left;"><code>rpop key</code>移除并获取列表最后一个元素</td></tr><tr><td style="text-align:left;">15</td><td style="text-align:left;"><code>rpoplpush source destination</code>移除列表的最后一个元素，并将该元素添加到另一个列表并返回</td></tr><tr><td style="text-align:left;">16</td><td style="text-align:left;"><code>rpush key value1 value2</code>在列表中添加一个或多个值</td></tr><tr><td style="text-align:left;">17</td><td style="text-align:left;"><code>rpushx key value</code> 为已存在的列表添加值</td></tr></tbody></table><h3 id="_3-哈希表hash" tabindex="-1"><a class="header-anchor" href="#_3-哈希表hash"><span>3.哈希表hash</span></a></h3><table><thead><tr><th style="text-align:left;">序号</th><th style="text-align:left;">命令及描述</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>1</strong></td><td style="text-align:left;"><strong><code>hdel key field2 field2</code>删除一个或多个哈希表字段</strong></td></tr><tr><td style="text-align:left;"><strong>2</strong></td><td style="text-align:left;"><strong><code>hexists key field</code> 查看哈希表 key 中，指定的字段是否存在。</strong></td></tr><tr><td style="text-align:left;"><strong>3</strong></td><td style="text-align:left;"><strong><code>hget key field</code>获取存储在哈希表中指定字段的值</strong></td></tr><tr><td style="text-align:left;">4</td><td style="text-align:left;"><strong><code>hgetall key</code> 获取在哈希表中指定 key 的所有字段和值</strong></td></tr><tr><td style="text-align:left;">5</td><td style="text-align:left;"><code>hincrby key field increment </code>为哈希表 key 中的指定字段的整数值加上增量 increment 。</td></tr><tr><td style="text-align:left;">6</td><td style="text-align:left;"><code>hincrbyfloat key field increment</code> 为哈希表 key 中的指定字段的浮点数值加上增量 increment 。</td></tr><tr><td style="text-align:left;">7</td><td style="text-align:left;"><code>hkeys key</code>获取所有哈希表中的字段</td></tr><tr><td style="text-align:left;">8</td><td style="text-align:left;"><code>hlen key</code> 获取哈希表中字段的数量</td></tr><tr><td style="text-align:left;">9</td><td style="text-align:left;"><code>hmget key field1 field2 </code>获取所有给定字段的值</td></tr><tr><td style="text-align:left;">10</td><td style="text-align:left;"><code>hmset key field1 value1 field2 value2</code>同时将多个 field-value (域-值)对设置到哈希表 key 中。</td></tr><tr><td style="text-align:left;">11</td><td style="text-align:left;"><strong><code>hset key field value </code>将哈希表 key 中的字段 field 的值设为 value 。</strong></td></tr><tr><td style="text-align:left;">12</td><td style="text-align:left;"><strong><code>hsetnx key field value</code> 只有在字段 field 不存在时，设置哈希表字段的值。</strong></td></tr><tr><td style="text-align:left;">13</td><td style="text-align:left;"><strong><code>hvals key</code>获取哈希表中所有值</strong></td></tr><tr><td style="text-align:left;"><strong>--14--</strong></td><td style="text-align:left;"><strong><code>hscan key cursor [MATCH pattern] [COUNT count]</code> 迭代哈希表中的键值对。</strong></td></tr></tbody></table><h3 id="_4-集合set" tabindex="-1"><a class="header-anchor" href="#_4-集合set"><span>4.集合Set</span></a></h3><table><thead><tr><th style="text-align:left;">序号</th><th style="text-align:left;">命令及描述</th></tr></thead><tbody><tr><td style="text-align:left;">1</td><td style="text-align:left;">SADD key member1 member2向集合添加一个或多个成员</td></tr><tr><td style="text-align:left;">2</td><td style="text-align:left;">SCARD key 获取集合的成员数</td></tr><tr><td style="text-align:left;">3</td><td style="text-align:left;">SDIFF key1 key2 返回给定所有集合的差集</td></tr><tr><td style="text-align:left;">4</td><td style="text-align:left;">SDIFFSTORE destination key1 key2返回给定所有集合的差集并存储在 destination 中</td></tr><tr><td style="text-align:left;">5</td><td style="text-align:left;">SINTER key1 key2返回给定所有集合的交集</td></tr><tr><td style="text-align:left;">6</td><td style="text-align:left;">SINTERSTORE destination key1 key2 返回给定所有集合的交集并存储在 destination 中</td></tr><tr><td style="text-align:left;">7</td><td style="text-align:left;">SISMEMBER key member判断 member 元素是否是集合 key 的成员</td></tr><tr><td style="text-align:left;">8</td><td style="text-align:left;">SMEMBERS key返回集合中的所有成员</td></tr><tr><td style="text-align:left;">9</td><td style="text-align:left;">SMOVE source destination member将 member 元素从 source 集合移动到 destination 集合</td></tr><tr><td style="text-align:left;">10</td><td style="text-align:left;">SPOP key移除并返回集合中的一个随机元素</td></tr><tr><td style="text-align:left;">11</td><td style="text-align:left;">SRANDMEMBER key count 返回集合中一个或多个随机数</td></tr><tr><td style="text-align:left;">12</td><td style="text-align:left;">SREM key member1 member2移除集合中一个或多个成员</td></tr><tr><td style="text-align:left;">13</td><td style="text-align:left;">SUNION key1 key2返回所有给定集合的并集</td></tr><tr><td style="text-align:left;">14</td><td style="text-align:left;">SUNIONSTORE destination key1 key2所有给定集合的并集存储在 destination 集合中</td></tr><tr><td style="text-align:left;">15</td><td style="text-align:left;">SSCAN key cursor [MATCH pattern] [COUNT count] 迭代集合中的元素</td></tr></tbody></table><h3 id="_5-有序集合zset" tabindex="-1"><a class="header-anchor" href="#_5-有序集合zset"><span>5.有序集合Zset</span></a></h3><table><thead><tr><th style="text-align:left;">序号</th><th style="text-align:left;">命令及描述</th></tr></thead><tbody><tr><td style="text-align:left;">1</td><td style="text-align:left;">[ZADD key score1 member1 <a href="https://www.redis.net.cn/order/3609.html" target="_blank" rel="noopener noreferrer">score2 member2]</a> 向有序集合添加一个或多个成员，或者更新已存在成员的分数</td></tr><tr><td style="text-align:left;">2</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3610.html" target="_blank" rel="noopener noreferrer">ZCARD key</a> 获取有序集合的成员数</td></tr><tr><td style="text-align:left;">3</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3611.html" target="_blank" rel="noopener noreferrer">ZCOUNT key min max</a> 计算在有序集合中指定区间分数的成员数</td></tr><tr><td style="text-align:left;">4</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3612.html" target="_blank" rel="noopener noreferrer">ZINCRBY key increment member</a> 有序集合中对指定成员的分数加上增量 increment</td></tr><tr><td style="text-align:left;">5</td><td style="text-align:left;">[ZINTERSTORE destination numkeys key <a href="https://www.redis.net.cn/order/3613.html" target="_blank" rel="noopener noreferrer">key ...]</a> 计算给定的一个或多个有序集的交集并将结果集存储在新的有序集合 key 中</td></tr><tr><td style="text-align:left;">6</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3614.html" target="_blank" rel="noopener noreferrer">ZLEXCOUNT key min max</a> 在有序集合中计算指定字典区间内成员数量</td></tr><tr><td style="text-align:left;">7</td><td style="text-align:left;">[ZRANGE key start stop <a href="https://www.redis.net.cn/order/3615.html" target="_blank" rel="noopener noreferrer">WITHSCORES]</a> 通过索引区间返回有序集合成指定区间内的成员</td></tr><tr><td style="text-align:left;">8</td><td style="text-align:left;">[ZRANGEBYLEX key min max <a href="https://www.redis.net.cn/order/3616.html" target="_blank" rel="noopener noreferrer">LIMIT offset count]</a> 通过字典区间返回有序集合的成员</td></tr><tr><td style="text-align:left;">9</td><td style="text-align:left;">[ZRANGEBYSCORE key min max <a href="https://www.redis.net.cn/order/3617.html" target="_blank" rel="noopener noreferrer">WITHSCORES] [LIMIT]</a> 通过分数返回有序集合指定区间内的成员</td></tr><tr><td style="text-align:left;">10</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3618.html" target="_blank" rel="noopener noreferrer">ZRANK key member</a> 返回有序集合中指定成员的索引</td></tr><tr><td style="text-align:left;">11</td><td style="text-align:left;">[ZREM key member <a href="https://www.redis.net.cn/order/3619.html" target="_blank" rel="noopener noreferrer">member ...]</a> 移除有序集合中的一个或多个成员</td></tr><tr><td style="text-align:left;">12</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3620.html" target="_blank" rel="noopener noreferrer">ZREMRANGEBYLEX key min max</a> 移除有序集合中给定的字典区间的所有成员</td></tr><tr><td style="text-align:left;">13</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3621.html" target="_blank" rel="noopener noreferrer">ZREMRANGEBYRANK key start stop</a> 移除有序集合中给定的排名区间的所有成员</td></tr><tr><td style="text-align:left;">14</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3622.html" target="_blank" rel="noopener noreferrer">ZREMRANGEBYSCORE key min max</a> 移除有序集合中给定的分数区间的所有成员</td></tr><tr><td style="text-align:left;">15</td><td style="text-align:left;">[ZREVRANGE key start stop <a href="https://www.redis.net.cn/order/3623.html" target="_blank" rel="noopener noreferrer">WITHSCORES]</a> 返回有序集中指定区间内的成员，通过索引，分数从高到底</td></tr><tr><td style="text-align:left;">16</td><td style="text-align:left;">[ZREVRANGEBYSCORE key max min <a href="https://www.redis.net.cn/order/3624.html" target="_blank" rel="noopener noreferrer">WITHSCORES]</a> 返回有序集中指定分数区间内的成员，分数从高到低排序</td></tr><tr><td style="text-align:left;">17</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3625.html" target="_blank" rel="noopener noreferrer">ZREVRANK key member</a> 返回有序集合中指定成员的排名，有序集成员按分数值递减(从大到小)排序</td></tr><tr><td style="text-align:left;">18</td><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3626.html" target="_blank" rel="noopener noreferrer">ZSCORE key member</a> 返回有序集中，成员的分数值</td></tr><tr><td style="text-align:left;">19</td><td style="text-align:left;">[ZUNIONSTORE destination numkeys key <a href="https://www.redis.net.cn/order/3627.html" target="_blank" rel="noopener noreferrer">key ...]</a> 计算给定的一个或多个有序集的并集，并存储在新的 key 中</td></tr><tr><td style="text-align:left;">20</td><td style="text-align:left;">[ZSCAN key cursor <a href="https://www.redis.net.cn/order/3628.html" target="_blank" rel="noopener noreferrer">MATCH pattern] [COUNT count]</a> 迭代有序集合中的元素（包括元素成员和元素分值）</td></tr></tbody></table><h3 id="扩展" tabindex="-1"><a class="header-anchor" href="#扩展"><span>扩展</span></a></h3><h4 id="geo地理位置" tabindex="-1"><a class="header-anchor" href="#geo地理位置"><span>Geo地理位置</span></a></h4><h4 id="hyperloglog技术统计" tabindex="-1"><a class="header-anchor" href="#hyperloglog技术统计"><span>HyperLoglog技术统计</span></a></h4><h4 id="bloomfilter布隆过滤器" tabindex="-1"><a class="header-anchor" href="#bloomfilter布隆过滤器"><span>bloomfilter布隆过滤器</span></a></h4><h2 id="_05、redis持久化" tabindex="-1"><a class="header-anchor" href="#_05、redis持久化"><span>05、Redis持久化</span></a></h2><p>Redis 是一款基于内存的非关系型数据库，它会将数据全部存储在内存中。但是如果 Redis 服务器出现某些意外情况，比如宕机或者断电等，那么内存中的数据就会全部丢失。因此必须有<strong>一种机制能够保证 Redis 储存的数据不会因故障而丢失</strong>，这就是 Redis 的数据持久化机制。</p><p>数据的持久化存储是 Redis 的重要特性之一，它能够将内存中的数据保存到本地磁盘中，实现对数据的持久存储。这样即使在服务器发生故障之后，也能通过本地磁盘对数据进行恢复。</p><p>Redis 提供了两种持久化机制：</p><ul><li>第一种是 RDB，又称快照（snapshot）模式，（默认使用）将内存数据写入到二进制文件</li><li>第二种是 AOF 日志，也就追加模式。将修改命令写入到存储文件</li></ul><h3 id="rdb-快照模式" tabindex="-1"><a class="header-anchor" href="#rdb-快照模式"><span>RDB-快照模式</span></a></h3><p>我们知道 Redis 是单线程的，即一个线程完成客户端的并发读写，若是还要在这个进程执行备份操作（对文件进行IO读写），会严重影响性能。为此解决办法是利用<strong>多进程</strong>，备份使用子进程进行操作</p><p>RDB 实际上是 Redis 内部的一个定时器事件，它每隔一段固定时间就去检查当前数据发生改变的次数和改变的时间频率，看它们是否满足配置文件中规定的持久化触发条件。当满足条件时，Redis 就会通过操作系统调用 fork() 来创建一个子进程，该子进程与父进程享有相同的地址空间。</p><p>Redis 通过子进程遍历整个内存空间来获取存储的数据，从而完成数据持久化操作。注意，此时的主进程则仍然可以对外提供服务，父子进程之间通过操作系统的 COW 机制实现了数据段分离，从而保证了父子进程之间互不影响</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/Redis-RDB.png" alt="rdb" tabindex="0" loading="lazy"><figcaption>rdb</figcaption></figure><blockquote><p>也就是说，用一个触发机制来判断是否需要执行备份，然后备份用子进程操作（主进程继续对外提供服务不受影响）</p></blockquote><h4 id="_1-触发策略" tabindex="-1"><a class="header-anchor" href="#_1-触发策略"><span>1.触发策略</span></a></h4><p>RDB 持久化提供了两种触发策略：一种是手动触发，另一种是自动触发</p><p>配置文件定义：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 数据库备份的文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dbfilename</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dump.rdb</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 默认是：dir ./  也就是redis安装目录</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/redis-7.0.8/data</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意授权：<code>chmod 777 /data/opt/redis/data</code></p><ol><li><p><strong>手动触发</strong></p><p>手动触发是通过<code>SAVAE</code>命令或者<code>BGSAVE</code>命令将内存数据保存到磁盘文件中。如下所示</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">SAVE</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">OK</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">BGSAVE</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Background</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> saving</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> started</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;  </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">LASTSAVE</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">integer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1611298430</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述命令<code>BGSAVE</code>从后台执行数据保存操作，其可用性要优于执行 SAVE 命令</p><ul><li>SAVE 命令会阻塞 Redis 服务器进程，直到 dump.rdb 文件创建完毕为止，在这个过程中，服务器不能处理任何的命令请求。</li><li><code>BGSAVE</code>命令是非阻塞式的，所谓非阻塞式，指的是在该命令执行的过程中，并不影响 Redis 服务器处理客户端的其他请求。这是因为 Redis 服务器会 fork() 一个子进程来进行持久化操作（比如创建新的 dunp.rdb 文件），而父进程则继续处理客户端请求。当子进程处理完后会向父进程发送一个信号，通知它已经处理完毕。此时，父进程会用新的 dump.rdb 文件覆盖掉原来的旧文件。</li></ul><p>因为<code>SAVE</code>命令无需创建子进程，所以执行速度要略快于<code>BGSAVE</code>命令，但是<code>SAVE</code>命令是阻塞式的，因此其可用性欠佳，如果在数据量较少的情况下，基本上体会不到两个命令的差别，不过仍然建议您使用 <code>BGSAVE</code>命令。</p><p>注意：LASTSAVE 命令用于查看 BGSAVE 命令是否执行成功。</p></li><li><p><strong>自动触发策略</strong></p><p>自动触发策略，是指 Redis 在指定的时间内，数据发生了多少次变化时，会自动执行<code>BGSAVE</code>命令。自动触发的条件包含在了 Redis 的配置文件中，如下所示</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/Redis_RDBConf.png" alt="config" tabindex="0" loading="lazy"><figcaption>config</figcaption></figure><p>上图所示， save m n 的含义是在时间 m 秒内，如果 Redis 数据至少发生了 n 次变化，那么就自动执行<code>BGSAVE</code>命令。配置策略说明如下：</p><ul><li>save 900 1 表示在 900 秒内，至少更新了 1 条数据，Redis 自动触发 BGSAVE 命令，将数据保存到硬盘。</li><li>save 300 10 表示在 300 秒内，至少更新了 10 条数据，Redis 自动触 BGSAVE 命令，将数据保存到硬盘。</li><li>save 60 10000 表示 60 秒内，至少更新了 10000 条数据，Redis 自动触发 BGSAVE 命令，将数据保存到硬盘。</li></ul><p>只要上述三个条件任意满足一个，服务器就会自动执行<code>BGSAVE</code>命令。当然您可以根据实际情况自己调整触发策略。</p><p>注意：每次创建 RDB 文件之后，Redis 服务器为实现自动持久化而设置的时间计数和次数计数就会被清零，并重新开始计数，因此多个策略的效果不会叠加。</p></li></ol><h4 id="_2-rdb的错误处理" tabindex="-1"><a class="header-anchor" href="#_2-rdb的错误处理"><span>2.RDB的错误处理</span></a></h4><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">stop-writes-on-bgsave-error</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>后台存储发送错误时，禁止写入，默认值是yes,默认情况下，redis在后台生成的快照文件时失败，就会停止接收数据，目的是让用户能知道没有持久化功能。</p><h4 id="_3-rdb的数据压缩" tabindex="-1"><a class="header-anchor" href="#_3-rdb的数据压缩"><span>3.RDB的数据压缩</span></a></h4><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rdbcompression</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>指定存储至本地数据库时是否压缩数据，默认为yes，Redis采用LZF压缩，如果为了节省CPU时间，可以关闭该选项，但会导致数据库文件变的巨大,不建议关闭。</p><h3 id="aof-日志模式" tabindex="-1"><a class="header-anchor" href="#aof-日志模式"><span>AOF-日志模式</span></a></h3><p>AOF 被称为追加模式，或日志模式，是 Redis 提供的另一种持久化策略，它能够存储 Redis 服务器已经执行过的的命令，并且只记录对内存有过修改的命令，这种数据记录方法，被叫做“增量复制”，其默认存储文件为<code>appendonly.aof</code>。</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 过程</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Redis客户端/go/java/Python客户端</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ：发送写命令——</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">—&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Redis服务器———</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">—&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">同步写命令——</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">—&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">AOF文件</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>该文件存储了服务器执行过的所有修改命令，因此，只要服务器重新执行一次 .aof 文件，就可以实现还原数据的目的</p><h4 id="_1-实现机制-写入和重写" tabindex="-1"><a class="header-anchor" href="#_1-实现机制-写入和重写"><span>1.实现机制-写入和重写</span></a></h4><p>写入机制：</p><p>收到修改命令就会对其进行校验，没问题就会将命令追加到.aof文件中。这是一个IO操作，为了提高读写效率，会暂时将数据存储在一个内存缓冲区中，写满了才会将内容写入到磁盘。服务挂了，也可以将这个文件的命令全部执行一遍就可恢复以前的样子</p><p>重写机制：</p><p>Redis 在长期运行的过程中，aof 文件会越变越长。如果机器宕机重启，“重演”整个 aof 文件会非常耗时，导致长时间 Redis 无法对外提供服务。因此就需要对 aof 文件做一下“瘦身”运动。</p><p>为了让 aof 文件的大小控制在合理的范围内，Redis 提供了 AOF 重写机制，手动执行<code>BGREWRITEAOF</code>命令，开始重写 aof 文件，如下所示：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">127.0.0.1:6379</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">BGREWRITEAOF</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Background</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> append</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> only</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rewriting</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> started</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>通过上述操作后，服务器会生成一个新的 aof 文件，该文件具有以下特点：</p><ul><li>新的 aof 文件记录的数据库数据和原 aof 文件记录的数据库数据完全一致；</li><li>新的 aof 文件会使用尽可能少的命令来记录数据库数据，因此新的 aof 文件的体积会小很多；</li><li>AOF 重写期间，服务器不会被阻塞，它可以正常处理客户端发送的命令。</li></ul><p>下表对原有 aof 文件和新生成的 aof 文件做了对比，如下所示：</p><table><thead><tr><th>原有aof文件</th><th>重写后aof文件</th></tr></thead><tbody><tr><td>select 0</td><td>SELECT 0</td></tr><tr><td>sadd myset Jack</td><td>SADD myset Jack Helen JJ Lisa</td></tr><tr><td>sadd myset Helen</td><td>SET msg &#39;hello tarena&#39;</td></tr><tr><td>sadd myset JJ</td><td>RPUSH num 4 6 8</td></tr><tr><td>sadd myset Lisa</td><td></td></tr><tr><td>INCR number</td><td></td></tr><tr><td>INCR number</td><td></td></tr><tr><td>DEL number</td><td></td></tr><tr><td>SET message &#39;<a href="http://www.baidu.com" target="_blank" rel="noopener noreferrer">www.baidu.com</a>&#39;</td><td></td></tr><tr><td>SET message &#39;<a href="http://www.biancheng.net" target="_blank" rel="noopener noreferrer">www.biancheng.net</a>&#39;</td><td></td></tr><tr><td>RPUSH num 2 4 6</td><td></td></tr><tr><td>RPUSH num 8</td><td></td></tr><tr><td>LPOP num</td><td></td></tr></tbody></table><p>从上表可以看出，新生成的 aof 文件中，它的命令格式做了很大程度的简化。</p><p><strong>自动触发重写</strong></p><p>Redis 为自动触发 AOF 重写功能，提供了相应的配置策略。如下所示：修改 Redis 配置文件，让服务器自动执行 BGREWRITEAOF 命令。</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#默认配置项</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">auto-aof-rewrite-percentage</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 表示aof文件增量的比例来触发，100表示：文件增量大于100%才重写，即大一倍</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">auto-aof-rewrite-min-size</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 64mb</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 表示触发AOF重写的最小文件体积,大于或等于64MB自动触发。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-开启aof" tabindex="-1"><a class="header-anchor" href="#_2-开启aof"><span>2.开启AOF</span></a></h4><p><strong>AOF 机制默认处于未开启状态</strong>，可以通过修改 Redis 配置文件开启 AOF，如下所示</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># windows系统</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#修改配置文件，把no改为 yes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appendonly</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#确定存储文件名是否正确</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appendfilename</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;appendonly.aof&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#重启服务器</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-server</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --service-stop</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-server</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --service-start</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#Linux系统</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#修改配置文件：</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/redis/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appendonly</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 把 no 改为 yes</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#确定存储文件名是否正确</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appendfilename</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;appendonly.aof&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#重启服务：</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/init.d/redis-server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>提示：本节建议在您在 Linux 系统上操作 Redis，否则一些 AOF 的性能无法体现。</p><h4 id="_3-aof配置策略" tabindex="-1"><a class="header-anchor" href="#_3-aof配置策略"><span>3.AOF配置策略</span></a></h4><p>上面介绍了写机制过程中，若是遇到宕机前，缓存内的数据没能及时写入磁盘就会有丢失风险，缓存到内存的修改命令越多，丢失的数据越多。</p><p>为了数据的安全考虑，会为AOF提供了策略配置：</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/Redis_AOFConf.png" alt="aof" tabindex="0" loading="lazy"><figcaption>aof</figcaption></figure><p>策略说明：</p><ul><li>Always：服务器每写入一个命令，就调用一次 fsync 函数，将缓冲区里面的命令写入到硬盘，不会丢失任何已经完成的操作的命令数据，但是执行速度慢</li><li>Everysec（默认）：服务器每一秒调用一次 fsync 函数，服务故障最多丢失1秒的数据</li><li>No：服务器不主动调用 fsync 函数，什么情况写入磁盘由操作系统决定。丢失数量不确定，不安全</li></ul><p>注意：Linux 系统的 fsync() 函数可以将指定文件的内容从内核缓存刷到硬盘中，由于是磁盘的IO操作，所以这个很慢，每次都执行很影响性能，若是No策略很不安全不推荐，为此常用的还是1秒执行一次</p><h3 id="aof和rdb对比" tabindex="-1"><a class="header-anchor" href="#aof和rdb对比"><span>AOF和RDB对比</span></a></h3><table><thead><tr><th>RDB持久化</th><th>AOF持久化</th></tr></thead><tbody><tr><td>全量备份，一次保存整个数据库。</td><td>增量备份，一次只保存一个修改数据库的命令。</td></tr><tr><td>每次执行持久化操作的间隔时间较长。</td><td>保存的间隔默认为一秒钟（Everysec）</td></tr><tr><td>数据保存为二进制格式，其还原速度快。</td><td>使用文本格式还原数据，所以数据还原速度一般。</td></tr><tr><td>执行 SAVE 命令时会阻塞服务器，但手动或者自动触发的 BGSAVE 不会阻塞服务器</td><td>AOF持久化无论何时都不会阻塞服务器。</td></tr></tbody></table><p><strong>如果进行数据恢复时，既有 dump.rdb文件，又有 appendonly.aof 文件，您应该先通过 appendonly.aof 恢复数据，这能最大程度地保证数据的安全性。</strong></p><p><strong>这种工作方式使得Redis可以从copy-on-write机制中获益。(AOF的重写也利用了写时复制)</strong></p><p><strong>写时复制 是一种计算机程序设计领域的优化策略。核心思想是，如果有多个调用者同时要求相同资源，他们会共同获取相同的指针指向相同的资源，直到某个调用者试图修改资源的内容时，系统才会真正复制一份专用副本给该调用者，而其他调用者所见到的最初的资源仍然保持不变。这过程对其他的调用者都是透明的。此作法主要的优点是如果调用者没有修改该资源，就不会有副本被创建，因此多个调用者只是读取操作时可以共享同一份资源。</strong></p><h2 id="_06、事务" tabindex="-1"><a class="header-anchor" href="#_06、事务"><span>06、事务</span></a></h2><h2 id="_07、redis主从复制" tabindex="-1"><a class="header-anchor" href="#_07、redis主从复制"><span>07、Redis主从复制</span></a></h2><div class="hint-container tip"><p class="hint-container-title">提示</p><p>主从模式是搭建Redis集群最简单的方式！！</p><p>缺陷：</p><p>1、 不具备自动容错和恢复功能，主挂了要认为干预，而且若是数据没有同步到从也会导致数据不一致</p><p>2、只有一个主，写和存储能力受限，数据全量同步若是数据大就会出现卡顿现象</p></div><p>在软件的架构中，主从模式（Master-Slave）是使用较多的一种架构。主（Master）和从（Slave）分别部署在不同的服务器上，当主节点服务器写入数据时，同时也会将数据同步至从节点服务器，通常情况下，<strong>主节点负责写入数据，而从节点负责读取数据。</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看master/slave的关系</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> replcation</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##主从关联复制</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">savelof</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 主从复制关联</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">## 终止复制</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">saveof</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> one</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Redis的主从特点：</p><ul><li>master节点和slave节点若是断开连接，slave可自动重连，连接成功后会同步一次数据</li><li>配置好后，master负责写，slave负责读（可配置将持久化操作在slave执行）</li><li>master端同步数据是非阻塞的，即master可以处理客户端写操作，也可以同时进行同步数据</li><li>主节点的数据的清空，也会清空从slave节点的数据信息.</li></ul><h3 id="好处" tabindex="-1"><a class="header-anchor" href="#好处"><span>好处</span></a></h3><ul><li>避免Redis的单点故障（高可用还是要看哨兵模式来实现）</li><li>做到读写分离，构建读写分离架构，满足读多写少的应用场景</li></ul><h3 id="主从模式实现" tabindex="-1"><a class="header-anchor" href="#主从模式实现"><span>主从模式实现</span></a></h3><p>Redis 提供了两种实现主从模式的方法，下面进行逐一介绍。为了方便演示，我们只从一台机器上搭建主从模式。</p><h4 id="_1-命令方式" tabindex="-1"><a class="header-anchor" href="#_1-命令方式"><span>1）命令方式</span></a></h4><div class="hint-container tip"><p class="hint-container-title">提示</p><p>配置主从还是比较简单的，推荐还是用命令方式构建</p></div><p>命令语法：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-server</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">slave-por</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">t&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">--slaveof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">master-i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">p&gt; &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">master-por</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">t&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 参数</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     设置从节点的端口</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--slaveof</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  指定主节点</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 1.命令启动（启动后就是一个正常提供一个只读的Redis服务了）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-server</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6300</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --slaveof</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --masterauth</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mkxiaoer</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --requirepass</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mkxiaoer</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --daemonize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 解释：--masterauth ：连接主节点的密码，主若是设置密码，从需要密码才可连接到主   -requirepass mkxiaoer ： 访问当前redis服务密码  --daemonize：当前Redis服务以守护进程（daemon）模式运行</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-server</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 63001</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 直接启动一个redis服务这是一个独立的redis服务，可读写</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 2.执行读操作命令</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">127.0.0.1:6300</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> name</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;jack&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#不能执行写命令</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">127.0.0.1:6300</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myname</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> BangDe</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">READONLY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> You</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> can&#39;t write against a read only slave.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"># 3.将当前独立的redis服务变成一个从节点：slaveof  ip 端口</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">127.0.0.1:63001&gt; SLAVEOF 127.0.0.1 6379</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">OK</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"># 4.从改为独立Redis服务：SLAVEOF no one   （后续又可继续读写了）</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">127.0.0.1:63001&gt; SLAVEOF no one</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">OK</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>设置主从的日志：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[18160] 20 Jan 17:40:34.101 </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Server initialized #服务初始化</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[18160] 20 Jan 17:40:34.108 * Ready to accept connections </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#准备连接</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[18160] 20 Jan 17:40:34.108 * Connecting to MASTER 127.0.0.1:6379 </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#连接到主服务器</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[18160] 20 Jan 17:40:34.109 * MASTER &lt;-&gt; REPLICA sync started </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#启动副本同步</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[18160] 20 Jan 17:40:34.110 * Non blocking connect </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> SYNC fired the event.#自动触发SYNC命令，请求同步数据</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[18160] 20 Jan 17:40:34.110 * Master replied to PING, replication can continue...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[18160] 20 Jan 17:40:34.112 * Partial resynchronization not possible (</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">no</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cached</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> master</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[18160] 20 Jan 17:40:34.431 * Full resync from master: 6eb220706f73107990c2b886dbc2c12a8d0d9d05:0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[18160] 20 Jan 17:40:34.857 * MASTER &lt;-&gt; REPLICA sync: receiving 6916 bytes from master </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#从主机接受了数据，并将其存在于磁盘</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[18160] 20 Jan 17:40:34.874 * MASTER &lt;-&gt; REPLICA sync: Flushing old data </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#清空原有数据</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[18160] 20 Jan 17:40:34.874 * MASTER &lt;-&gt; REPLICA sync: Loading DB in memory </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#将磁盘中数据载入内存</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[18160] 20 Jan 17:40:34.879 * MASTER &lt;-&gt; REPLICA sync: Finished with success </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#同步数据完成</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-配置文件方式" tabindex="-1"><a class="header-anchor" href="#_2-配置文件方式"><span>2）配置文件方式</span></a></h4><p>配置就比较简单一些，直接为每一个服务创建一个xxx.conf文件然后用命令根据这个文件启动就行</p><p>新建文件Redis_6302.conf，并添加配置信息：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">slaveof</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # 指定主节点的ip和端口</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6302</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                # 指定从节点的端口</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>命令行启动Redis服务</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis-server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis_6302.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 测试</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6302</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">127.0.0.1:6300</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">HSET</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user:username</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> biangcheng</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#写入失败</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">READONLY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> You</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> can&#39;t write against a read only slave.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_08、redis哨兵" tabindex="-1"><a class="header-anchor" href="#_08、redis哨兵"><span>08、Redis哨兵</span></a></h2><div class="hint-container tip"><p class="hint-container-title">提示</p><p>高阶版的主从复制，单纯的主从存在不具备自动恢复的功能。服务宕机需要人为干预</p><p>Redis 官方推荐一种高可用方案 -- <strong>Redis Sentinel 哨兵模式</strong></p></div><h3 id="原理" tabindex="-1"><a class="header-anchor" href="#原理"><span>原理</span></a></h3><p>Sentinel 通过监控的方式获取主机的工作状态是否正常，当主机发生故障时， Sentinel 会自动进行 Failover（即故障转移），并将其监控的从机提升主服务器（master），从而保证了系统的高可用性。</p><p>哨兵模式是一种特殊的模式，Redis 为其提供了专属的哨兵命令，它是一个<strong>独立的进程</strong>，<strong>能够独立运行</strong></p><p>哨兵两个重要的作用：</p><ul><li>哨兵节点每秒会发生<strong>ping命令</strong>，通过回复<strong>判断运行状态</strong></li><li>检查到主服务故障时，<strong>自动选择一个从节点升级为主服务</strong>。使用<strong>PubSub 发布订阅模式，通知其他节点修改配文件</strong>，跟随新的主服务</li></ul><p><strong>在实际生产情况中，Redis Sentinel 是集群的高可用的保障，为避免 Sentinel 发生意外，它一般是由 3～5 个节点组成，这样就算挂了个别节点，该集群仍然可以正常运转。其结构图如下所示：</strong></p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/Redis_Sentinel.png" alt="多哨兵模式" tabindex="0" loading="lazy"><figcaption>多哨兵模式</figcaption></figure><p>上图所示，多个哨兵之间也存在互相监控，这就形成了多哨兵模式，现在对该模式的工作过程进行讲解，介绍如下：</p><h4 id="_1-主观下线" tabindex="-1"><a class="header-anchor" href="#_1-主观下线"><span>1) 主观下线</span></a></h4><p>主观下线，适用于主服务器和从服务器。如果在规定的时间内(配置参数：down-after-milliseconds)，Sentinel 节点没有收到目标服务器的有效回复，则判定该服务器为“主观下线”。比如 Sentinel1 向主服务发送了<code>PING</code>命令，在规定时间内没收到主服务器<code>PONG</code>回复，则 Sentinel1 判定主服务器为“主观下线”。</p><h4 id="_2-客观下线" tabindex="-1"><a class="header-anchor" href="#_2-客观下线"><span>2) 客观下线</span></a></h4><p>客观下线，只适用于主服务器。 Sentinel1 发现主服务器出现了故障，它会通过相应的命令，询问其它 Sentinel 节点对主服务器的状态判断。如果超过半数以上的 Sentinel 节点认为主服务器 down 掉，则 Sentinel1 节点判定主服务为“客观下线”。</p><h4 id="_3-投票选举" tabindex="-1"><a class="header-anchor" href="#_3-投票选举"><span>3) 投票选举</span></a></h4><p>投票选举，所有 Sentinel 节点会通过投票机制，按照谁发现谁去处理的原则，选举 Sentinel1 为领头节点去做 Failover（故障转移）操作。Sentinel1 节点则按照一定的规则在所有从节点中选择一个最优的作为主服务器，然后通过发布订功能通知其余的从节点（slave）更改配置文件，跟随新上任的主服务器（master）。至此就完成了主从切换的操作。</p><p>对上对述过程做简单总结：</p><blockquote><p>Sentinel 负责监控主从节点的“健康”状态。当主节点挂掉时，自动选择一个最优的从节点切换为主节点。客户端来连接 Redis 集群时，会首先连接 Sentinel，通过 Sentinel 来查询主节点的地址，然后再去连接主节点进行数据交互。当主节点发生故障时，客户端会重新向 Sentinel 要地址，Sentinel 会将最新的主节点地址告诉客户端。因此应用程序无需重启即可自动完成主从节点切换。</p></blockquote><h3 id="哨兵的配置和使用" tabindex="-1"><a class="header-anchor" href="#哨兵的配置和使用"><span>哨兵的配置和使用</span></a></h3><blockquote><p>哨兵Sentinel的使用：配置对应的Sentinel.conf文件，然后redis-sentinel或者redis-server命令去启动即可</p></blockquote><p>下面对 Sentinel 配置文件的其他配置项做简单说明：</p><table><thead><tr><th>配置项</th><th>参数类型</th><th>说明</th></tr></thead><tbody><tr><td>dir</td><td>文件目录</td><td>哨兵进程服务的文件存放目录，默认为 /tmp。</td></tr><tr><td>port</td><td>端口号</td><td>启动哨兵的进程端口号，默认为 26379。</td></tr><tr><td>sentinel down-after-milliseconds</td><td>&lt;服务名称&gt;&lt;毫秒数(整数)&gt;</td><td>在指定的毫秒数内，若主节点没有应答哨兵的 PING 命令，此时哨兵认为服务器主观下线，默认时间为 30 秒。</td></tr><tr><td>sentinel parallel-syncs</td><td>&lt;服务名称&gt;&lt;服务器数(整数)&gt;</td><td>指定可以有多少个 Redis 服务同步新的主机，一般而言，这个数字越小同步时间越长，而越大，则对网络资源要求就越高。</td></tr><tr><td>sentinel failover-timeout</td><td>&lt;服务名称&gt;&lt;毫秒数(整数)&gt;</td><td>指定故障转移允许的毫秒数，若超过这个时间，就认为故障转移执行失败，默认为 3 分钟。</td></tr><tr><td>sentinel notification-script</td><td>&lt;服务名称&gt;&lt;脚本路径&gt;</td><td>脚本通知，配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知相关人员。</td></tr><tr><td>sentinel auth-pass &lt; master-name&gt; &lt; password&gt;</td><td>&lt;服务器名称&gt;&lt;密码&gt;</td><td>若主服务器设置了密码，则哨兵必须也配置密码，否则哨兵无法对主从服务器进行监控。该密码与主服务器密码相同。</td></tr><tr><td>sentinel monitor &lt; master-name&gt; &lt; ip&gt; &lt; redis-port&gt; &lt; quorum&gt;</td><td>&lt;服务器名称&gt;&lt; ip&gt;&lt;服务端口&gt;&lt;判定人数&gt;</td><td>让sentinel 监听主服务，quorum是多少个sentinel监听到宕机才判定为宕机进行故障转移（数量根据sentinel 数量设置：一般是sentinel 数/2 + 1）</td></tr></tbody></table><h3 id="哨兵模式应用" tabindex="-1"><a class="header-anchor" href="#哨兵模式应用"><span>哨兵模式应用</span></a></h3><p>Redis Sentinel 哨兵模式适合于在 Linux 系统中使用，所以下面的应用都基于 centos实现。</p><h4 id="_1-搭建主从模式" tabindex="-1"><a class="header-anchor" href="#_1-搭建主从模式"><span>1) 搭建主从模式</span></a></h4><p>接下来，在本地环境使用主从模式搭建一个拥有三台服务器的 Redis 集群节点</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-server</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --daemonize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-server</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6300</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --slaveof</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --daemonize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-server</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6300</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --slaveof</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --daemonize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-单版本配置sentinel哨兵" tabindex="-1"><a class="header-anchor" href="#_2-单版本配置sentinel哨兵"><span>2）单版本配置sentinel哨兵</span></a></h4><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 1.编写配置文件：vim sentinel.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> monitor</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myredis</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> auth-pass</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myredis</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mkxiaoer</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 主节点宕机以后选举的间隔时间10s 单位是毫秒</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> down-after-milliseconds</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myredis</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10000</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Generated by CONFIG REWRITE</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/www/redis-7.0.8&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">protected-mode</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 26379</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">latency-tracking-info-percentiles</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 50</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 99</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 99.9</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">user</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> default</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nopass</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ~</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &amp;* +@all</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> c71c7cc530f5d800db6c78bc537c9a4764a7895f</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> config-epoch</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myredis</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> leader-epoch</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myredis</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> current-epoch</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 2. 启动哨兵即可</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./sentinel.conf</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 集群就搭建好了，然后将master直接kill掉，自动选举一个节点作为master，从新启动6379就会自动作为从节点</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-集群版本配置sentinel哨兵" tabindex="-1"><a class="header-anchor" href="#_3-集群版本配置sentinel哨兵"><span>3) 集群版本配置sentinel哨兵</span></a></h4><p>首先<strong>新建 sentinel.conf 文件</strong>，并对其进行配置</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 1.配置文件：sentinel26379.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> monitor</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myredis</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> auth-pass</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myredis</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mkxiaoer</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 主节点宕机以后选举的间隔时间10s 单位是毫秒</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> down-after-milliseconds</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myredis</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10000</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Generated by CONFIG REWRITE</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/www/redis-7.0.8&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">protected-mode</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 26379</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 2.配置文件：sentinel26380.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> monitor</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myredis</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> auth-pass</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myredis</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mkxiaoer</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 主节点宕机以后选举的间隔时间10s 单位是毫秒</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> down-after-milliseconds</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myredis</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10000</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Generated by CONFIG REWRITE</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/www/redis-7.0.8&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">protected-mode</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 26380</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 3.配置文件：sentinel26381.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> monitor</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myredis</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> auth-pass</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myredis</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mkxiaoer</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 主节点宕机以后选举的间隔时间10s 单位是毫秒</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> down-after-milliseconds</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myredis</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10000</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Generated by CONFIG REWRITE</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/www/redis-7.0.8&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">protected-mode</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 26381</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>启动哨兵</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">方式一:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sentinel.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">方式二:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sentinel.conf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --sentinel</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_09、redis集群" tabindex="-1"><a class="header-anchor" href="#_09、redis集群"><span>09、Redis集群</span></a></h2><p><strong>有哨兵为啥还有集群？</strong></p><p>上面的虽然提供高可用，但是还存在局限：<strong>没有解决数据分片，导致每个节点都有全部的数据，若是数据量大了就会受限于内容容量，还有写操作都在主节点上，很容易造成性能瓶颈</strong></p><p>进阶版的Cluster优势：数据自动分片，<strong>突破单机内存限制</strong>；每个分片是主从结构，<strong>提供高可用</strong>；多个主节点可同时处理读写，<strong>提升写性能</strong>；客户端可与任意节点通信，<strong>自动路由到正确的节点</strong>。</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>Sentinel解决的是可用性问题(Available)</p><p>Cluster解决的是扩展性问题(Scalable)</p><p>具体项目中选择哪个，还是需要结合实际需求选择。小项目读多写少Sentinel足够，大型项目有大量写就需要Cluster。不要过度设计！！！</p></div><br><h3 id="原理-1" tabindex="-1"><a class="header-anchor" href="#原理-1"><span>原理</span></a></h3><p>Redis集群是一个由多个主从节点组成的分布式服务器群，它具有复制，高可用和分片特性。Redis的集群将所有的数据存储区域划分为<strong>16384个槽（slot）</strong>。每个节点负责一部分槽。槽的信息存储于每个节点中。Redis集群要将每个节点设置成集群模式，它没有中心节点的概念，可以水平扩展，它的性能和高可用用性均优越于主从模式和哨兵模式。而且集群配置非常简单。如下图：</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/Redis_cluster.png" alt="cluster" tabindex="0" loading="lazy"><figcaption>cluster</figcaption></figure><p><strong>特点</strong></p><ol><li><strong>数据分片（Sharding）</strong>: Redis 集群采用 <strong>哈希槽（hash slot）</strong> 来划分数据。总共有 16384 个哈希槽，数据根据键的哈希值映射到不同的槽中。每个节点负责管理若干个哈希槽，因此每个节点只处理部分数据。</li><li><strong>高可用性</strong>: Redis 集群支持每个主节点有多个副本（Replica）。当主节点发生故障时，集群会自动将副本提升为新的主节点，从而保证服务的持续可用。</li><li><strong>无中心化管理</strong>: Redis 集群没有单点故障的中心节点，而是通过每个节点之间相互通信来管理集群的状态。每个节点都知道集群的拓扑结构，可以独立处理请求。</li><li><strong>自动故障转移</strong>: 如果某个主节点失败，集群会自动将其副本提升为主节点，确保数据的可用性，避免数据丢失。</li><li><strong>客户端支持</strong>: 为了保证 Redis 集群的正常运行，客户端需要能够识别节点之间的分布，并正确地发送请求。支持 Redis 集群的客户端通常会根据键的哈希值来判断请求应发送到哪个节点。</li></ol><p><strong>架构</strong></p><p>Redis 集群是由若干个 <strong>主节点（master node）</strong> 和 <strong>副本节点（replica node）</strong> 组成的，节点之间通过 Gossip 协议保持集群状态的一致性。</p><ul><li><strong>主节点</strong>：每个主节点负责若干个哈希槽，并且存储一部分数据。</li><li><strong>副本节点</strong>：每个副本节点是某个主节点的副本，负责备份主节点的数据。当主节点发生故障时，副本节点会被提升为主节点。</li></ul><h3 id="组成" tabindex="-1"><a class="header-anchor" href="#组成"><span>组成</span></a></h3><p><strong>主节点</strong>（Master）：每个主节点负责存储一定数量的哈希槽和数据。</p><p><strong>副本节点</strong>（Replica）：副本节点是主节点的复制品，用于提供数据的高可用性。当主节点不可用时，副本节点会接管其任务，保证数据不会丢失。</p><p><strong>槽（Slot）</strong>：Redis 集群的哈希槽是数据分布的基础。整个集群包含 16384 个哈希槽，每个主节点管理其中的一部分槽。</p><h3 id="部署集群" tabindex="-1"><a class="header-anchor" href="#部署集群"><span>部署集群</span></a></h3><h4 id="_1-环境准备" tabindex="-1"><a class="header-anchor" href="#_1-环境准备"><span>1）环境准备</span></a></h4><div class="hint-container tip"><p class="hint-container-title">提示</p><ul><li>主节点至少要有3个</li><li>主节点不能少于总节点的一半</li></ul></div><p>虚拟机或者服务器（linux操作系统）：安装好redis</p><p>目标：6个节点构建三主三从的集群</p><h4 id="_2-单机集群" tabindex="-1"><a class="header-anchor" href="#_2-单机集群"><span>2）单机集群</span></a></h4><blockquote><p>IP：124.220.6.62</p><p>redis的版本：7.0.8</p><p>部署集群的端口：8001、8002、8003、8004、8005、8006</p></blockquote><p>具体步骤：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 1.复制5份redis.conf文件-------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /cluster</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /cluster</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 8001</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 8002</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 8003</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 8004</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 8005</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 8006</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/redis-7.0.8/redis.conf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/redis-7.0.8/cluster/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis.conf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/redis-7.0.8/cluster/8001/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis.conf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/redis-7.0.8/cluster/8002/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis.conf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/redis-7.0.8/cluster/8003/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis.conf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/redis-7.0.8/cluster/8004/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis.conf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/redis-7.0.8/cluster/8005/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis-server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/redis-7.0.8/cluster/8006/redis.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 2.设置对应的配置文件（以8001为例）----------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ① 保护模式启动</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">daemonize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ② 修改端口</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 8001</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ③ 修改数据存储的目录，这里必须要指定不同的目录位置，否则会造成数据的丢失</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/redis-7.0.8/cluster/8001</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ④ 开启集群模式</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster-enabled</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ⑤ 集群节点信息文件，这里最好和端口保持一致</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster-config-file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes-8001.conf</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ⑥ 集群节点的超时时限，单位是毫秒</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster-node-timeout</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10000</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ⑦ 修改为主讲的ip地址，默认地址是：127.0.0.1，需要修改成其他节点计算机可以访问的ip地址，否则创建集群的时候无法访问对应节单机的端口，无法创建集群。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 本机建议设置： 本机ip</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 如果是多机设置：阿里云的内网IP或者注释掉或者bind:0.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bind</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ⑧ 受保护的模式，关闭，否则也会造成集群没办法创建成功</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">protected-mode</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ⑨ 开启aof的数据持久化</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appendonly</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ⑩ aof持久化的文件名</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appendfilename</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;appendonly8001.aof&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ⑪ aof放文件所放的位置，它是和dir一起拼接形成，比如：/www/redis-7.0.8/cluster/8001/aof/appendonly8001.aof</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appenddirname</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;aof&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ⑫ 当前服务节点的密码</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">requirepass</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mkxiaoer</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ⑬ 如果自身作为从节点以后，如果链接master节点有密码，一定要配置，建议设置密码的时候都保持一致</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">masterauth</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mkxiaoer</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 3.分别启动这6个节点 ----------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/redis-7.0.8/cluster/8001/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/redis-7.0.8/cluster/8002/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/redis-7.0.8/cluster/8003/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/redis-7.0.8/cluster/8004/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/redis-7.0.8/cluster/8005/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/redis-7.0.8/cluster/8006/redis.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 4.检查是否启动成功  -----------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ps</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -ef</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  redis</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 5.用redis-cli创建redis集群----------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --cluster</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --cluster-replicas</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8001</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  127.0.0.1:8002</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8003</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8004</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8005</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8006</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mkxiaoer</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># --cluster-replicas 1 数字表示多少个从节点</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># -a 每个节点的密码</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 6.进入任意一个节点可查看信息</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; redis-cli -c -h 127.0.0.1 -p 8001 </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; auth mkxiaoer</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; cluster info   </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#查看集群状态</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster_state:ok</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">             # 状态正常</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster_slots_assigned:16384</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster_slots_ok:16384</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster_slots_pfail:0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster_slots_fail:0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster_known_nodes:6</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 节点数量</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster_size:3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; cluster nodes   </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看节点</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">d88b17b0abb2a82dc4350e93abaebe0353228df2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8004@18004</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slave</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 6192b1d7512ec3fd4bd880cc455a47da54f4feca</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1675915939398</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connected</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">6192b1d7512ec3fd4bd880cc455a47da54f4feca</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8002@18002</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> master</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1675915938000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connected</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 5461-10922</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">。。。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 节点可以正常使用了</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 若是要关闭节点，使用命令：</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 8001</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mkxiaoer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> shutdown</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的操作正常都是可以的，但是还有一些操作比如：新增主/从节点、删除主/从节点（会涉及到hash槽的分配）</p><p><strong>1.新增主节点</strong>（加入集群，还要重新分配槽）</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 创建一个redis8007的主节点</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; cp redis.conf /www/redis-7.0.8/cluster/8007/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启动主节点8007</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; redis-server /www/redis-7.0.8/cluster/8007/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 通过add-node命令增加集群节点，这里8001做个陪衬，你可以在集群中随便找个其他的也是可以的</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; redis-cli --cluster add-node 127.0.0.1:8007 127.0.0.1:8001 -a mkxiaoer</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看集群节点</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; redis-cli -p 8001</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; auth mkxiaoer</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; cluster info</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 手动为主节点分配hash槽</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; redis-cli --cluster reshard 127.0.0.1:8007 -a mkxiaoer</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 给主节点8007分配多少个槽位，这里设定是1000</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; How many slots </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> you</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> want</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> move</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (from </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 16384</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)? 1000</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 给8007开始进行设定操作,这里的id是8007的master d0b678984c3c6f06b6c4510694d76b8381a45762</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; What is the receiving node ID? d0b678984c3c6f06b6c4510694d76b8381a45762</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; Please enter all the source node IDs.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  Type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;all&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> use</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> all</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> as</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> source</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hash</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slots.</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # all.代表将全部重新分配的hash槽位</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  Type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;done&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> once</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> you</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> entered</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> all</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> source</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IDs.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Source</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> node</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #1: all</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 输入yes开始进行重新分配hash槽，然后就会自动去调整和重新分配槽位</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; Do you want to proceed with the proposed reshard plan (</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yes/no</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)?  yes</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看是否分配成功</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; redis-cli -p 8007</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; auth mkxiaoer</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; cluster info</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; cluster nodes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">d88b17b0abb2a82dc4350e93abaebe0353228df2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8004@18004</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slave</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 6192b1d7512ec3fd4bd880cc455a47da54f4feca</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1675923474000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connected</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">6d555d82e36280900e8de704896e4b3846465655</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8001@18001</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myself,master</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1675923474000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connected</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 666-5460</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">41f8ccda22abebaa726191b765c88eae00cd3655</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8006@18006</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slave</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 6d555d82e36280900e8de704896e4b3846465655</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1675923474000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connected</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">6192b1d7512ec3fd4bd880cc455a47da54f4feca</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8002@18002</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> master</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1675923474095</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connected</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 6129-10922</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">d45cce869590400ad7dbda32a825ab0741d0e41e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8005@18005</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slave</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> e1df9acf919b9234611883d093a7ff4b687a9dee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1675923473000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connected</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">e1df9acf919b9234611883d093a7ff4b687a9dee</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8003@18003</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> master</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1675923476100</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connected</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 11589-16383</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">aced14e6f490ca573bed0042f185ce22298d6a9d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8007@18007</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> master</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1675923475097</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 7</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connected</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0-665</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 5461-6128</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10923-11588</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. 新增Redis的从节点</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 先添加一个从节点8008</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; cp redis.conf /www/redis-7.0.8/cluster/8008/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启动从节点8008</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; redis-server /www/redis-7.0.8/cluster/8008/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 把从节点8008加入到集群中</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; redis-cli --cluster add-node 127.0.0.1:8008 127.0.0.1:8001 -a mkxiaoer</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看集群节点的信息</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; redis-cli -p 8008</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看节点信息，可以得到现在8008和8007还没关系</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; cluster nodes</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 开始绑定8008和8007关系，也就是把8008变成8007的从节点</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 绑定的命令是  CLUSTER REPLICATE  id (主节点的id 8007)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 执行这个命令必须进入到8008的客户端中去执行</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; CLUSTER REPLICATE d0b678984c3c6f06b6c4510694d76b8381a45762</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看集群节点信息即可。</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; cluster nodes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">d45cce869590400ad7dbda32a825ab0741d0e41e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8005@18005</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slave</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> e1df9acf919b9234611883d093a7ff4b687a9dee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1675923789000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connected</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">aced14e6f490ca573bed0042f185ce22298d6a9d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8007@18007</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> master</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1675923789879</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 7</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connected</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0-665</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 5461-6128</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10923-11588</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">6192b1d7512ec3fd4bd880cc455a47da54f4feca</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8002@18002</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> master</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1675923787876</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connected</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 6129-10922</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">6d555d82e36280900e8de704896e4b3846465655</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8001@18001</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> master</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1675923790881</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connected</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 666-5460</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">d88b17b0abb2a82dc4350e93abaebe0353228df2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8004@18004</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slave</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 6192b1d7512ec3fd4bd880cc455a47da54f4feca</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1675923791883</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connected</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">64ab4eb42ae02de188270c114d41d83006122a91</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8008@18008</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> myself,slave</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> aced14e6f490ca573bed0042f185ce22298d6a9d</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1675923791000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 7</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connected</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">e1df9acf919b9234611883d093a7ff4b687a9dee</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8003@18003</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> master</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1675923791000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connected</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 11589-16383</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">41f8ccda22abebaa726191b765c88eae00cd3655</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:8006@18006</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slave</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 6d555d82e36280900e8de704896e4b3846465655</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1675923790000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connected</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3.删除从节点8008</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; redis-cli --cluster del-node 127.0.0.1:8008 bf396950d13769ba4fd4bc5bf4ce7185d24b27e5 -a mkxiaoer</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>4.删除主节点</strong>（先移除数据，再删除主节点）</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 重新把8007的占用hash槽进行释放或者说把数据进行迁移，然后在删除</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;  redis-cli --cluster reshard 127.0.0.1:8007 -a mkxiaoer --cluster-from d0b678984c3c6f06b6c4510694d76b8381a45762</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">How</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> many</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slots</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> do</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> you</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> want</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> move</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (from </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 16384</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)? 1000</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># aced14e6f490ca573bed0042f185ce22298d6a9d这里的id是别的masterid</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">What</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> is</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> receiving</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> node</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ID?</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> aced14e6f490ca573bed0042f185ce22298d6a9d</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Please</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enter</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> all</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> source</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> node</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IDs.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  Type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;all&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> use</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> all</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> as</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> source</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hash</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slots.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  Type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;done&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> once</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> you</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> entered</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> all</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> source</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IDs.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Source</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> node</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #1: all</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; Do you want to proceed with the proposed reshard plan (</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yes/no</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)?  yes</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; 然后就会自动去调整和重新分配槽位</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 完整写法,可以取代上面的步骤</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#&gt;redis-cli --cluster reshard 192.168.116.175:8007 --cluster-from d0b678984c3c6f06b6c4510694d76b8381a45762 --cluster-to 60e3755761c9cbdacb183f59e3d6205da5335e86 --cluster-slots 1000 --cluster-yes</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 然后在执行删除即可</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;  redis-cli --cluster del-node 127.0.0.1:8007 d0b678984c3c6f06b6c4510694d76b8381a45762 -a mkxiaoer</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-多机集群" tabindex="-1"><a class="header-anchor" href="#_3-多机集群"><span>3）多机集群</span></a></h4><blockquote><p>单机集群：同一个ip，只能使用不同的端口隔离</p><p>多机集群：有不同的ip了，端口就可以一样了</p><p>两者配置就这个区别，使用的时候还是多计部署</p></blockquote><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h2><div class="hint-container tip"><p class="hint-container-title">提示</p><p>这里参考一下小白Debug的思路来捋一遍Redis</p></div><p>问：</p><p>一个商品服务，对外可提供每秒10K次查询，而数据库只能提供每秒5K次查询，上线MySQL会直接崩溃，比如秒杀活动啥的，怎么样才能让MySQL不被压块的同时商品服务又能支持每秒10K次查询呢？</p><p>解：</p><p>加一个中间层：将数据缓存到内存中去来抵挡大部分的查询请求</p><h2 id="优化" tabindex="-1"><a class="header-anchor" href="#优化"><span>优化</span></a></h2><p>数据不一致问题怎么处理？</p><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><blockquote><p>上面这个时序图中，服务1因为网络延迟造成将redis已经缓存了新的数据覆盖了旧数据，导致redis数据和数据库数据不一致</p></blockquote><p>对于这种缓存管理，一般做法是在写完数据库后，删除或更新缓存数据。虽然是两个步骤非原子操作可能会存在时间误差，但是这个时间差很小，影响并不大。正常情况下是可以。关键是需要考虑其中缓存服务crash掉了，就是数据库写入操作了，但是准备写入缓存时缓存挂了，会导致数据不一致问题</p><p>方案一：设置较短的缓存时间</p><p>缓存将数据过期时间设置一个比较短的事件，比如设定一分钟，然后每分钟去生成需要被查询的缓存数据。</p><p>实现简单，但是并发量高的情况下，会出现大量数据不一致</p><p>方案二：使用消息队列（或者订阅binlog）</p><p>并发量高而且对于数据一致性要求高，就可以在修改完数据库，发生一条更新缓存的消息，在消费端将获取到的消息将缓存数据更新</p><p>可以保证数据的一致性，但是框架会变笨重，需要另外维护一个消息队列</p><p>方案三：dtm 二阶段消息</p><p>DTM（Distributed Transaction Manager，分布式事务管理器）是一种用于处理分布式事务的工具，DTM会将复杂业务进行拆分多个独立的步骤，每一个步骤通过消息队列来协调，确保要么全部成功要么全部失败</p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/Cospk/edit/main/src/middleware/数据库/Redis.md" aria-label="在 GitHub 上编辑此页" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><span class="vp-meta-info" data-allow-mismatch="text">2025/3/18 03:55:25</span></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: xie18115@gmail.com">xiaoxie01</span>,<!--]--><!--[--><span class="vp-meta-info" title="email: xie18115@outlook.com">xiaoxie001</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/vuepress-app/middleware/%E6%95%B0%E6%8D%AE%E5%BA%93/MYSQL%E9%AB%98%E7%BA%A7.html" aria-label="MySQL高级"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->MySQL高级</div></a><a class="route-link auto-link next" href="/vuepress-app/middleware/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis-Go.html" aria-label="Redis - Go"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">Redis - Go<!----></div></a></nav><div id="comment" class="giscus-wrapper input-top vp-comment" vp-comment style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">默认页脚</div><div class="vp-copyright">Copyright © 2025 xiaoxie </div></footer></div><!--]--><!--[--><!----><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/vuepress-app/assets/app-CG6bgqhH.js" defer></script>
  </body>
</html>
