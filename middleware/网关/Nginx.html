<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.66" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://Cospk.github.io/vuepress-app/middleware/%E7%BD%91%E5%85%B3/Nginx.html"><meta property="og:site_name" content="Golangå…¨æ ˆæŒ‡å—"><meta property="og:title" content="Nginx"><meta property="og:description" content="01ï¼šNginxçš„æ¦‚è¿° ä»€ä¹ˆæ˜¯Nginx Nginx (engine x) æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„HTTPå’Œåå‘ä»£ç†webæœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†IMAP/POP3/SMTPæœåŠ¡ã€‚Nginxæ˜¯ç”±ä¼Šæˆˆå°”Â·èµ›ç´¢è€¶å¤«ä¸ºä¿„ç½—æ–¯è®¿é—®é‡ç¬¬äºŒçš„Rambler.ruç«™ç‚¹ï¼ˆä¿„æ–‡ï¼šĞ Ğ°Ğ¼Ğ±Ğ»ĞµÑ€ï¼‰å¼€å‘çš„ï¼Œç¬¬ä¸€ä¸ªå…¬å¼€ç‰ˆæœ¬0.1.0å‘å¸ƒäº2004å¹´10æœˆ4æ—¥ã€‚å…¶å°†æºä»£ç ä»¥ç±»BSDè®¸å¯è¯çš„..."><meta property="og:type" content="article"><meta property="og:image" content="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_cmdConfig.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-01-17T08:43:17.000Z"><meta property="article:author" content="xiaoxie"><meta property="article:tag" content="web"><meta property="article:published_time" content="2020-01-01T00:00:00.000Z"><meta property="article:modified_time" content="2025-01-17T08:43:17.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Nginx","image":["https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_cmdConfig.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_webShow.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_reqWork.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_process.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_process.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workHandle1.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workerHandle2.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_configAnalyse.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_confLocation.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workLeakyBycket.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workTokenBucket.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_burstTest1.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_burstTest2.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_burstTest4.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_burstTest3.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workPoll.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workWeight.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workIp_hash.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workOnlyhash.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workHash.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workHashAddRedis2.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workHashAddRedis.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workHashMoreNode.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workHash11.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_log1.png","https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_cronTime.png"],"datePublished":"2020-01-01T00:00:00.000Z","dateModified":"2025-01-17T08:43:17.000Z","author":[{"@type":"Person","name":"xiaoxie"}]}</script><link rel="icon" href="/vuepress-app/favicon.svg"><title>Nginx | Golangå…¨æ ˆæŒ‡å—</title><meta name="description" content="01ï¼šNginxçš„æ¦‚è¿° ä»€ä¹ˆæ˜¯Nginx Nginx (engine x) æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„HTTPå’Œåå‘ä»£ç†webæœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†IMAP/POP3/SMTPæœåŠ¡ã€‚Nginxæ˜¯ç”±ä¼Šæˆˆå°”Â·èµ›ç´¢è€¶å¤«ä¸ºä¿„ç½—æ–¯è®¿é—®é‡ç¬¬äºŒçš„Rambler.ruç«™ç‚¹ï¼ˆä¿„æ–‡ï¼šĞ Ğ°Ğ¼Ğ±Ğ»ĞµÑ€ï¼‰å¼€å‘çš„ï¼Œç¬¬ä¸€ä¸ªå…¬å¼€ç‰ˆæœ¬0.1.0å‘å¸ƒäº2004å¹´10æœˆ4æ—¥ã€‚å…¶å°†æºä»£ç ä»¥ç±»BSDè®¸å¯è¯çš„...">
    <link rel="preload" href="/vuepress-app/assets/style-BU0LSV_n.css" as="style"><link rel="stylesheet" href="/vuepress-app/assets/style-BU0LSV_n.css">
    <link rel="modulepreload" href="/vuepress-app/assets/app-DQYOo4w9.js"><link rel="modulepreload" href="/vuepress-app/assets/Nginx.html-BI19ILNl.js"><link rel="modulepreload" href="/vuepress-app/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/vuepress-app/assets/index.html-Bq9MNSz2.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/portfolio.html-C9vd2iYI.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/0.ç®—æ³•.html-BsV8S2Wg.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/1.è®¾è®¡æ¨¡å¼.html-bhxLxCAs.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/2.è§„åˆ’.html-B5JbR9-L.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/git è§„èŒƒ.html-m7DlSQoP.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/git.html-C76kn7AX.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/markdown.html-Be_xkytZ.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/å¥½ç‰©åˆ†äº«.html-C2tU1nSh.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-CTFGs-0H.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/best-practice-template.html-Dt0hQKJl.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/reference-template.html-CcesZ-Mz.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/tutorial-template.html-BD6odeNr.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/writing-standards.html-CnpuedpE.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-BIUN8mS4.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Consul.html-ypH9sOU5.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Docker.html-C_U3DNy3.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/GRPC.html-D2TssE-K.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Jaeger.html-DHz90PJ7.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Kong.html-DjTh477r.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Kubernetes.html-BlD0Nqyi.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Nacos.html-e6_45abc.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-VO_t89YX.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Sentinel.html-CVnl73Ku.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-CNenjjax.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-D5OD_qKx.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-CFl_ATjb.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-BxkpNptR.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/ç½‘ç»œåŸºç¡€.html-pu8vwn_T.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/0.use.html-CfMisZU1.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/1.howWork.html-DgEaSCRA.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-Dyy8G6ZQ.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-C5Svu_eg.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-0vjuHYHm.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/å¸¸ç”¨åŒ…å¤§å…¨.html-BQN9YvtN.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/0.golang.html-B_JYTGSH.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/1.grammer.html-CsPEYxCL.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/2.datatype.html-BH4Ml37S.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/3.variable.html-B90UEIQi.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/4.io.html-Bju1j1jL.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/5.condition.html-5h6OTfKN.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/6.data_structures.html-DoA8gbWj.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-QPnz86r3.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/1.interface.html-DDko-z1n.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/10.cgo.html-BKZiZF-c.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/11.pprof.html-Ce9KGqfC.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/12.followUp.html-BtKg-iCC.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/2.generic.html-CLJ2QgjI.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/3.reflect.html-vFpH0lKf.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/4.types.html-CJX8dONg.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/5.error.html-VPqeP6bi.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/6.file.html-DgvofgAa.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/7.concurrency.html-CCYBeVx3.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/8.module.html-BzIOd2ug.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/9.test.html-CeXabG2D.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-ukXCqO1W.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/notes.html-9U7wAkg-.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/test.html-DbilgyP7.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/1.åŸºç¡€è¯­æ³•.html-CB-s2QB7.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/2.è¿›é˜¶åŸç†.html-jJ9Zdgt8.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-ZFD_7V5B.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/å¤§å‚é¢è¯•é¢˜.html-BiTn2atu.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/å¯¹è±¡æ± .html-BIApuYi9.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/ææ™ºå¤©ä¸‹.html-D4mdFBFg.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/é¢è¯•é¢˜ï¼ˆç­”æ¡ˆï¼‰.html-Csy0Gm5Y.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Elasticsearch-Go.html-DirDboAX.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Elasticsearch.html-C8tjH4KF.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/MYSQLé«˜çº§.html-BOW6RzPT.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/MongoDB-Go.html-DznIYwFX.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/MongoDB.html-BOc3_Uam.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/MySQL-Go.html-jpQgr9F3.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/MySQL.html-BK1QahBY.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-BaaPnG11.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Redis-Go.html-DWlPgEIJ.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Redis.html-Cocy24z-.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/EMQX.html-BrHaH0Uq.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Kafka1.html-CD_t0HV6.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Kafka_go.html-0gFzomqN.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-DoJPehhd.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/RocketMQ.html-BY_r2R6n.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/kafka.html-CE42OsD7.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Kong.html-DJkutvLP.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-igav78_2.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Docker-Do.html-DDxs1I81.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Docker.html-BlRm7-mA.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Jenkins.html-tq-09bf0.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Kubernetes.html-DT34aKIS.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-B10aH5wi.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/kubernetes-Do.html-ERikGt2s.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/casbin.html-Czi4U67b.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/0.use.html-kMfrPotv.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/1.howWork.html-BzrVfbaB.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-rLPBiOE3.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/0.use.html-DeGb1zlm.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/1.howWork.html-FpY9OfV5.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-CjDLtBS7.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-C0MUljVr.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/Zap.html-BsV4g4b5.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/ç”¨æˆ·è®¤è¯é€‰å‹.html-DpWBNfDq.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/ç›‘æ§.html-BDPotiH8.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/0.intro.html-DD7GIQxk.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-CFayQQCz.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/encode.html-B_I9pEXw.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/flag.html-Swa14T6M.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/http.html-CQ4D3-Nc.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/log.html-DoTexK_9.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/math.html-Ch-wNTCo.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/net.html-G_QhQdER.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/sort.html-DPD9KUv-.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/strconv.html-CySvdvKH.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/strings.html-DsDpWsX-.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/template.html-D4NF18am.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/time.html-DH1aeA8E.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/unicode.html-dx66HmoG.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/unsafe.html-DY_TKgua.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/0.runtime.html-DZunUCQu.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/1.å¹¶å‘.html-BNfelWDP.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/2.æ•°æ®ç»“æ„.html-C0tQxDMK.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/3.é”™è¯¯å¤„ç†.html-CtuPAaWX.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-DycUC3jb.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/404.html-BptzO3_T.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-DfUfJhey.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-A9-F7S4l.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-6XH2rexj.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-C56bMAZY.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-BW4wWYpa.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index.html-B0AXn7D5.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/flowchart-CTwbLKUk.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index-izhIXQi-.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index-DRWmbcXV.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/index-B2Pezylg.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/mermaid.esm.min-6kSgWElv.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/photoswipe.esm-GXRgw7eJ.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/giscus-BZxmVUME.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/SearchResult-BCPSlQi-.js" as="script"><link rel="prefetch" href="/vuepress-app/assets/setupDevtools-7MC2TMWH-CQ-TIP8f.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/vuepress-app/" aria-label="å¸¦æˆ‘å›å®¶"><img class="vp-nav-logo light" src="/vuepress-app/log.svg" alt><img class="vp-nav-logo dark" src="/vuepress-app/logDark.svg" alt><span class="vp-site-name hide-in-pad">Golangå…¨æ ˆæŒ‡å—</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/vuepress-app/" aria-label="é¦–é¡µ"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->é¦–é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="golang"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>golang<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/golang/%E5%9F%BA%E7%A1%80/" aria-label="GoåŸºç¡€"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-eraser" style=""></span><!--]-->GoåŸºç¡€<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/golang/%E8%BF%9B%E9%98%B6/" aria-label="Goè¿›é˜¶"><!--[--><img class="icon" src="/vuepress-app/assets/icon/up.png" alt aria-hidden no-view style=""><!--]-->Goè¿›é˜¶<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/golang/%E5%8E%9F%E7%90%86/" aria-label="åŸç†"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-gears" style=""></span><!--]-->åŸç†<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/golang/web%E6%A1%86%E6%9E%B6/" aria-label="æ¡†æ¶"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-sitemap" style=""></span><!--]-->æ¡†æ¶<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/golang/%E9%9D%A2%E8%AF%95/" aria-label="é¢è¯•"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-feather" style=""></span><!--]-->é¢è¯•<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="ä¸­é—´ä»¶"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-layer-group" style=""></span>ä¸­é—´ä»¶<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/middleware/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html" aria-label="MySql"><!--[--><img class="icon" src="/vuepress-app/assets/icon/mysql.png" alt aria-hidden no-view style=""><!--]-->MySql<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/middleware/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis.html" aria-label="Redis"><!--[--><img class="icon" src="/vuepress-app/assets/icon/redis.png" alt aria-hidden no-view style=""><!--]-->Redis<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/middleware/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB.html" aria-label="MongoDB"><!--[--><img class="icon" src="/vuepress-app/assets/icon/mongodb.png" alt aria-hidden no-view style=""><!--]-->MongoDB<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/middleware/%E6%B6%88%E6%81%AF%E7%BB%84%E4%BB%B6/kafka.html" aria-label="kafka"><!--[--><img class="icon" src="/vuepress-app/assets/icon/Kafka.png" alt aria-hidden no-view style=""><!--]-->kafka<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/vuepress-app/middleware/%E7%BD%91%E5%85%B3/Nginx.html" aria-label="Nginx"><!--[--><img class="icon" src="/vuepress-app/assets/icon/Nginx.png" alt aria-hidden no-view style=""><!--]-->Nginx<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/middleware/%E8%BF%90%E7%BB%B4/Docker.html" aria-label="Docker"><!--[--><img class="icon" src="/vuepress-app/assets/icon/docker.png" alt aria-hidden no-view style=""><!--]-->Docker<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/middleware/%E8%BF%90%E7%BB%B4/Kubernetes.html" aria-label="Kubernetes"><!--[--><img class="icon" src="/vuepress-app/assets/icon/kubernetes.png" alt aria-hidden no-view style=""><!--]-->Kubernetes<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ¶æ„"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-network-wired" style=""></span>æ¶æ„<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/framework/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" aria-label="å¾®æœåŠ¡"><!--[--><img class="icon" src="/vuepress-app/assets/icon/micro.png" alt aria-hidden no-view style=""><!--]-->å¾®æœåŠ¡<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/framework/%E5%88%86%E5%B8%83%E5%BC%8F/" aria-label="åˆ†å¸ƒå¼"><!--[--><img class="icon" src="/vuepress-app/assets/icon/kubernetes.png" alt aria-hidden no-view style=""><!--]-->åˆ†å¸ƒå¼<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/framework/%E9%AB%98%E5%8F%AF%E7%94%A8/" aria-label="é«˜å¯ç”¨"><!--[--><img class="icon" src="/vuepress-app/assets/icon/available.png" alt aria-hidden no-view style=""><!--]-->é«˜å¯ç”¨<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/framework/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8/" aria-label="é¢†åŸŸé©±åŠ¨"><!--[--><img class="icon" src="/vuepress-app/assets/icon/DDD.png" alt aria-hidden no-view style=""><!--]-->é¢†åŸŸé©±åŠ¨<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="è®¡ç®—æœº"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-computer" style=""></span>è®¡ç®—æœº<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/computer/%E7%BD%91%E7%BB%9C/" aria-label="è®¡ç®—æœºç½‘ç»œ"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-globe" style=""></span><!--]-->è®¡ç®—æœºç½‘ç»œ<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/computer/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" aria-label="æ“ä½œç³»ç»Ÿ"><!--[--><img class="icon" src="/vuepress-app/assets/icon/linux.png" alt aria-hidden no-view style=""><!--]-->æ“ä½œç³»ç»Ÿ<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/computer/0.%E7%AE%97%E6%B3%95.html" aria-label="å¸¸ç”¨ç®—æ³•"><!--[--><img class="icon" src="/vuepress-app/assets/icon/arithmetic.png" alt aria-hidden no-view style=""><!--]-->å¸¸ç”¨ç®—æ³•<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/computer/1.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html" aria-label="è®¾è®¡æ¨¡å¼"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-pen-ruler" style=""></span><!--]-->è®¾è®¡æ¨¡å¼<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="å¥½ç‰©åˆ†äº«"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-share-nodes" style=""></span>å¥½ç‰©åˆ†äº«<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/share/%E5%A5%BD%E7%89%A9%E5%88%86%E4%BA%AB.html" aria-label="å¥½ç‰©åˆ†äº«"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-share-nodes" style=""></span><!--]-->å¥½ç‰©åˆ†äº«<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/vuepress-app/share/git.html" aria-label="git"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-git-alt" style=""></span><!--]-->git<!----></a></li></ul></button></div></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/Cospk" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="slimsearch-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="slimsearch-placeholder">æœç´¢</div><div class="slimsearch-key-hints"><kbd class="slimsearch-key">Ctrl</kbd><kbd class="slimsearch-key">K</kbd></div></button><!--]--><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-database" style=""></span><span class="vp-sidebar-title">æ•°æ®åº“æŠ€æœ¯é€‰å‹ä¸æœ€ä½³å®è·µ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><img class="icon" src="/vuepress-app/assets/icon/MQ.png" alt aria-hidden no-view style=""><span class="vp-sidebar-title">æ¶ˆæ¯ç»„ä»¶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><img class="icon" src="/vuepress-app/assets/icon/network.png" alt aria-hidden no-view style=""><span class="vp-sidebar-title">ç½‘å…³</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/vuepress-app/middleware/%E7%BD%91%E5%85%B3/Nginx.html" aria-label="Nginx"><!---->Nginx<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/vuepress-app/middleware/%E7%BD%91%E5%85%B3/Kong.html" aria-label="Kong"><!---->Kong<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><img class="icon" src="/vuepress-app/assets/icon/docker.png" alt aria-hidden no-view style=""><span class="vp-sidebar-title">è¿ç»´</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">é‰´æƒ</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Nginx</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">xiaoxie</span></span><span property="author" content="xiaoxie"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2020å¹´1æœˆ1æ—¥</span><meta property="datePublished" content="2020-01-01T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 50 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT50M"></span><!----><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color3" role>web</span><!--]--><meta property="keywords" content="web"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc" vp-toc><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_01-nginxçš„æ¦‚è¿°">01ï¼šNginxçš„æ¦‚è¿°</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯nginx">ä»€ä¹ˆæ˜¯Nginx</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¸¸è§çš„æœåŠ¡å™¨">å¸¸è§çš„æœåŠ¡å™¨</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_02-nginxçš„å®‰è£…">02ï¼šNginxçš„å®‰è£…</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_01ã€åˆ›å»ºnginxæœåŠ¡å™¨ç›®å½•">01ã€åˆ›å»ºnginxæœåŠ¡å™¨ç›®å½•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_02ã€ä¸‹è½½å®‰è£…">02ã€ä¸‹è½½å®‰è£…</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_03ã€å®‰è£…ç¼–è¯‘å·¥å…·åŠåº“æ–‡ä»¶">03ã€å®‰è£…ç¼–è¯‘å·¥å…·åŠåº“æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_04ã€è§£å‹nginx">04ã€è§£å‹nginx</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_05ã€åˆ›å»ºnginxçš„ä¸´æ—¶ç›®å½•">05ã€åˆ›å»ºnginxçš„ä¸´æ—¶ç›®å½•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_06ã€è¿›å…¥å®‰è£…åŒ…ç›®å½•">06ã€è¿›å…¥å®‰è£…åŒ…ç›®å½•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_07ã€é…ç½®nginxçš„å®‰è£…è·¯å¾„">07ã€é…ç½®nginxçš„å®‰è£…è·¯å¾„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_08ã€-makeç¼–è¯‘">08ã€ makeç¼–è¯‘</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_09ã€-å®‰è£…">09ã€ å®‰è£…</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_10ã€-è¿›å…¥sbinç›®å½•å¯åŠ¨nginx">10ã€ è¿›å…¥sbinç›®å½•å¯åŠ¨nginx</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_11ã€æ‰“å¼€æµè§ˆå™¨-è®¿é—®è™šæ‹Ÿæœºæ‰€å¤„å†…ç½‘ipå³å¯æ‰“å¼€nginxé»˜è®¤é¡µé¢-æ˜¾ç¤ºå¦‚ä¸‹ä¾¿è¡¨ç¤ºå®‰è£…æˆåŠŸ">11ã€æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®è™šæ‹Ÿæœºæ‰€å¤„å†…ç½‘ipå³å¯æ‰“å¼€nginxé»˜è®¤é¡µé¢ï¼Œæ˜¾ç¤ºå¦‚ä¸‹ä¾¿è¡¨ç¤ºå®‰è£…æˆåŠŸï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_12ã€æ³¨æ„äº‹é¡¹">12ã€æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_13ã€é…ç½®nginxçš„ç¯å¢ƒå˜é‡">13ã€é…ç½®nginxçš„ç¯å¢ƒå˜é‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_14ã€åŠ è½½é»˜è®¤é¡µé¢">14ã€åŠ è½½é»˜è®¤é¡µé¢</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_03-nginxçš„è¿›ç¨‹ç»“æ„">03ï¼šNginxçš„è¿›ç¨‹ç»“æ„</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nginxçš„è¿›ç¨‹æ¨¡å‹">Nginxçš„è¿›ç¨‹æ¨¡å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nginxçš„workeræŠ¢å æœºåˆ¶">Nginxçš„workeræŠ¢å æœºåˆ¶</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_04ã€nginx-confé…ç½®æ–‡ä»¶åˆ†æ">04ã€Nginx.confé…ç½®æ–‡ä»¶åˆ†æ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nginx-confé…ç½®æ–‡ä»¶åˆ†æ">Nginx.confé…ç½®æ–‡ä»¶åˆ†æ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nginxå¤–éƒ¨é…ç½®æ–‡ä»¶include-åŒ…å«">Nginxå¤–éƒ¨é…ç½®æ–‡ä»¶include åŒ…å«</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æŸ¥çœ‹nginxçš„é…ç½®">æŸ¥çœ‹Nginxçš„é…ç½®</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_05-nginxå…³äºrootå’Œalias">05ï¼šNginxå…³äºrootå’Œalias</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_01ã€ä¸Šä¼ é™æ€èµ„æºåˆ°æœåŠ¡å™¨">01ã€ä¸Šä¼ é™æ€èµ„æºåˆ°æœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_02ã€æ‰“å¼€yykk-confæ–‡ä»¶">02ã€æ‰“å¼€yykk.confæ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_03ã€éªŒè¯å’Œé‡å¯nginx">03ã€éªŒè¯å’Œé‡å¯nginx</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_04ã€ç„¶åè®¿é—®nginxçš„é™æ€èµ„æºæœåŠ¡å™¨">04ã€ç„¶åè®¿é—®nginxçš„é™æ€èµ„æºæœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_05ã€aliasä¸rootçš„åŒºåˆ«">05ã€aliasä¸rootçš„åŒºåˆ«</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_06-nginxå…³äºlocation">06ï¼šNginxå…³äºLocation</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_01ã€é»˜è®¤åŒ¹é…è§„åˆ™">01ã€é»˜è®¤åŒ¹é…è§„åˆ™</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_02ã€ç²¾å‡†åŒ¹é…è§„åˆ™">02ã€ç²¾å‡†åŒ¹é…è§„åˆ™</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_03ã€æ­£åˆ™åŒ¹é…è§„åˆ™">03ã€æ­£åˆ™åŒ¹é…è§„åˆ™</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_04ã€ä»¥æŸç§å­—ç¬¦ä¸²å¼€å¤´çš„åŒ¹é…è§„åˆ™">04ã€ä»¥æŸç§å­—ç¬¦ä¸²å¼€å¤´çš„åŒ¹é…è§„åˆ™</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_07-nginxçš„é™æµ">07ï¼šNginxçš„é™æµ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1ã€æ¼æ¡¶ç®—æ³•-é™åˆ¶è¯·æ±‚æ¬¡æ•°">1ã€æ¼æ¡¶ç®—æ³•ï¼ˆé™åˆ¶è¯·æ±‚æ¬¡æ•°ï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2ã€ä»¤ç‰Œæ¡¶ç®—æ³•-é™åˆ¶è¯·æ±‚é€Ÿåº¦">2ã€ä»¤ç‰Œæ¡¶ç®—æ³•ï¼ˆé™åˆ¶è¯·æ±‚é€Ÿåº¦ï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3ã€è®¡æ•°å™¨-é™åˆ¶è¿æ¥æ•°">3ã€è®¡æ•°å™¨ï¼ˆé™åˆ¶è¿æ¥æ•°ï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4ã€ä¸¤ç§ç®—æ³•çš„åŒºåˆ«">4ã€ä¸¤ç§ç®—æ³•çš„åŒºåˆ«</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5ã€nginxå®˜æ–¹ç‰ˆæœ¬é™åˆ¶ipçš„è¿æ¥å’Œå¹¶å‘åˆ†åˆ«æœ‰ä¸¤ä¸ªæ¨¡å—">5ã€Nginxå®˜æ–¹ç‰ˆæœ¬é™åˆ¶IPçš„è¿æ¥å’Œå¹¶å‘åˆ†åˆ«æœ‰ä¸¤ä¸ªæ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6ã€nginxé™æµå®æˆ˜">6ã€Nginxé™æµå®æˆ˜</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_08-nginxçš„è´Ÿè½½å‡è¡¡-upstream">08ï¼šNginxçš„è´Ÿè½½å‡è¡¡&amp;upstream</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç›®æ ‡">ç›®æ ‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_01ã€è½®è¯¢">01ã€ğŸŒŸè½®è¯¢</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_02ã€weight-é‡é‡-æƒé‡-åŠ æƒè½®è¯¢">02ã€ğŸŒŸweight(é‡é‡ï¼Œæƒé‡ï¼ŒåŠ æƒè½®è¯¢)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_03ã€upstream">03ã€upStream</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_04ã€ip-hash">04ã€ip_hash</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_05ã€ä¸€è‡´æ€§hash">05ã€ä¸€è‡´æ€§hash</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_06ã€url-hash-ç»†ç²’åº¦çš„è´Ÿè½½å‡è¡¡">06ã€url_hash(ç»†ç²’åº¦çš„è´Ÿè½½å‡è¡¡)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_07ã€least-conn">07ã€least_conn</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_08ã€fair-æ”¶è´¹">08ã€fair (æ”¶è´¹)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_09ã€æ€»ç»“">09ã€æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_09ã€æ‚é¡¹">09ã€æ‚é¡¹</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1ã€nginxå¯åŠ¨å¤±è´¥æ‰¾ä¸åˆ°-pidæ–‡ä»¶å¦‚ä½•å¤„ç†">1ã€Nginxå¯åŠ¨å¤±è´¥æ‰¾ä¸åˆ° pidæ–‡ä»¶å¦‚ä½•å¤„ç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2ã€ä¼˜é›…çš„å…³é—­nginxæœåŠ¡">2ã€ä¼˜é›…çš„å…³é—­nginxæœåŠ¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3ã€æŸ¥çœ‹nginxçš„é…ç½®">3ã€æŸ¥çœ‹Nginxçš„é…ç½®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4ã€nginxæ—¥å¿—æ–‡ä»¶åˆ†å‰²">4ã€Nginxæ—¥å¿—æ–‡ä»¶åˆ†å‰²</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5ã€nginxçš„æ—¥å¿—æ–‡ä»¶è‡ªåŠ¨åˆ‡å‰²">5ã€Nginxçš„æ—¥å¿—æ–‡ä»¶è‡ªåŠ¨åˆ‡å‰²</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content" vp-content><br><br><h2 id="_01-nginxçš„æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#_01-nginxçš„æ¦‚è¿°"><span>01ï¼šNginxçš„æ¦‚è¿°</span></a></h2><br><h3 id="ä»€ä¹ˆæ˜¯nginx" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯nginx"><span>ä»€ä¹ˆæ˜¯Nginx</span></a></h3><br><ul><li><p><em>Nginx</em> (engine x) æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„<a href="https://baike.baidu.com/item/HTTP" target="_blank" rel="noopener noreferrer">HTTP</a>å’Œ<a href="https://baike.baidu.com/item/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/7793488" target="_blank" rel="noopener noreferrer">åå‘ä»£ç†</a>webæœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†IMAP/POP3/SMTPæœåŠ¡ã€‚Nginxæ˜¯ç”±ä¼Šæˆˆå°”Â·èµ›ç´¢è€¶å¤«ä¸º<a href="https://baike.baidu.com/item/%E4%BF%84%E7%BD%97%E6%96%AF/125568" target="_blank" rel="noopener noreferrer">ä¿„ç½—æ–¯</a>è®¿é—®é‡ç¬¬äºŒçš„Rambler.ruç«™ç‚¹ï¼ˆä¿„æ–‡ï¼šĞ Ğ°Ğ¼Ğ±Ğ»ĞµÑ€ï¼‰å¼€å‘çš„ï¼Œç¬¬ä¸€ä¸ªå…¬å¼€ç‰ˆæœ¬0.1.0å‘å¸ƒäº2004å¹´10æœˆ4æ—¥ã€‚å…¶å°†<a href="https://baike.baidu.com/item/%E6%BA%90%E4%BB%A3%E7%A0%81/3814213" target="_blank" rel="noopener noreferrer">æºä»£ç </a>ä»¥ç±»<a href="https://baike.baidu.com/item/BSD%E8%AE%B8%E5%8F%AF%E8%AF%81/10642412" target="_blank" rel="noopener noreferrer">BSDè®¸å¯è¯</a>çš„å½¢å¼å‘å¸ƒï¼Œå› å®ƒçš„ç¨³å®šæ€§ã€ä¸°å¯Œçš„åŠŸèƒ½é›†ã€ç®€å•çš„é…ç½®æ–‡ä»¶å’Œä½ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—è€Œ<a href="https://baike.baidu.com/item/%E9%97%BB%E5%90%8D/2303308" target="_blank" rel="noopener noreferrer">é—»å</a>ã€‚2011å¹´6æœˆ1æ—¥ï¼Œnginx 1.0.4å‘å¸ƒã€‚åº•å±‚æ˜¯ç”¨Cè¯­è¨€å¼€å‘ã€‚</p></li><li><p>Nginxæ˜¯ä¸€æ¬¾<a href="https://baike.baidu.com/item/%E8%BD%BB%E9%87%8F%E7%BA%A7/10002835" target="_blank" rel="noopener noreferrer">è½»é‡çº§</a>çš„<a href="https://baike.baidu.com/item/Web/150564" target="_blank" rel="noopener noreferrer">Web</a> æœåŠ¡å™¨/<a href="https://baike.baidu.com/item/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/7793488" target="_blank" rel="noopener noreferrer">åå‘ä»£ç†</a>æœåŠ¡å™¨åŠ<a href="https://baike.baidu.com/item/%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6/111106" target="_blank" rel="noopener noreferrer">ç”µå­é‚®ä»¶</a>ï¼ˆIMAP/POP3ï¼‰ä»£ç†æœåŠ¡å™¨ï¼Œåœ¨BSD-like åè®®ä¸‹å‘è¡Œã€‚å…¶ç‰¹ç‚¹æ˜¯å æœ‰å†…å­˜å°‘ï¼Œ<a href="https://baike.baidu.com/item/%E5%B9%B6%E5%8F%91/11024806" target="_blank" rel="noopener noreferrer">å¹¶å‘</a>èƒ½åŠ›å¼ºï¼Œäº‹å®ä¸Šnginxçš„å¹¶å‘èƒ½åŠ›åœ¨åŒç±»å‹çš„ç½‘é¡µæœåŠ¡å™¨ä¸­è¡¨ç°è¾ƒå¥½ï¼Œä¸­å›½å¤§é™†ä½¿ç”¨nginxç½‘ç«™ç”¨æˆ·æœ‰ï¼šç™¾åº¦ã€<a href="https://baike.baidu.com/item/%E4%BA%AC%E4%B8%9C/210931" target="_blank" rel="noopener noreferrer">äº¬ä¸œ</a>ã€<a href="https://baike.baidu.com/item/%E6%96%B0%E6%B5%AA/125692" target="_blank" rel="noopener noreferrer">æ–°æµª</a>ã€<a href="https://baike.baidu.com/item/%E7%BD%91%E6%98%93/185754" target="_blank" rel="noopener noreferrer">ç½‘æ˜“</a>ã€<a href="https://baike.baidu.com/item/%E8%85%BE%E8%AE%AF/112204" target="_blank" rel="noopener noreferrer">è…¾è®¯</a>ã€<a href="https://baike.baidu.com/item/%E6%B7%98%E5%AE%9D/145661" target="_blank" rel="noopener noreferrer">æ·˜å®</a>ç­‰ã€‚</p></li><li><p>ä¸»è¦åŠŸèƒ½åå‘ä»£ç†</p></li><li><p>é€šè¿‡é…ç½®æ–‡ä»¶å¯ä»¥å®ç°é›†ç¾¤å’Œè´Ÿè½½å‡è¡¡</p></li><li><p>é™æ€èµ„æºè™šæ‹ŸåŒ–</p></li><li><p>é™æµç­‰</p><br></li></ul><h3 id="å¸¸è§çš„æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#å¸¸è§çš„æœåŠ¡å™¨"><span>å¸¸è§çš„æœåŠ¡å™¨</span></a></h3><br><ul><li>å¾®è½¯çš„IIS <a href="http://asp.net" target="_blank" rel="noopener noreferrer">asp.net</a></li><li>Weblogsã€Jboss ä¼ ç»Ÿè¡Œä¸šã€‚ERP/ç”µä¿¡/é‡‘è/ç‰©æµ</li><li>Tomcatã€Jetty</li><li>Apache httpã€Nginx é™æ€æœåŠ¡ã€åå‘ä»£ç†</li><li>Netty é«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ã€‚æ¯”å¦‚ï¼šwebscoket,webserver,è¯­éŸ³èŠå¤©å®¤ç­‰</li></ul><p>å¯¹æ¯”ï¼š<a href="https://www.netcraft.com/blog/december-2019-web-server-survey/" target="_blank" rel="noopener noreferrer">2019 å¹´ 12 æœˆ Web æœåŠ¡å™¨è°ƒæŸ¥ | Netcraft --- December 2019 Web Server Survey | Netcraft</a></p><p><br><br></p><h2 id="_02-nginxçš„å®‰è£…" tabindex="-1"><a class="header-anchor" href="#_02-nginxçš„å®‰è£…"><span>02ï¼šNginxçš„å®‰è£…</span></a></h2><br><p>nginxä¸‹è½½ï¼š<a href="http://nginx.org/en/download.html" target="_blank" rel="noopener noreferrer">http://nginx.org/en/download.html</a></p><ul><li>centos 7.8</li><li>æœåŠ¡å™¨ï¼šé˜¿é‡Œäº‘</li></ul><h3 id="_01ã€åˆ›å»ºnginxæœåŠ¡å™¨ç›®å½•" tabindex="-1"><a class="header-anchor" href="#_01ã€åˆ›å»ºnginxæœåŠ¡å™¨ç›®å½•"><span>01ã€åˆ›å»ºnginxæœåŠ¡å™¨ç›®å½•</span></a></h3><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/kuangstudy/nignx</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/kuangstudy/nignx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_02ã€ä¸‹è½½å®‰è£…" tabindex="-1"><a class="header-anchor" href="#_02ã€ä¸‹è½½å®‰è£…"><span>02ã€ä¸‹è½½å®‰è£…</span></a></h3><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wget</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://nginx.org/download/nginx-1.20.1.tar.gz</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_03ã€å®‰è£…ç¼–è¯‘å·¥å…·åŠåº“æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_03ã€å®‰è£…ç¼–è¯‘å·¥å…·åŠåº“æ–‡ä»¶"><span>03ã€å®‰è£…ç¼–è¯‘å·¥å…·åŠåº“æ–‡ä»¶</span></a></h3><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> make</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zlib</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zlib-devel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gcc-c++</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libtool</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  openssl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> openssl-devel</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_04ã€è§£å‹nginx" tabindex="-1"><a class="header-anchor" href="#_04ã€è§£å‹nginx"><span>04ã€è§£å‹nginx</span></a></h3><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -zxvf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx-1.20.1.tar.gz</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_05ã€åˆ›å»ºnginxçš„ä¸´æ—¶ç›®å½•" tabindex="-1"><a class="header-anchor" href="#_05ã€åˆ›å»ºnginxçš„ä¸´æ—¶ç›®å½•"><span>05ã€åˆ›å»ºnginxçš„ä¸´æ—¶ç›®å½•</span></a></h3><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/temp/nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_06ã€è¿›å…¥å®‰è£…åŒ…ç›®å½•" tabindex="-1"><a class="header-anchor" href="#_06ã€è¿›å…¥å®‰è£…åŒ…ç›®å½•"><span>06ã€è¿›å…¥å®‰è£…åŒ…ç›®å½•</span></a></h3><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx-1.20.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_07ã€é…ç½®nginxçš„å®‰è£…è·¯å¾„" tabindex="-1"><a class="header-anchor" href="#_07ã€é…ç½®nginxçš„å®‰è£…è·¯å¾„"><span>07ã€é…ç½®nginxçš„å®‰è£…è·¯å¾„</span></a></h3><p>é»˜è®¤é…ç½®</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./configure</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å®‰è£…ä»¥åçš„ç›®å½•ä¿¡æ¯</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> path</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> prefix:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/usr/local/nginx/nginx&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> binary</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> file:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/usr/local/nginx/nginx/sbin/nginx&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> modules</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> path:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/usr/local/nginx/nginx/modules&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> configuration</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> prefix:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/usr/local/nginx/nginx/conf&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> configuration</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> file:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/usr/local/nginx/nginx/conf/nginx.conf&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> file:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/var/run/nginx/nginx.pid&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> error</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> file:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/var/log/nginx/error.log&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> access</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> file:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/var/log/nginx/access.log&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> client</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> request</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> body</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> temporary</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> files:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/var/temp/nginx/client&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> proxy</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> temporary</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> files:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/var/temp/nginx/proxy&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fastcgi</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> temporary</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> files:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/var/temp/nginx/fastgi&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> uwsgi</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> temporary</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> files:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/var/temp/nginx/uwsgi&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> scgi</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> temporary</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> files:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/var/temp/nginx/scgi&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŒ‡å®šé…ç½®</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./configure</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--prefix=/usr/local/nginx </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--pid-path=/var/run/nginx/nginx.pid </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--lock-path=/var/lock/nginx.lock </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--error-log-path=/var/log/nginx/error.log </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--http-log-path=/var/log/nginx/access.log </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--with-http_gzip_static_module </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--http-client-body-temp-path=/var/temp/nginx/client </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--http-proxy-temp-path=/var/temp/nginx/proxy </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--http-fastcgi-temp-path=/var/temp/nginx/fastgi </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--http-uwsgi-temp-path=/var/temp/nginx/uwsgi </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--http-scgi-temp-path=/var/temp/nginx/scgi </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--with-http_stub_status_module </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--with-http_ssl_module</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®‰è£…çš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> path</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> prefix:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/usr/local/nginx&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> binary</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> file:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/usr/local/nginx/sbin/nginx&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> modules</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> path:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/usr/local/nginx/modules&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> configuration</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> prefix:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/usr/local/nginx/conf&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> configuration</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> file:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/usr/local/nginx/conf/nginx.conf&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> file:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/var/run/nginx.pid&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> error</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> file:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/var/log/nginx/error.log&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> access</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> file:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/var/log/nginx/access.log&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> client</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> request</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> body</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> temporary</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> files:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/var/temp/nginx/client&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> proxy</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> temporary</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> files:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/var/temp/nginx/proxy&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fastcgi</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> temporary</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> files:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/var/temp/nginx/fastgi&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> uwsgi</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> temporary</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> files:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/var/temp/nginx/uwsgi&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> scgi</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> temporary</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> files:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/var/temp/nginx/scgi&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_cmdConfig.png" alt="image-20210821111709845" tabindex="0" loading="lazy"><figcaption>image-20210821111709845</figcaption></figure><h3 id="_08ã€-makeç¼–è¯‘" tabindex="-1"><a class="header-anchor" href="#_08ã€-makeç¼–è¯‘"><span>08ã€ makeç¼–è¯‘</span></a></h3><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_09ã€-å®‰è£…" tabindex="-1"><a class="header-anchor" href="#_09ã€-å®‰è£…"><span>09ã€ å®‰è£…</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">make</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> install</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_10ã€-è¿›å…¥sbinç›®å½•å¯åŠ¨nginx" tabindex="-1"><a class="header-anchor" href="#_10ã€-è¿›å…¥sbinç›®å½•å¯åŠ¨nginx"><span>10ã€ è¿›å…¥sbinç›®å½•å¯åŠ¨nginx</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>./nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#åœæ­¢ï¼š</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#é‡æ–°åŠ è½½ï¼š</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11ã€æ‰“å¼€æµè§ˆå™¨-è®¿é—®è™šæ‹Ÿæœºæ‰€å¤„å†…ç½‘ipå³å¯æ‰“å¼€nginxé»˜è®¤é¡µé¢-æ˜¾ç¤ºå¦‚ä¸‹ä¾¿è¡¨ç¤ºå®‰è£…æˆåŠŸ" tabindex="-1"><a class="header-anchor" href="#_11ã€æ‰“å¼€æµè§ˆå™¨-è®¿é—®è™šæ‹Ÿæœºæ‰€å¤„å†…ç½‘ipå³å¯æ‰“å¼€nginxé»˜è®¤é¡µé¢-æ˜¾ç¤ºå¦‚ä¸‹ä¾¿è¡¨ç¤ºå®‰è£…æˆåŠŸ"><span>11ã€æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®è™šæ‹Ÿæœºæ‰€å¤„å†…ç½‘ipå³å¯æ‰“å¼€nginxé»˜è®¤é¡µé¢ï¼Œæ˜¾ç¤ºå¦‚ä¸‹ä¾¿è¡¨ç¤ºå®‰è£…æˆåŠŸï¼š</span></a></h3><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">http://ip</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_webShow.png" alt="image-20210821141421135" tabindex="0" loading="lazy"><figcaption>image-20210821141421135</figcaption></figure><h3 id="_12ã€æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#_12ã€æ³¨æ„äº‹é¡¹"><span>12ã€æ³¨æ„äº‹é¡¹</span></a></h3><ol><li><p>å¦‚æœåœ¨äº‘æœåŠ¡å™¨å®‰è£…ï¼Œéœ€è¦å¼€å¯é»˜è®¤çš„nginxç«¯å£ï¼š80</p></li><li><p>å¦‚æœåœ¨è™šæ‹Ÿæœºå®‰è£…ï¼Œéœ€è¦å…³é—­é˜²ç«å¢™</p></li><li><p>æœ¬åœ°winæˆ–macéœ€è¦å…³é—­é˜²ç«å¢™</p></li><li><p>nginxçš„å®‰è£…ç›®å½•æ˜¯ï¼š/usr/local/nginx</p></li></ol><h3 id="_13ã€é…ç½®nginxçš„ç¯å¢ƒå˜é‡" tabindex="-1"><a class="header-anchor" href="#_13ã€é…ç½®nginxçš„ç¯å¢ƒå˜é‡"><span>13ã€é…ç½®nginxçš„ç¯å¢ƒå˜é‡</span></a></h3><p>é…ç½®çš„å¥½å¤„ï¼šå°±æ˜¯å¯ä»¥ä»»æ„ç›®å½•ä¸‹æ‰§è¡Œnginxçš„å¯åŠ¨ï¼Œå…³é—­ï¼Œæ¨å‡ºï¼Œé‡å¯åŠ è½½ã€‚</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/profile</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨æ–‡ä»¶çš„å°¾éƒ¨è¿½åŠ å¦‚ä¸‹ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> NGINX_HOME</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">usr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">local</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">nginx</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> PATH</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$NGINX_HOME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sbin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$PATH</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯é…ç½®æ–‡ä»¶</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">source</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/profile</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_14ã€åŠ è½½é»˜è®¤é¡µé¢" tabindex="-1"><a class="header-anchor" href="#_14ã€åŠ è½½é»˜è®¤é¡µé¢"><span>14ã€åŠ è½½é»˜è®¤é¡µé¢</span></a></h3><p>1ã€è®¿é—®ï¼š<a href="http://139.224.164.101:80/" target="_blank" rel="noopener noreferrer">http://139.224.164.101:80/</a> ----&gt;Nginx--ç›‘å¬80ç«¯å£--&gt;æ‰¾åˆ°å¯¹åº”server----&gt;æ˜ å°„è·¯ç”±/----&gt; htmlä¸­çš„index.html</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_reqWork.png" alt="image-20210821220258886" tabindex="0" loading="lazy"><figcaption>image-20210821220258886</figcaption></figure><p>2ã€æ‰“å¼€<code>/usr/local/nginx/conf/nginx.conf</code>å¦‚ä¸‹</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">worker_processes </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">events</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    worker_connections </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    include </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      mime.types;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    default_type </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> application/octet-stream;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    sendfile </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    keepalive_timeout </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 65</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    gzip </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # ç›‘å¬ç«¯å£80 </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      80</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # è¯·æ±‚æ—¶å€™çš„ip,ä¹Ÿå¯ä»¥æ˜¯å…·ä½“çš„ipï¼Œä¹Ÿå¯ä»¥æ˜¯åŸŸå</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> localhost;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     	# æ‰¾åˆ°è¯·æ±‚æ—¶å€™çš„æœåŠ¡å™¨è·¯ç”±èµ„æº</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    		# rootæ˜¯æ ¹ï¼Œhtmlæ˜¯ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼Œå‰é¢æ²¡æœ‰æ–œçº¿å“¦ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å†™ç»å¯¹è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  html;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    		# é¦–é¡µæŒ‡å®šçš„é¡µé¢åç§°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            index </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> index.html index.htm;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		# å‡ºé”™çš„æ—¶å€™è¿›è¡Œè®¿é—®çš„é¡µé¢</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        error_page </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  500</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 502</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 503</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 504</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  /50x.html;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#E06C75;">/50x.html </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  html;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åˆ‡è®°ï¼šæ³¨æ„ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸€å®šè¦ï¼šé‡å¯nginxæœåŠ¡ï¼Œè®¿é—®ç”Ÿæ•ˆ</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><a href="http://139.224.164.101/" target="_blank" rel="noopener noreferrer">http://139.224.164.101/</a></p><br><br><h2 id="_03-nginxçš„è¿›ç¨‹ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_03-nginxçš„è¿›ç¨‹ç»“æ„"><span>03ï¼šNginxçš„è¿›ç¨‹ç»“æ„</span></a></h2><br><h3 id="nginxçš„è¿›ç¨‹æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#nginxçš„è¿›ç¨‹æ¨¡å‹"><span>Nginxçš„è¿›ç¨‹æ¨¡å‹</span></a></h3><h4 id="æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#æ¦‚è¿°"><span>æ¦‚è¿°</span></a></h4><ul><li>masterè¿›ç¨‹ï¼šä¸»è¿›ç¨‹ï¼Œç›¸å½“äºä¸€ä¸ªé¢†å¯¼è€…</li><li>workerè¿›ç¨‹ï¼šå·¥ä½œè¿›ç¨‹ï¼Œç›¸å½“äºä¸€ä¸ªå·¥ä½œäººï¼Œå®ƒæ˜¯ä¸ºmasterè¿›ç¨‹å»æœåŠ¡çš„ã€‚</li></ul><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ps</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -ef</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_process.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>masterè¿›ç¨‹æœ‰ä¸”åªæœ‰ä¸€ä¸ª</p><p>workerè¿›ç¨‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼šä¹Ÿåªæœ‰ä¸€ä¸ªï¼Œä½†æ˜¯å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­å»é…ç½®workerçš„è¿›ç¨‹æ•°é‡ã€‚</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#user  nobody;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">worker_processes</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯nginxæœåŠ¡</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#é‡å¯</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reload</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰è¯¯</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†æ¬¡æŸ¥çœ‹å¦‚ä¸‹ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ps</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -ef</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_process.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><h4 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h4><ul><li>masterä¼šæŠŠæ‰€æœ‰çš„è¯·æ±‚ä¿¡å·ï¼Œåˆ†é…ç»™workerè¿›ç¨‹å»è¿›è¡Œå¤„ç†ã€‚ç›¸å½“äºè€æ¿åœ¨å¤–é¢æ¥äº†å¾ˆå¤šçš„ä»»åŠ¡ï¼Œç„¶ååˆ†æ´¾ç»™å°ä¼™ä¼´å»å®Œæˆã€‚</li><li>masterä¼šç›‘æ§workerï¼Œæ˜¯å¦æ­£å¸¸è¿˜æ˜¯å‘ç”Ÿäº†å¼‚å¸¸é€€å‡ºäº† ï¼Œè¿™ä¸ªæ—¶å€™masterä¼šé‡å¯å¯åŠ¨ä¸€ä¸ªæ–°çš„workerå»é‡å¯æ‰§è¡Œä»»åŠ¡ã€‚å°±ç›¸å½“äºå‘˜å·¥è¾èŒäº†ï¼Œè€æ¿éœ€è¦é‡æ–°åœ¨æ‹›è˜ä¸€ä¸ªå‘˜å·¥ä¸€æ ·çš„é“ç†ã€‚è¿™äº›ä¿¡å·æœ‰é‚£äº›å¦‚ä¸‹ï¼š</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>nginx -s quit</span></span>
<span class="line"><span>nginx -s reload</span></span>
<span class="line"><span>nginx -s stop</span></span>
<span class="line"><span>nginx -t</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™äº›ä¿¡å·éƒ½æ˜¯workerå»æ‰§è¡Œå’Œå¤„ç†ã€‚</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workHandle1.png" alt="image-20210821200948492" tabindex="0" loading="lazy"><figcaption>image-20210821200948492</figcaption></figure><ul><li>masterå’Œworkeræ˜¯ä¸€ä¸ªè¿›ç¨‹æ¨¡å‹ï¼Œè¿™æ ·çš„å¥½å¤„å¯ä»¥èµ·åˆ°éš”ç¦»çš„ä½œç”¨ã€‚</li></ul><h3 id="nginxçš„workeræŠ¢å æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#nginxçš„workeræŠ¢å æœºåˆ¶"><span>Nginxçš„workeræŠ¢å æœºåˆ¶</span></a></h3><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workerHandle2.png" alt="image-20210821201134971" tabindex="0" loading="lazy"><figcaption>image-20210821201134971</figcaption></figure><p>1ã€é€šè¿‡é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹worker è¿›ç¨‹çš„æ•°é‡ï¼Œå‡è®¾æ˜¯3ä¸ªã€‚</p><p>2ã€å…¶åŸç†æ˜¯ï¼šmasteré€šè¿‡ä¸»è¿›ç¨‹forkäº†ä¸‰ä¸ªå·¥ä½œworkerè¿›ç¨‹ã€‚è¿™ä¸ªæ—¶å€™å¦‚æœæœ‰å®¢æˆ·ç«¯æœ‰è¯·æ±‚è¿›å…¥nginxæœåŠ¡å™¨ã€‚</p><p>3ã€3ä¸ªworkerè¿›ç¨‹ä¼šé€šè¿‡äº‰æŠ¢accept_mutexé”ï¼Œæ¥å¤„ç†æŸä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚é‚£ä¸ªworkerè¿›ç¨‹æŠ¢åˆ°ï¼Œå°±é‚£ä¸ªworkerè¿›ç¨‹å»å¤„ç†è¿™ä¸ªå®¢æˆ·ç«¯è¯·æ±‚ã€‚</p><h2 id="_04ã€nginx-confé…ç½®æ–‡ä»¶åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_04ã€nginx-confé…ç½®æ–‡ä»¶åˆ†æ"><span>04ã€Nginx.confé…ç½®æ–‡ä»¶åˆ†æ</span></a></h2><h3 id="nginx-confé…ç½®æ–‡ä»¶åˆ†æ" tabindex="-1"><a class="header-anchor" href="#nginx-confé…ç½®æ–‡ä»¶åˆ†æ"><span>Nginx.confé…ç½®æ–‡ä»¶åˆ†æ</span></a></h3><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_configAnalyse.png" alt="image-20210821150531906" tabindex="0" loading="lazy"><figcaption>image-20210821150531906</figcaption></figure><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è®¾ç½®workerè¿›ç¨‹çš„ç”¨æˆ·ï¼ŒæŒ‡çš„linuxä¸­çš„ç”¨æˆ·ï¼Œä¼šæ¶‰åŠåˆ°nginxæ“ä½œç›®å½•æˆ–æ–‡ä»¶çš„ä¸€äº›æƒé™ï¼Œé»˜è®¤ä¸º nobodyã€‚</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># é»˜è®¤æƒ…å†µæ˜¯ï¼šnobodyï¼Œä½ æ³¨é‡Šçš„æƒ…å†µä¸‹ä¹Ÿæ˜¯nobodyã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¿®æ”¹æˆ user rootï¼Œä¿®æ”¹ä»¥åè®°å¾—é‡å¯ç¿»æ–¹å¯ç”Ÿæ•ˆï¼Œç„¶åé€šè¿‡ps -ef | grep nginx å¯ä»¥æŸ¥çœ‹æ•ˆæœã€‚</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#user  nobody;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#workerè¿›ç¨‹å·¥ä½œæ•°è®¾ç½®ï¼Œä¸€èˆ¬æ¥è¯´CPUæœ‰å‡ ä¸ªï¼Œå°±è®¾ç½®å‡ ä¸ªï¼Œæˆ–è€…è®¾ç½®ä¸ºN-1ä¹Ÿè¡Œ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">worker_processes </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#  nginx æ—¥å¿—çº§åˆ« debug | info | notice | warn | error | crit | alert | emerg ï¼Œé”™è¯¯çº§åˆ«ä»å·¦åˆ°å³è¶Šæ¥è¶Šå¤§</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># é»˜è®¤æ˜¯ï¼šemergçº§åˆ«ï¼Œå­˜å‚¨çš„è·¯åœ¨ /var/log/nginx/error.log</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#error_log  logs/error.log;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#error_log  logs/error.log  notice;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#error_log  logs/error.log  info;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è®¾ç½®nginxè¿›ç¨‹ pid</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#pid        logs/nginx.pid;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># é…ç½®ç³»ç»Ÿçš„çº¿ç¨‹æ¨¡å‹å’Œå·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">events</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # linuxç³»ç»Ÿé»˜è®¤ä½¿ç”¨epoll</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    use </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">epoll</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # æ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„æœ€å¤§å…è®¸è¿æ¥çš„å®¢æˆ·ç«¯æœ€å¤§è¿æ¥æ•° ab/jmeter</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # ç‚¹ cpu neicun ç¡¬ç›˜ sso jmter 100000 404 500</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    worker_connections </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10240</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># http æ˜¯æŒ‡ä»¤å—ï¼Œé’ˆå¯¹httpç½‘ç»œä¼ è¾“çš„ä¸€äº›æŒ‡ä»¤é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # åŒ…å«å’Œå¯¼å…¥å¤–éƒ¨çš„æ–‡ä»¶ï¼Œè¿›è¡Œæ¨¡å—åŒ–çš„åˆ’åˆ†ã€‚  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    include </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      mime.types;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    default_type </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> application/octet-stream;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # é…ç½®æ—¥å¿—æ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # ç»™äºaccess_logçš„æ ¼å¼æ˜¯mainæ ¼å¼ï¼Œç„¶åæŠŠæ¯æ¬¡è¯·æ±‚çš„ä¿¡æ¯å†™å…¥åˆ°logs/access.logä¸­ã€‚</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #access_log  logs/access.log  main;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # å¯ç”¨æ–‡ä»¶çš„é«˜æ•ˆä¼ è¾“ï¼Œæ‰“å¼€æœ‰åˆ©äºæ–‡ä»¶ä¼ è¾“çš„æ€§èƒ½</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    sendfile </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #tcp_nopushå®ƒå¿…é¡»å’Œsendfileä½¿ç”¨ï¼Œå¹¶ä¸”sendfileæ‰“å¼€äº†æ‰ç”Ÿæ•ˆï¼Œå®ƒçš„å«ä¹‰æ˜¯ï¼šå½“è¯·æ±‚çš„æ•°æ®åŒ…ç´¯ç§¯äº†åˆ°ä¸€å®šçš„å¤§å°çš„æ—¶å€™ï¼Œåœ¨è¿›è¡Œå‘é€ã€‚</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #tcp_nopush     on;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æ˜¯65ç§’ï¼Œ0ä»£è¡¨ä¸ä¿æŒè¿æ¥----</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #keepalive_timeout  0;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    keepalive_timeout </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 65</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # å¼€å¯gzip,åˆ©äºæ–‡ä»¶å’Œè¯·æ±‚æ•°æ®çš„ä¼ è¾“ã€‚</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    gzip </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    http://47.115.230.36:80/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # æœåŠ¡è™šæ‹Ÿä¸»æœºé…ç½®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      80</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # ç›‘å¬nginxæ‰€åœ¨æœåŠ¡å¾—ipï¼ŒåŸŸåæˆ–è€…localhost</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> localhost;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        #access_log  logs/host.access.log  main;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  html;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            index </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> index.html index.htm;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        error_page </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  500</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 502</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 503</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 504</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  /50x.html;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#E06C75;">/50x.html </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  html;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # æœåŠ¡è™šæ‹Ÿä¸»æœºé…ç½®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      8087</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # ç›‘å¬æœåŠ¡å™¨ipï¼ŒåŸŸåï¼Œæˆ–è€…localhost</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> localhost;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  html;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            index </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> newindex.html;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è®°å¾—é‡å¯nginxæœåŠ¡å™¨</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">nginx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -s reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>nginxçš„é…ç½®æ–‡ä»¶ä¸­çš„server</p><ul><li>è¦ä¹ˆç«¯å£éš”ç¦» <ul><li>å¦‚æœéƒ½è¦å ç”¨ç«¯å£éƒ½æ˜¯80ï¼Œé‚£ä¹ˆä½ å¿…é¡»ä½¿ç”¨server_nameè¿›è¡Œéš”ç¦»</li></ul></li><li>è¦ä¹ˆåŸŸåéš”ç¦»</li><li>ä½†æ˜¯ä¸å…è®¸åŒæ—¶å‡ºç°ç›¸åŒç«¯å£å’Œç›¸åŒåŸŸå</li></ul><h3 id="nginxå¤–éƒ¨é…ç½®æ–‡ä»¶include-åŒ…å«" tabindex="-1"><a class="header-anchor" href="#nginxå¤–éƒ¨é…ç½®æ–‡ä»¶include-åŒ…å«"><span>Nginxå¤–éƒ¨é…ç½®æ–‡ä»¶include åŒ…å«</span></a></h3><p>include å¼•å…¥å¤–éƒ¨é…ç½®ï¼Œæé«˜å¯è¯»æ€§ï¼Œé¿å…å•ä¸ªé…ç½®æ–‡ä»¶è¿‡å¤§</p><p>æ–°å»ºä¸€ä¸ªyykk.conf,å¦‚ä¸‹ï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æœåŠ¡è™šæ‹Ÿä¸»æœºé…ç½®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      80</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # ç›‘å¬æœåŠ¡å™¨ipï¼ŒåŸŸåï¼Œæˆ–è€…localhost</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> localhost;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        #access_log  logs/host.access.log  main;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  html;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            index </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> index.html index.htm;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        error_page </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  500</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 502</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 503</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 504</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  /50x.html;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#E06C75;">/50x.html </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  html;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # æœåŠ¡è™šæ‹Ÿä¸»æœºé…ç½®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      8087</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # ç›‘å¬æœåŠ¡å™¨ipï¼ŒåŸŸåï¼Œæˆ–è€…localhost</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> localhost;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  html;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            index </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> newindex.html;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶ååœ¨nginx.confæ–‡ä»¶ä¸­åŒ…å«è¿™ä¸ªæ–‡ä»¶å³å¯ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å½“workerè¿›ç¨‹åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œå®ƒæ˜¯ç”±æ“ä½œç³»ç»Ÿçš„æ¯ä¸€ä¸ªç”¨æˆ·å»è¿›è¡Œæ‰§è¡Œçš„ï¼Œmasteræ˜¯rootç”¨æˆ·æ‰§è¡Œçš„ã€‚</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># é»˜è®¤æƒ…å†µæ˜¯ï¼šnobodyï¼Œä½ æ³¨é‡Šçš„æƒ…å†µä¸‹ä¹Ÿæ˜¯nobodyã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¿®æ”¹æˆ user rootï¼Œä¿®æ”¹ä»¥åè®°å¾—é‡å¯ç¿»æ–¹å¯ç”Ÿæ•ˆï¼Œç„¶åé€šè¿‡ps -ef | grep nginx å¯ä»¥æŸ¥çœ‹æ•ˆæœã€‚</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#user  nobody;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># workerè¿›ç¨‹çš„æ•°é‡ï¼Œä¸€èˆ¬cpuè®¾ç½®ï¼šcpuæ ¸æ•°-1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">worker_processes </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># é…ç½®é”™è¯¯æ—¥å¿—çš„ç›®å½•ã€‚æ—¥å¿—çš„çº§åˆ«æ˜¯ï¼šdebug(æœ€å…¨é¢) info notice warn error crit(æœ€ä¸¥é‡)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># é»˜è®¤æ˜¯ï¼šerrorçº§åˆ«ï¼Œå­˜å‚¨çš„è·¯åœ¨ /var/log/nginx/error.log</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#error_log  logs/error.log;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#error_log  logs/error.log  notice;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#error_log  logs/error.log  info;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#pid        logs/nginx.pid;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># é…ç½®ç³»ç»Ÿçš„çº¿ç¨‹æ¨¡å‹å’Œå·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">events</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # linuxç³»ç»Ÿé»˜è®¤ä½¿ç”¨epoll</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    use </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">epoll</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # æ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„æœ€å¤§å…è®¸è¿æ¥çš„å®¢æˆ·ç«¯æœ€å¤§è¿æ¥æ•°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    worker_connections </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10240</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># é…ç½®ç½‘ç»œä¼ è¾“çš„æ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # åŒ…å«å’Œå¯¼å…¥å¤–éƒ¨çš„æ–‡ä»¶ï¼Œè¿›è¡Œæ¨¡å—åŒ–çš„åˆ’åˆ†ã€‚  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    include </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      mime.types;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    default_type </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> application/octet-stream;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # é…ç½®æ—¥å¿—æ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #log_format  logmain  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                      &#39;$</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> $body_bytes_sent &quot;$http_referer&quot; &#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # ç»™äºaccess_logçš„æ ¼å¼æ˜¯mainæ ¼å¼ï¼Œç„¶åæŠŠæ¯æ¬¡è¯·æ±‚çš„ä¿¡æ¯å†™å…¥åˆ°logs/access.logä¸­ã€‚</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #access_log  /var/log/nginx/access_server1.log  logmain;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # å¯ç”¨æ–‡ä»¶çš„é«˜æ•ˆä¼ è¾“ï¼Œæ‰“å¼€æœ‰åˆ©äºæ–‡ä»¶ä¼ è¾“çš„æ€§èƒ½</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    sendfile </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #tcp_nopushå®ƒå¿…é¡»å’Œsendfileä½¿ç”¨ï¼Œå¹¶ä¸”sendfileæ‰“å¼€äº†æ‰ç”Ÿæ•ˆï¼Œå®ƒçš„å«ä¹‰æ˜¯ï¼šå½“è¯·æ±‚çš„æ•°æ®åŒ…ç´¯ç§¯äº†åˆ°ä¸€å®šçš„å¤§å°çš„æ—¶å€™ï¼Œåœ¨è¿›è¡Œå‘é€ã€‚</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    tcp_nopush </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æ˜¯65ç§’ï¼Œ0ä»£è¡¨ä¸ä¿æŒè¿æ¥ã€‚</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #keepalive_timeout  0;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    keepalive_timeout </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 65</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # å»ºè®®å¼€å¯gzip,åˆ©äºæ–‡ä»¶å’Œè¯·æ±‚æ•°æ®çš„ä¼ è¾“ã€‚åŒæ—¶æ¶ˆè€—cpuæ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    gzip </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # è¿™é‡Œè¿›è¡ŒåŒ…å«</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    include </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">yykk.conf;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸¤ä¸ªæ–‡ä»¶çš„æ‰€å¤„çš„æ–‡ä»¶ç›®å½•å…³ç³»ï¼š</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_confLocation.png" alt="image-20210821155648853" tabindex="0" loading="lazy"><figcaption>image-20210821155648853</figcaption></figure><p>ç„¶ååœ¨é‡å¯å³å¯ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æµè§ˆå™¨è®¿é—®ä¾ç„¶å¯ä»¥æ­£å¸¸çš„æ‰§è¡Œã€‚</p><h3 id="æŸ¥çœ‹nginxçš„é…ç½®" tabindex="-1"><a class="header-anchor" href="#æŸ¥çœ‹nginxçš„é…ç½®"><span>æŸ¥çœ‹Nginxçš„é…ç½®</span></a></h3><p>æŸ¥çœ‹nginxå®‰è£…ç›®å½•å’Œæ—¥å¿—çš„ç›®å½•ï¼Œå°±ä½¿ç”¨nginx -V</p><p>ä½†æ˜¯å‰ææ˜¯ï¼šä½ å¿…é¡»æ˜¯ä½¿ç”¨<code>./configuration</code>çš„æŒ‡å®šç›®å½•å®‰å…¨ã€‚</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -V</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@iZuf62zev3la2ivndnxra5Z nginx]# nginx -V</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> version:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx/1.20.1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">built</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> by</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gcc</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4.8.5</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 20150623</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (Red </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Hat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 4.8.5-44</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) (</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">GCC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">built</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> with</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OpenSSL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1.0.2k-fips</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  26</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Jan</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2017</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">TLS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SNI</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> support</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enabled</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">configure</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> arguments:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --prefix=/usr/local/nginx/nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --pid-path=/var/run/nginx/nginx.pid</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --lock-path=/var/lock/nginx.lock</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --error-log-path=/var/log/nginx/error.log</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --http-log-path=/var/log/nginx/access.log</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --with-http_gzip_static_module</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --http-client-body-temp-path=/var/temp/nginx/client</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --http-proxy-temp-path=/var/temp/nginx/proxy</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --http-fastcgi-temp-path=/var/temp/nginx/fastgi</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --http-uwsgi-temp-path=/var/temp/nginx/uwsgi</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --http-scgi-temp-path=/var/temp/nginx/scgi</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --with-http_stub_status_module</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --with-http_ssl_module</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="nginxå¸¸é‡è¡¨" tabindex="-1"><a class="header-anchor" href="#nginxå¸¸é‡è¡¨"><span>nginxå¸¸é‡è¡¨</span></a></h4><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$args                    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¯·æ±‚ä¸­çš„å‚æ•°å€¼</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$query_string            </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#åŒ $args</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$arg_NAME                </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#GETè¯·æ±‚ä¸­NAMEçš„å€¼</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$is_args                 </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¦‚æœè¯·æ±‚ä¸­æœ‰å‚æ•°ï¼Œå€¼ä¸º&quot;?&quot;ï¼Œå¦åˆ™ä¸ºç©ºå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$uri                     </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¯·æ±‚ä¸­çš„å½“å‰URI(ä¸å¸¦è¯·æ±‚å‚æ•°ï¼Œå‚æ•°ä½äº$args)ï¼Œå¯ä»¥ä¸åŒäºæµè§ˆå™¨ä¼ é€’çš„$request_uriçš„å€¼ï¼Œå®ƒå¯ä»¥é€šè¿‡å†…éƒ¨é‡å®šå‘ï¼Œæˆ–è€…ä½¿ç”¨indexæŒ‡ä»¤è¿›è¡Œä¿®æ”¹ï¼Œ$uriä¸åŒ…å«ä¸»æœºåï¼Œå¦‚&quot;/foo/bar.html&quot;ã€‚</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$document_uri            </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#åŒ $uri</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$document_root           </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å½“å‰è¯·æ±‚çš„æ–‡æ¡£æ ¹ç›®å½•æˆ–åˆ«å</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$host                    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ä¼˜å…ˆçº§ï¼šHTTPè¯·æ±‚è¡Œçš„ä¸»æœºå&gt;&quot;HOST&quot;è¯·æ±‚å¤´å­—æ®µ&gt;ç¬¦åˆè¯·æ±‚çš„æœåŠ¡å™¨å.è¯·æ±‚ä¸­çš„ä¸»æœºå¤´å­—æ®µï¼Œå¦‚æœè¯·æ±‚ä¸­çš„ä¸»æœºå¤´ä¸å¯ç”¨ï¼Œåˆ™ä¸ºæœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„æœåŠ¡å™¨åç§°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$hostname                </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ä¸»æœºå</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$https                   </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¦‚æœå¼€å¯äº†SSLå®‰å…¨æ¨¡å¼ï¼Œå€¼ä¸º&quot;on&quot;ï¼Œå¦åˆ™ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$binary_remote_addr      </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å®¢æˆ·ç«¯åœ°å€çš„äºŒè¿›åˆ¶å½¢å¼ï¼Œå›ºå®šé•¿åº¦ä¸º4ä¸ªå­—èŠ‚</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$body_bytes_sent         </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ä¼ è¾“ç»™å®¢æˆ·ç«¯çš„å­—èŠ‚æ•°ï¼Œå“åº”å¤´ä¸è®¡ç®—åœ¨å†…ï¼›è¿™ä¸ªå˜é‡å’ŒApacheçš„mod_log_configæ¨¡å—ä¸­çš„&quot;%B&quot;å‚æ•°ä¿æŒå…¼å®¹</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$bytes_sent              </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ä¼ è¾“ç»™å®¢æˆ·ç«¯çš„å­—èŠ‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$connection              </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#TCPè¿æ¥çš„åºåˆ—å·</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$connection_requests     </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#TCPè¿æ¥å½“å‰çš„è¯·æ±‚æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$content_length          </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#&quot;Content-Length&quot; è¯·æ±‚å¤´å­—æ®µ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$content_type            </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#&quot;Content-Type&quot; è¯·æ±‚å¤´å­—æ®µ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$cookie_name             </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#cookieåç§°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$limit_rate              </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ç”¨äºè®¾ç½®å“åº”çš„é€Ÿåº¦é™åˆ¶</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$msec                    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å½“å‰çš„Unixæ—¶é—´æˆ³</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$nginx_version           </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#nginxç‰ˆæœ¬</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$pid                     </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å·¥ä½œè¿›ç¨‹çš„PID</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$pipe                    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¦‚æœè¯·æ±‚æ¥è‡ªç®¡é“é€šä¿¡ï¼Œå€¼ä¸º&quot;p&quot;ï¼Œå¦åˆ™ä¸º&quot;.&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$proxy_protocol_addr     </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è·å–ä»£ç†è®¿é—®æœåŠ¡å™¨çš„å®¢æˆ·ç«¯åœ°å€ï¼Œå¦‚æœæ˜¯ç›´æ¥è®¿é—®ï¼Œè¯¥å€¼ä¸ºç©ºå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$realpath_root           </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å½“å‰è¯·æ±‚çš„æ–‡æ¡£æ ¹ç›®å½•æˆ–åˆ«åçš„çœŸå®è·¯å¾„ï¼Œä¼šå°†æ‰€æœ‰ç¬¦å·è¿æ¥è½¬æ¢ä¸ºçœŸå®è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$remote_addr             </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å®¢æˆ·ç«¯åœ°å€</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$remote_port             </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å®¢æˆ·ç«¯ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$remote_user             </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ç”¨äºHTTPåŸºç¡€è®¤è¯æœåŠ¡çš„ç”¨æˆ·å</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$request                 </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ä»£è¡¨å®¢æˆ·ç«¯çš„è¯·æ±‚åœ°å€</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$request_body            </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸»ä½“ï¼šæ­¤å˜é‡å¯åœ¨locationä¸­ä½¿ç”¨ï¼Œå°†è¯·æ±‚ä¸»ä½“é€šè¿‡proxy_passï¼Œfastcgi_passï¼Œuwsgi_passå’Œscgi_passä¼ é€’ç»™ä¸‹ä¸€çº§çš„ä»£ç†æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$request_body_file       </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å°†å®¢æˆ·ç«¯è¯·æ±‚ä¸»ä½“ä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­ã€‚æ–‡ä»¶å¤„ç†ç»“æŸåï¼Œæ­¤æ–‡ä»¶éœ€åˆ é™¤ã€‚å¦‚æœéœ€è¦ä¹‹ä¸€å¼€å¯æ­¤åŠŸèƒ½ï¼Œéœ€è¦è®¾ç½®client_body_in_file_onlyã€‚å¦‚æœå°†æ¬¡æ–‡ä»¶ä¼  é€’ç»™åç«¯çš„ä»£ç†æœåŠ¡å™¨ï¼Œéœ€è¦ç¦ç”¨request bodyï¼Œå³è®¾ç½®proxy_pass_request_body offï¼Œfastcgi_pass_request_body offï¼Œuwsgi_pass_request_body offï¼Œor scgi_pass_request_body off</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$request_completion      </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¦‚æœè¯·æ±‚æˆåŠŸï¼Œå€¼ä¸º&quot;OK&quot;ï¼Œå¦‚æœè¯·æ±‚æœªå®Œæˆæˆ–è€…è¯·æ±‚ä¸æ˜¯ä¸€ä¸ªèŒƒå›´è¯·æ±‚çš„æœ€åä¸€éƒ¨åˆ†ï¼Œåˆ™ä¸ºç©º</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$request_filename        </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å½“å‰è¿æ¥è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„ï¼Œç”±rootæˆ–aliasæŒ‡ä»¤ä¸URIè¯·æ±‚ç”Ÿæˆ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$request_length          </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¯·æ±‚çš„é•¿åº¦ (åŒ…æ‹¬è¯·æ±‚çš„åœ°å€ï¼Œhttpè¯·æ±‚å¤´å’Œè¯·æ±‚ä¸»ä½“)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$request_method          </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#HTTPè¯·æ±‚æ–¹æ³•ï¼Œé€šå¸¸ä¸º&quot;GET&quot;æˆ–&quot;POST&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$request_time            </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ä½¿ç”¨çš„æ—¶é—´,å•ä½ä¸ºç§’ï¼Œç²¾åº¦æ¯«ç§’ï¼› ä»è¯»å…¥å®¢æˆ·ç«¯çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¼€å§‹ï¼Œç›´åˆ°æŠŠæœ€åä¸€ä¸ªå­—ç¬¦å‘é€ç»™å®¢æˆ·ç«¯åè¿›è¡Œæ—¥å¿—å†™å…¥ä¸ºæ­¢ã€‚</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$request_uri             </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¿™ä¸ªå˜é‡ç­‰äºåŒ…å«ä¸€äº›å®¢æˆ·ç«¯è¯·æ±‚å‚æ•°çš„åŸå§‹URIï¼Œå®ƒæ— æ³•ä¿®æ”¹ï¼Œè¯·æŸ¥çœ‹$uriæ›´æ”¹æˆ–é‡å†™URIï¼Œä¸åŒ…å«ä¸»æœºåï¼Œä¾‹å¦‚ï¼š&quot;/cnphp/test.php?arg=freemouse&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$scheme                  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¯·æ±‚ä½¿ç”¨çš„Webåè®®ï¼Œ&quot;http&quot; æˆ– &quot;https&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$server_addr             </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æœåŠ¡å™¨ç«¯åœ°å€ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸ºäº†é¿å…è®¿é—®linuxç³»ç»Ÿå†…æ ¸ï¼Œåº”å°†ipåœ°å€æå‰è®¾ç½®åœ¨é…ç½®æ–‡ä»¶ä¸­</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$server_name             </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æœåŠ¡å™¨å</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$server_port             </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æœåŠ¡å™¨ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$server_protocol         </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æœåŠ¡å™¨çš„HTTPç‰ˆæœ¬ï¼Œé€šå¸¸ä¸º &quot;HTTP/1.0&quot; æˆ– &quot;HTTP/1.1&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$status                  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#HTTPå“åº”ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$time_iso8601            </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æœåŠ¡å™¨æ—¶é—´çš„ISO 8610æ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$time_local              </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æœåŠ¡å™¨æ—¶é—´ï¼ˆLOG Format æ ¼å¼ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$cookie_NAME             </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å®¢æˆ·ç«¯è¯·æ±‚Headerå¤´ä¸­çš„cookieå˜é‡ï¼Œå‰ç¼€&quot;$cookie_&quot;åŠ ä¸Šcookieåç§°çš„å˜é‡ï¼Œè¯¥å˜é‡çš„å€¼å³ä¸ºcookieåç§°çš„å€¼</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$http_NAME               </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#åŒ¹é…ä»»æ„è¯·æ±‚å¤´å­—æ®µï¼›å˜é‡åä¸­çš„ååŠéƒ¨åˆ†NAMEå¯ä»¥æ›¿æ¢æˆä»»æ„è¯·æ±‚å¤´å­—æ®µï¼Œå¦‚åœ¨é…ç½®æ–‡ä»¶ä¸­éœ€è¦è·å–httpè¯·æ±‚å¤´ï¼š&quot;Accept-Language&quot;ï¼Œ$http_accept_languageå³å¯</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$http_cookie</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$http_host               </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¯·æ±‚åœ°å€ï¼Œå³æµè§ˆå™¨ä¸­ä½ è¾“å…¥çš„åœ°å€ï¼ˆIPæˆ–åŸŸåï¼‰</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$http_referer            </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#urlè·³è½¬æ¥æº,ç”¨æ¥è®°å½•ä»é‚£ä¸ªé¡µé¢é“¾æ¥è®¿é—®è¿‡æ¥çš„</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$http_user_agent         </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ç”¨æˆ·ç»ˆç«¯æµè§ˆå™¨ç­‰ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$http_x_forwarded_for</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$sent_http_NAME          </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¯ä»¥è®¾ç½®ä»»æ„httpå“åº”å¤´å­—æ®µï¼›å˜é‡åä¸­çš„ååŠéƒ¨åˆ†NAMEå¯ä»¥æ›¿æ¢æˆä»»æ„å“åº”å¤´å­—æ®µï¼Œå¦‚éœ€è¦è®¾ç½®å“åº”å¤´Content-lengthï¼Œ$sent_http_content_lengthå³å¯</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$sent_http_cache_control</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$sent_http_connection</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$sent_http_content_type</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$sent_http_keep_alive</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$sent_http_last_modified</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$sent_http_location</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$sent_http_transfer_encoding</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_05-nginxå…³äºrootå’Œalias" tabindex="-1"><a class="header-anchor" href="#_05-nginxå…³äºrootå’Œalias"><span>05ï¼šNginxå…³äºrootå’Œalias</span></a></h2><h3 id="_01ã€ä¸Šä¼ é™æ€èµ„æºåˆ°æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_01ã€ä¸Šä¼ é™æ€èµ„æºåˆ°æœåŠ¡å™¨"><span>01ã€ä¸Šä¼ é™æ€èµ„æºåˆ°æœåŠ¡å™¨</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>root = localtion /asserts ===/www/kuangstudy/resource</span></span>
<span class="line"><span></span></span>
<span class="line"><span>- /asserts/1.jpg</span></span>
<span class="line"><span>- /asserts/2.html</span></span>
<span class="line"><span></span></span>
<span class="line"><span>http://47.115.230.36:8088 /asserts/1.jpg</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>alias  location /asserts === =/www/kuangstudy/resource</span></span>
<span class="line"><span></span></span>
<span class="line"><span>- /1.jpg</span></span>
<span class="line"><span>- /2.html</span></span>
<span class="line"><span></span></span>
<span class="line"><span>http://47.115.230.36:8088/asserts /1.jpg â€”- http://47.115.230.36:8088/www/kuangstudy/resource/1.jpg</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°†é™æ€èµ„æºç›®å½•ä¸Šä¼ åˆ°æœåŠ¡å™¨<code>/www/kuangstudy/resources</code>ç›®å½•ä¸‹ï¼Œå¦‚æœä½ æ²¡æœ‰åˆ›å»ºè¯·åˆ›å»ºï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /www/kuangstudy/resources</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_02ã€æ‰“å¼€yykk-confæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_02ã€æ‰“å¼€yykk-confæ–‡ä»¶"><span>02ã€æ‰“å¼€yykk.confæ–‡ä»¶</span></a></h3><p>å¢åŠ é™æ€èµ„æºæœåŠ¡å™¨å¦‚ä¸‹:</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># é™æ€èµ„æºæœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      80</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # ç›‘å¬æœåŠ¡å™¨ipï¼ŒåŸŸåï¼Œæˆ–è€…localhost</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> localhost;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  /www/kuangstudy/resources;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        index </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> index.html;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # http://139.224.164.101:8088/res/css/login.css</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /res {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        alias </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /www/kuangstudy/resources/asserts/;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # http://139.224.164.101:8088/asserts/css/login.css</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /asserts {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  /www/kuangstudy/resources;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 80</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ip/åŸŸå;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /xxx{</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        root/alias</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  /www/yyy/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_03ã€éªŒè¯å’Œé‡å¯nginx" tabindex="-1"><a class="header-anchor" href="#_03ã€éªŒè¯å’Œé‡å¯nginx"><span>03ã€éªŒè¯å’Œé‡å¯nginx</span></a></h3><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_04ã€ç„¶åè®¿é—®nginxçš„é™æ€èµ„æºæœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_04ã€ç„¶åè®¿é—®nginxçš„é™æ€èµ„æºæœåŠ¡å™¨"><span>04ã€ç„¶åè®¿é—®nginxçš„é™æ€èµ„æºæœåŠ¡å™¨</span></a></h3><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">http://139.224.164.101:8088/ksdadmin/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_05ã€aliasä¸rootçš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_05ã€aliasä¸rootçš„åŒºåˆ«"><span>05ã€aliasä¸rootçš„åŒºåˆ«</span></a></h3><ul><li><strong>aliasä¸rootæŒ‡å®šçš„urlæ„ä¹‰ä¸åŒ</strong></li></ul><p>rootå’Œaliaséƒ½å¯ä»¥å®šä¹‰åœ¨locationæ¨¡å—ä¸­ï¼Œéƒ½æ˜¯ç”¨æ¥æŒ‡å®šè¯·æ±‚èµ„æºçš„çœŸå®è·¯å¾„ï¼Œæ¯”å¦‚ï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /abc/ {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/data/www;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ±‚<a href="http://IP" target="_blank" rel="noopener noreferrer">http://IP</a>:port/abc/123.pngæ—¶ï¼Œé‚£ä¹ˆåœ¨æœåŠ¡å™¨é‡Œé¢å¯¹åº”çš„çœŸæ­£çš„èµ„æºæ˜¯ï¼š/data/www/abc/123.png</p><p><strong>æ³¨æ„ï¼šrootçœŸå®è·¯å¾„æ˜¯rootæŒ‡å®šçš„å€¼åŠ ä¸ŠlocationæŒ‡å®šçš„å€¼</strong>ã€‚</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /abc/ {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   alias </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/data/www;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ±‚<a href="http://IP" target="_blank" rel="noopener noreferrer">http://IP</a>:port/abc/123.pngæ—¶ï¼Œé‚£ä¹ˆåœ¨æœåŠ¡å™¨é‡Œé¢å¯¹åº”çš„çœŸæ­£çš„èµ„æºæ˜¯ï¼š/data/www/123.png</p><p><strong>æ³¨æ„ï¼šaliasçœŸå®è·¯å¾„æ˜¯aliasæŒ‡å®šçš„å€¼ï¼Œä¸åŒ…å«locationæŒ‡å®šçš„å€¼äº†</strong>ã€‚</p><ul><li><strong>åœ¨ä¸€ä¸ªlocationä¸­ï¼Œaliaså¯ä»¥å­˜åœ¨å¤šä¸ªï¼Œä½†æ˜¯rootåªèƒ½æœ‰ä¸€ä¸ª</strong></li><li><strong>aliasåªèƒ½å­˜åœ¨ä¸locationä¸­ï¼Œä½†æ˜¯rootå¯ä»¥ç”¨åœ¨serverã€httpå’Œlocationä¸­</strong></li><li>rootå’Œaliaså¦‚æœç›®å½•æ²¡æœ‰æŒ‡å®šç›˜ç¬¦/ ä»£è¡¨å°±æ˜¯ç›´æ¥ä»nginxå®‰è£…ç›®å½•å¼€å§‹æŸ¥è¯¢ï¼š/user/local/nginx/html</li></ul><h2 id="_06-nginxå…³äºlocation" tabindex="-1"><a class="header-anchor" href="#_06-nginxå…³äºlocation"><span>06ï¼šNginxå…³äºLocation</span></a></h2><h3 id="_01ã€é»˜è®¤åŒ¹é…è§„åˆ™" tabindex="-1"><a class="header-anchor" href="#_01ã€é»˜è®¤åŒ¹é…è§„åˆ™"><span>01ã€é»˜è®¤åŒ¹é…è§„åˆ™</span></a></h3><p>locationå…¶å®å°±å’Œspringmvcçš„è·¯ç”±è§„åˆ™æ˜¯ç±»ä¼¼çš„ã€‚å®ƒæ˜¯é…ç½®åœ¨serverä¸­ï¼Œå¦‚ä¸‹</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æœåŠ¡è™šæ‹Ÿä¸»æœºé…ç½®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      80</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # ç›‘å¬æœåŠ¡å™¨ipï¼ŒåŸŸåï¼Œæˆ–è€…localhost</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> localhost;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #access_log  logs/host.access.log  main;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  html;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       index </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> index.html index.htm;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   error_page </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  500</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 502</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 503</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 504</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  /50x.html;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#E06C75;">/50x.html </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  html;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„å«ä¹‰æ˜¯ï¼šåœ¨rootæŒ‡å®šçš„htmlç›®å½•ä¸­æ‰¾åˆ°index.htmlæˆ–è€…index.htmæ–‡ä»¶ã€‚</p><h3 id="_02ã€ç²¾å‡†åŒ¹é…è§„åˆ™" tabindex="-1"><a class="header-anchor" href="#_02ã€ç²¾å‡†åŒ¹é…è§„åˆ™"><span>02ã€ç²¾å‡†åŒ¹é…è§„åˆ™</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æœåŠ¡è™šæ‹Ÿä¸»æœºé…ç½®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      8087</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # ç›‘å¬æœåŠ¡å™¨ipï¼ŒåŸŸåï¼Œæˆ–è€…localhost</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> localhost;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#   location / {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#       root   html;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#       index  newindex.html;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#   }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # ç²¾å‡†åŒ¹é…</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#E06C75;">/ </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  html;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       index </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> newindex.html;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # ç²¾å‡†åŒ¹é…</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#E06C75;">/asserts/css/login.css </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  /www/kuangstudy/resources;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„rootçš„è·¯å¾„æ˜¯ï¼šä½ è®¿é—®çš„æ˜¯ï¼š<a href="https://ip" target="_blank" rel="noopener noreferrer">https://ip</a>:port/asserts/css/login.css å®é™…ä¸Šåœ¨æœåŠ¡å™¨ä¸Šçš„ç›®å½•æ˜¯ï¼š</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">/www/kuangstudy/resources/asserts/css/login.css</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_03ã€æ­£åˆ™åŒ¹é…è§„åˆ™" tabindex="-1"><a class="header-anchor" href="#_03ã€æ­£åˆ™åŒ¹é…è§„åˆ™"><span>03ã€æ­£åˆ™åŒ¹é…è§„åˆ™</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æœåŠ¡è™šæ‹Ÿä¸»æœºé…ç½®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      8085</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # ç›‘å¬æœåŠ¡å™¨ipï¼ŒåŸŸåï¼Œæˆ–è€…localhost</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> localhost;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… *ä»£è¡¨çš„æ˜¯ä¸åŒºåˆ†å¤§å°å†™</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ^~ </span><span style="--shiki-light:#0184BC;--shiki-dark:#E06C75;">/asserts/ </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/www/kuangstudy/resources;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ~* </span><span style="--shiki-light:#0184BC;--shiki-dark:#E06C75;">/asserts/\.(GIF|png|bmp|jpg|jpeg) </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  /www/kuangstudy/resources/;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ~ </span><span style="--shiki-light:#0184BC;--shiki-dark:#E06C75;">/Abc/ </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      .....</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #http://abc.com/Abc/ [åŒ¹é…æˆåŠŸ]</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #http://abc.com/abc/ [åŒ¹é…å¤±è´¥]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ~* </span><span style="--shiki-light:#0184BC;--shiki-dark:#E06C75;">/Abc/ </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      .....</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # åˆ™ä¼šå¿½ç•¥ uri éƒ¨åˆ†çš„å¤§å°å†™</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #http://abc.com/Abc/ [åŒ¹é…æˆåŠŸ]</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #http://abc.com/abc/ [åŒ¹é…æˆåŠŸ]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>*ä»£è¡¨çš„æ˜¯ä¸åŒºåˆ†å¤§å°å†™ã€‚</p><p>è®¿é—®è·¯å¾„ï¼š<a href="http://139.224.164.101:8085/asserts/img/bg.jpg" target="_blank" rel="noopener noreferrer">http://139.224.164.101:8085/asserts/img/bg.jpg</a></p><p>å®ƒä¼šåœ¨/www/kuangstudy/resourcesç›®å½•ä¸‹ï¼Œè¿›è¡Œå±‚å±‚çš„åŒ¹é…å’ŒæŸ¥æ‰¾ï¼Œæ‰¾åˆ°å°±è¿”å›ã€‚</p><h3 id="_04ã€ä»¥æŸç§å­—ç¬¦ä¸²å¼€å¤´çš„åŒ¹é…è§„åˆ™" tabindex="-1"><a class="header-anchor" href="#_04ã€ä»¥æŸç§å­—ç¬¦ä¸²å¼€å¤´çš„åŒ¹é…è§„åˆ™"><span>04ã€ä»¥æŸç§å­—ç¬¦ä¸²å¼€å¤´çš„åŒ¹é…è§„åˆ™</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æœåŠ¡è™šæ‹Ÿä¸»æœºé…ç½®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      8083</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # ç›‘å¬æœåŠ¡å™¨ipï¼ŒåŸŸåï¼Œæˆ–è€…localhost</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> localhost;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # ^~ ä»¥æŸç§å­—ç¬¦è·¯å¾„å¼€å¤´è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ^~ </span><span style="--shiki-light:#0184BC;--shiki-dark:#E06C75;">/asserts/img </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  /www/kuangstudy/resources;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="http://139.224.164.101:8083/asserts/img/indexlogo.png" target="_blank" rel="noopener noreferrer">http://139.224.164.101:8083/asserts/img/indexlogo.png</a></p><p>05ã€æ³¨æ„äº‹é¡¹</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ^~ </span><span style="--shiki-light:#0184BC;--shiki-dark:#E06C75;">/asserts/img </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # æ³¨æ„æ­£åˆ™åŒ¹é…ä¸­ä¸èƒ½ä½¿ç”¨aliasåˆ«å</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #alias   /www/kuangstudy/resources/1.jpg;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  /www/kuangstudy/resources;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_07-nginxçš„é™æµ" tabindex="-1"><a class="header-anchor" href="#_07-nginxçš„é™æµ"><span>07ï¼šNginxçš„é™æµ</span></a></h2><p>Nginx æä¾›ä¸¤ç§é™æµæ–¹å¼ï¼Œä¸€æ˜¯æ§åˆ¶é€Ÿç‡ï¼ŒäºŒæ˜¯æ§åˆ¶å¹¶å‘è¿æ¥æ•°ã€‚</p><h3 id="_1ã€æ¼æ¡¶ç®—æ³•-é™åˆ¶è¯·æ±‚æ¬¡æ•°" tabindex="-1"><a class="header-anchor" href="#_1ã€æ¼æ¡¶ç®—æ³•-é™åˆ¶è¯·æ±‚æ¬¡æ•°"><span>1ã€æ¼æ¡¶ç®—æ³•ï¼ˆé™åˆ¶è¯·æ±‚æ¬¡æ•°ï¼‰</span></a></h3><p>æ¼æ¡¶ç®—æ³•æ€è·¯å¾ˆç®€å•ï¼Œè¯·æ±‚å…ˆè¿›å…¥åˆ°æ¼æ¡¶é‡Œï¼Œæ¼æ¡¶ä»¥å›ºå®šçš„é€Ÿåº¦å‡ºæ°´ï¼Œä¹Ÿå°±æ˜¯å¤„ç†è¯·æ±‚ï¼Œå½“æ°´åŠ çš„è¿‡å¿«ï¼Œåˆ™ä¼šç›´æ¥æº¢å‡ºï¼Œä¹Ÿå°±æ˜¯æ‹’ç»è¯·æ±‚ï¼Œå¯ä»¥çœ‹å‡º<strong>æ¼æ¡¶ç®—æ³•èƒ½å¼ºè¡Œé™åˆ¶æ•°æ®çš„ä¼ è¾“é€Ÿç‡</strong>ã€‚</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workLeakyBycket.png" alt="é™æµç®—æ³•" tabindex="0" loading="lazy"><figcaption>é™æµç®—æ³•</figcaption></figure><h3 id="_2ã€ä»¤ç‰Œæ¡¶ç®—æ³•-é™åˆ¶è¯·æ±‚é€Ÿåº¦" tabindex="-1"><a class="header-anchor" href="#_2ã€ä»¤ç‰Œæ¡¶ç®—æ³•-é™åˆ¶è¯·æ±‚é€Ÿåº¦"><span>2ã€ä»¤ç‰Œæ¡¶ç®—æ³•ï¼ˆé™åˆ¶è¯·æ±‚é€Ÿåº¦ï¼‰</span></a></h3><p>å¯¹äºå¾ˆå¤šåº”ç”¨åœºæ™¯æ¥è¯´ï¼Œé™¤äº†è¦æ±‚èƒ½å¤Ÿé™åˆ¶æ•°æ®çš„å¹³å‡ä¼ è¾“é€Ÿç‡å¤–ï¼Œè¿˜è¦æ±‚å…è®¸æŸç§ç¨‹åº¦çš„çªå‘ä¼ è¾“ã€‚è¿™æ—¶å€™æ¼æ¡¶ç®—æ³•å¯èƒ½å°±ä¸åˆé€‚äº†ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•æ›´ä¸ºé€‚åˆã€‚</p><p>ä»¤ç‰Œæ¡¶ç®—æ³•çš„åŸç†æ˜¯ç³»ç»Ÿä»¥æ’å®šçš„é€Ÿç‡äº§ç”Ÿä»¤ç‰Œï¼Œç„¶åæŠŠä»¤ç‰Œæ”¾åˆ°ä»¤ç‰Œæ¡¶ä¸­ï¼Œä»¤ç‰Œæ¡¶æœ‰ä¸€ä¸ªå®¹é‡ï¼Œå½“ä»¤ç‰Œæ¡¶æ»¡äº†çš„æ—¶å€™ï¼Œå†å‘å…¶ä¸­æ”¾ä»¤ç‰Œï¼Œé‚£ä¹ˆå¤šä½™çš„ä»¤ç‰Œä¼šè¢«ä¸¢å¼ƒï¼›å½“æƒ³è¦å¤„ç†ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™ï¼Œéœ€è¦ä»ä»¤ç‰Œæ¡¶ä¸­å–å‡ºä¸€ä¸ªä»¤ç‰Œï¼Œå¦‚æœæ­¤æ—¶ä»¤ç‰Œæ¡¶ä¸­æ²¡æœ‰ä»¤ç‰Œï¼Œé‚£ä¹ˆåˆ™æ‹’ç»è¯¥è¯·æ±‚ã€‚</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workTokenBucket.png" alt="ä»¤ç‰Œæ¡¶" tabindex="0" loading="lazy"><figcaption>ä»¤ç‰Œæ¡¶</figcaption></figure><h3 id="_3ã€è®¡æ•°å™¨-é™åˆ¶è¿æ¥æ•°" tabindex="-1"><a class="header-anchor" href="#_3ã€è®¡æ•°å™¨-é™åˆ¶è¿æ¥æ•°"><span>3ã€è®¡æ•°å™¨ï¼ˆé™åˆ¶è¿æ¥æ•°ï¼‰</span></a></h3><p>è®¡æ•°å™¨æ¯”è¾ƒç®€å•ç²—æš´ï¼Œæ¯”å¦‚æˆ‘ä»¬é™åˆ¶çš„æ˜¯1sèƒ½å¤Ÿé€šè¿‡çš„è¯·æ±‚æ•°ï¼Œå®ç°çš„æ€è·¯å°±æ˜¯ä»ç¬¬ä¸€ä¸ªè¯·æ±‚è¿›æ¥å¼€å§‹è®¡æ—¶ï¼Œåœ¨æ¥ä¸‹æ¥çš„1så†…ï¼Œæ¯ä¸ªè¯·æ±‚è¿›æ¥è¯·æ±‚æ•°å°±+1ï¼Œè¶…è¿‡æœ€å¤§è¯·æ±‚æ•°çš„è¯·æ±‚ä¼šè¢«æ‹’ç»ï¼Œç­‰åˆ°1sç»“æŸåè®¡æ•°æ¸…é›¶ï¼Œé‡æ–°å¼€å§‹è®¡æ•°ã€‚</p><p>è¿™ç§æ–¹å¼æœ‰ä¸ªå¾ˆå¤§çš„å¼Šç«¯ï¼šæ¯”å¦‚å‰10mså·²ç»é€šè¿‡äº†æœ€å¤§çš„è¯·æ±‚æ•°ï¼Œé‚£ä¹ˆåé¢çš„990msçš„è¯·æ±‚åªèƒ½æ‹’ç»ï¼Œè¿™ç§ç°è±¡å«åšâ€œçªåˆºç°è±¡â€ã€‚</p><h3 id="_4ã€ä¸¤ç§ç®—æ³•çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_4ã€ä¸¤ç§ç®—æ³•çš„åŒºåˆ«"><span>4ã€ä¸¤ç§ç®—æ³•çš„åŒºåˆ«</span></a></h3><p>æ¼æ¡¶ç®—æ³•è¾“å…¥çš„æ—¶å€™è¯·æ±‚ä¸å›ºå®šï¼Œä½†éƒ½ä¼šåœ¨æ¼æ¡¶é‡Œè¾¹å…ˆä¿å­˜èµ·æ¥ï¼ˆå°äºæ¼æ¡¶çš„å®¹é‡ï¼‰ï¼Œç„¶åè¾“å‡ºçš„æ—¶å€™é‡‡ç”¨çš„æ˜¯æ’å®šçš„é€Ÿç‡æ‰§è¡Œè¯·æ±‚ï¼Œæœ‰ç‚¹åƒé˜Ÿåˆ—çš„å…ˆè¿›å…ˆå‡ºï¼Œåªæ˜¯é˜Ÿåˆ—ä¸­çš„å…ƒç´ å‡ºé˜Ÿçš„æ—¶é—´é—´éš”ä¸€è‡´ã€‚</p><p>ä»¤ç‰Œæ¡¶ç®—æ³•è·Ÿæ¼æ¡¶ç®—æ³•åˆšå¥½ç›¸åï¼Œä»¤ç‰Œæ¡¶çš„å¤§å°å°±æ˜¯æ¥å£æ‰€èƒ½æ‰¿è½½çš„æœ€å¤§è®¿é—®é‡ï¼Œä»¤ç‰Œçš„å‘æ”¾æ˜¯æ’é€Ÿçš„ï¼Œè€Œæœ€ç»ˆèƒ½åœ¨æŸä¸€æ—¶é—´å¤„ç†çš„è¯·æ±‚æ•°ä¸æ˜¯æ’å®šçš„ï¼Œè¿™å–å†³äºå•ä½æ—¶é—´å†…ä»¤ç‰Œæ¡¶ä¸­çš„ä»¤ç‰Œæ•°é‡ã€‚</p><p>ä»ä½œç”¨ä¸Šæ¥è¯´ï¼Œæ¼æ¡¶å’Œä»¤ç‰Œæ¡¶ç®—æ³•æœ€æ˜æ˜¾çš„åŒºåˆ«å°±æ˜¯æ˜¯å¦å…è®¸çªå‘æµé‡(burst)çš„å¤„ç†ï¼Œæ¼æ¡¶ç®—æ³•èƒ½å¤Ÿå¼ºè¡Œé™åˆ¶æ•°æ®çš„å®æ—¶ä¼ è¾“ï¼ˆå¤„ç†ï¼‰é€Ÿç‡ï¼Œå¯¹çªå‘æµé‡ä¸åšé¢å¤–å¤„ç†ï¼›è€Œä»¤ç‰Œæ¡¶ç®—æ³•èƒ½å¤Ÿåœ¨é™åˆ¶æ•°æ®çš„å¹³å‡ä¼ è¾“é€Ÿç‡çš„åŒæ—¶å…è®¸æŸç§ç¨‹åº¦çš„çªå‘ä¼ è¾“ã€‚</p><h3 id="_5ã€nginxå®˜æ–¹ç‰ˆæœ¬é™åˆ¶ipçš„è¿æ¥å’Œå¹¶å‘åˆ†åˆ«æœ‰ä¸¤ä¸ªæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#_5ã€nginxå®˜æ–¹ç‰ˆæœ¬é™åˆ¶ipçš„è¿æ¥å’Œå¹¶å‘åˆ†åˆ«æœ‰ä¸¤ä¸ªæ¨¡å—"><span>5ã€Nginxå®˜æ–¹ç‰ˆæœ¬é™åˆ¶IPçš„è¿æ¥å’Œå¹¶å‘åˆ†åˆ«æœ‰ä¸¤ä¸ªæ¨¡å—</span></a></h3><ul><li>limit_req_zone ç”¨æ¥é™åˆ¶å•ä½æ—¶é—´å†…çš„è¯·æ±‚æ•°ï¼Œå³é€Ÿç‡é™åˆ¶,é‡‡ç”¨çš„æ¼æ¡¶ç®—æ³• â€œleaky bucketâ€ã€‚</li><li>limit_req_conn ç”¨æ¥é™åˆ¶åŒä¸€æ—¶é—´è¿æ¥æ•°ï¼Œå³å¹¶å‘é™åˆ¶ã€‚</li></ul><h4 id="_01ã€limit-req-zone-å‚æ•°é…ç½®" tabindex="-1"><a class="header-anchor" href="#_01ã€limit-req-zone-å‚æ•°é…ç½®"><span>01ã€limit_req_zone å‚æ•°é…ç½®</span></a></h4><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Syntax: limit_req </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">name [</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">burst</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">number] [nodelay]</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Default:    â€”</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Context:    http, server, location</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">limit_req_zone $binary_remote_addr </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">one:10m </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">rate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">2r/s</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼š$binary_remote_addr è¡¨ç¤ºé€šè¿‡remote_addrè¿™ä¸ªæ ‡è¯†æ¥åšé™åˆ¶ï¼Œâ€œbinary_â€çš„ç›®çš„æ˜¯ç¼©å†™å†…å­˜å ç”¨é‡ï¼Œæ˜¯é™åˆ¶åŒä¸€å®¢æˆ·ç«¯ipåœ°å€ã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•°ï¼šzone=one:10mè¡¨ç¤ºç”Ÿæˆä¸€ä¸ªå¤§å°ä¸º10Mï¼Œåå­—ä¸ºoneçš„å†…å­˜åŒºåŸŸï¼Œç”¨æ¥å­˜å‚¨è®¿é—®çš„é¢‘æ¬¡ä¿¡æ¯ã€‚</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šrate=1r/sè¡¨ç¤ºå…è®¸ç›¸åŒæ ‡è¯†çš„å®¢æˆ·ç«¯çš„è®¿é—®é¢‘æ¬¡ï¼Œè¿™é‡Œé™åˆ¶çš„æ˜¯æ¯ç§’1æ¬¡ï¼Œè¿˜å¯ä»¥æœ‰æ¯”å¦‚30r/mçš„ã€‚</li></ul><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">limit_req </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">one </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">burst</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">5 nodelay</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šzone=one è®¾ç½®ä½¿ç”¨å“ªä¸ªé…ç½®åŒºåŸŸæ¥åšé™åˆ¶ï¼Œä¸ä¸Šé¢limit_req_zone é‡Œçš„nameå¯¹åº”ã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•°ï¼šburst=5ï¼Œé‡ç‚¹è¯´æ˜ä¸€ä¸‹è¿™ä¸ªé…ç½®ï¼Œburstçˆ†å‘çš„æ„æ€ï¼Œè¿™ä¸ªé…ç½®çš„æ„æ€æ˜¯è®¾ç½®ä¸€ä¸ªå¤§å°ä¸º5çš„ç¼“å†²åŒºå½“æœ‰å¤§é‡è¯·æ±‚ï¼ˆçˆ†å‘ï¼‰è¿‡æ¥æ—¶ï¼Œè¶…è¿‡äº†è®¿é—®é¢‘æ¬¡é™åˆ¶çš„è¯·æ±‚å¯ä»¥å…ˆæ”¾åˆ°è¿™ä¸ªç¼“å†²åŒºå†…ã€‚</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šnodelayï¼Œå¦‚æœè®¾ç½®ï¼Œè¶…è¿‡è®¿é—®é¢‘æ¬¡è€Œä¸”ç¼“å†²åŒºä¹Ÿæ»¡äº†çš„æ—¶å€™å°±ä¼šç›´æ¥è¿”å›503ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™æ‰€æœ‰è¯·æ±‚ä¼šç­‰å¾…æ’é˜Ÿ</li></ul><p><strong>limit_req_zoneç¤ºä¾‹</strong></p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">http {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">   limit_req_zone $binary_remote_addr </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">one:10m </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">rate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">1r/s</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    server {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">        location /search/ {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">         	limit_req </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">one </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">burst</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">5 nodelay</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">         }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹é¢é…ç½®å¯ä»¥é™åˆ¶ç‰¹å®šUAï¼ˆæ¯”å¦‚æœç´¢å¼•æ“ï¼‰çš„è®¿é—®ï¼š</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">limit_req_zone $anti_spider </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">one:10m   </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">rate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">10r/s</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">limit_req </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">one </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">burst</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">100 nodelay</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">if ($http_user_agent ~* </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;googlebot|bingbot|Feedfetcher-Google&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> set $anti_spider $http_user_agent</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä»–å‚æ•°</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Syntax: limit_req_log_level info | notice | warn | error</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Default:    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">limit_req_log_level error</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Context:    http, server, location</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æœåŠ¡å™¨ç”±äºlimitè¢«é™é€Ÿæˆ–ç¼“å­˜æ—¶ï¼Œé…ç½®å†™å…¥æ—¥å¿—ã€‚å»¶è¿Ÿçš„è®°å½•æ¯”æ‹’ç»çš„è®°å½•ä½ä¸€ä¸ªçº§åˆ«ã€‚ä¾‹å­ï¼šlimit_req_log_level noticeå»¶è¿Ÿçš„çš„åŸºæœ¬æ˜¯infoã€‚</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Syntax: limit_req_status code</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Default:    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">limit_req_status 503</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Context:    http, server, location</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è®¾ç½®æ‹’ç»è¯·æ±‚çš„è¿”å›å€¼ã€‚å€¼åªèƒ½è®¾ç½® 400 åˆ° 599 ä¹‹é—´ã€‚</p><h4 id="_02ã€ngx-http-limit-conn-module-å‚æ•°é…ç½®" tabindex="-1"><a class="header-anchor" href="#_02ã€ngx-http-limit-conn-module-å‚æ•°é…ç½®"><span>02ã€ngx_http_limit_conn_module å‚æ•°é…ç½®</span></a></h4><p>è¿™ä¸ªæ¨¡å—ç”¨æ¥é™åˆ¶å•ä¸ªIPçš„è¯·æ±‚æ•°ã€‚å¹¶éæ‰€æœ‰çš„è¿æ¥éƒ½è¢«è®¡æ•°ã€‚åªæœ‰åœ¨æœåŠ¡å™¨å¤„ç†äº†è¯·æ±‚å¹¶ä¸”å·²ç»è¯»å–äº†æ•´ä¸ªè¯·æ±‚å¤´æ—¶ï¼Œè¿æ¥æ‰è¢«è®¡æ•°ã€‚</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Syntax: limit_conn zone number</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Default:    â€”</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Context:    http, server, location</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">limit_conn_zone $binary_remote_addr </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">addr:10m</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">server {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    location /download/ {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> 	limit_conn addr 1</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€æ¬¡åªå…è®¸æ¯ä¸ªIPåœ°å€ä¸€ä¸ªè¿æ¥ã€‚</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">limit_conn_zone $binary_remote_addr </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">perip:10m</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">limit_conn_zone $server_name </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">perserver:10m</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">server {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> limit_conn perip 10</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> limit_conn perserver 100</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥é…ç½®å¤šä¸ªlimit_connæŒ‡ä»¤ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸Šé…ç½®å°†é™åˆ¶æ¯ä¸ªå®¢æˆ·ç«¯IPè¿æ¥åˆ°æœåŠ¡å™¨çš„æ•°é‡ï¼ŒåŒæ—¶é™åˆ¶è¿æ¥åˆ°è™šæ‹ŸæœåŠ¡å™¨çš„æ€»æ•°ã€‚</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Syntax: limit_conn_zone key </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">name:size</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Default:    â€”</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Context:    http</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">limit_conn_zone $binary_remote_addr </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">addr:10m</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œï¼Œå®¢æˆ·ç«¯IPåœ°å€ä½œä¸ºå…³é”®ã€‚è¯·æ³¨æ„ï¼Œä¸æ˜¯$ remote_addrï¼Œè€Œæ˜¯ä½¿ç”¨$ binary_remote_addrå˜é‡ã€‚ $ remote_addrå˜é‡çš„å¤§å°å¯ä»¥ä»7åˆ°15ä¸ªå­—èŠ‚ä¸ç­‰ã€‚å­˜å‚¨çš„çŠ¶æ€åœ¨32ä½å¹³å°ä¸Šå ç”¨32æˆ–64å­—èŠ‚çš„å†…å­˜ï¼Œåœ¨64ä½å¹³å°ä¸Šæ€»æ˜¯å ç”¨64å­—èŠ‚ã€‚å¯¹äºIPv4åœ°å€ï¼Œ$ binary_remote_addrå˜é‡çš„å¤§å°å§‹ç»ˆä¸º4ä¸ªå­—èŠ‚ï¼Œå¯¹äºIPv6åœ°å€åˆ™ä¸º16ä¸ªå­—èŠ‚ã€‚å­˜å‚¨çŠ¶æ€åœ¨32ä½å¹³å°ä¸Šå§‹ç»ˆå ç”¨32æˆ–64ä¸ªå­—èŠ‚ï¼Œåœ¨64ä½å¹³å°ä¸Šå ç”¨64ä¸ªå­—èŠ‚ã€‚ä¸€ä¸ªå…†å­—èŠ‚çš„åŒºåŸŸå¯ä»¥ä¿æŒå¤§çº¦32000ä¸ª32å­—èŠ‚çš„çŠ¶æ€æˆ–å¤§çº¦16000ä¸ª64å­—èŠ‚çš„çŠ¶æ€ã€‚å¦‚æœåŒºåŸŸå­˜å‚¨è€—å°½ï¼ŒæœåŠ¡å™¨ä¼šå°†é”™è¯¯è¿”å›ç»™æ‰€æœ‰å…¶ä»–è¯·æ±‚ã€‚</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Syntax: limit_conn_log_level info | notice | warn | error</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Default:    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">limit_conn_log_level error</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Context:    http, server, location</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æœåŠ¡å™¨é™åˆ¶è¿æ¥æ•°æ—¶ï¼Œè®¾ç½®æ‰€éœ€çš„æ—¥å¿—è®°å½•çº§åˆ«ã€‚</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Syntax: limit_conn_status code</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Default:    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">limit_conn_status 503</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">Context:    http, server, location</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è®¾ç½®æ‹’ç»è¯·æ±‚çš„è¿”å›å€¼ã€‚</p><h3 id="_6ã€nginxé™æµå®æˆ˜" tabindex="-1"><a class="header-anchor" href="#_6ã€nginxé™æµå®æˆ˜"><span>6ã€Nginxé™æµå®æˆ˜</span></a></h3><h4 id="a-æ§åˆ¶é€Ÿç‡-åŸºäºipé™æµé…ç½®" tabindex="-1"><a class="header-anchor" href="#a-æ§åˆ¶é€Ÿç‡-åŸºäºipé™æµé…ç½®"><span>a.æ§åˆ¶é€Ÿç‡ - åŸºäºipé™æµé…ç½®</span></a></h4><ul><li><p>ç¬¬ä¸€æ­¥åœ¨httpä¸­æ·»åŠ  <code>limit_req_zone $binary_remote_addr zone=one:10m rate=2r/s;</code>ï¼š</p><ul><li><p>limit_req_zoneï¼šç”¨æ¥é™åˆ¶å•ä½æ—¶é—´å†…çš„è¯·æ±‚æ•°</p></li><li><p>$binary_remote_addrï¼šå®šä¹‰é™æµå¯¹è±¡ï¼Œbinary_remote_addræ˜¯ä¸€ç§keyï¼Œè¡¨ç¤ºåŸºäº remote_addr(å®¢æˆ·ç«¯IP) æ¥åšé™æµï¼Œbinary_ çš„ç›®çš„æ˜¯å‹ç¼©å†…å­˜å ç”¨é‡ã€‚</p></li><li><p>zone=one:10mï¼šå®šä¹‰å…±äº«å†…å­˜åŒºæ¥å­˜å‚¨è®¿é—®ä¿¡æ¯ï¼Œ one:10m è¡¨ç¤ºä¸€ä¸ªå¤§å°ä¸º10Mï¼Œåå­—ä¸ºoneçš„å†…å­˜åŒºåŸŸã€‚1Mèƒ½å­˜å‚¨16000 IPåœ°å€çš„è®¿é—®ä¿¡æ¯ï¼Œ10Må¯ä»¥å­˜å‚¨16W IPåœ°å€è®¿é—®ä¿¡æ¯ã€‚</p></li><li><p>rate=1r/sï¼šç”¨äºè®¾ç½®æœ€å¤§è®¿é—®é€Ÿç‡ï¼Œrate=10r/s è¡¨ç¤ºæ¯ç§’æœ€å¤šå¤„ç†10ä¸ªè¯·æ±‚ã€‚Nginx å®é™…ä¸Šä»¥æ¯«ç§’ä¸ºç²’åº¦æ¥è·Ÿè¸ªè¯·æ±‚ä¿¡æ¯ï¼Œå› æ­¤ 10r/s å®é™…ä¸Šæ˜¯é™åˆ¶ï¼šæ¯100æ¯«ç§’å¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚è¿™æ„å‘³ç€ï¼Œè‡ªä¸Šä¸€ä¸ªè¯·æ±‚å¤„ç†å®Œåï¼Œè‹¥åç»­100æ¯«ç§’å†…åˆæœ‰è¯·æ±‚åˆ°è¾¾ï¼Œå°†æ‹’ç»å¤„ç†è¯¥è¯·æ±‚ã€‚</p></li></ul></li><li><p>ç¬¬äºŒæ­¥ï¼šç„¶ååœ¨serverï¼Œä¸­ä½¿ç”¨limit_reqæŒ‡ä»¤åº”ç”¨è¿›è¡Œé…ç½®é™æµ</p></li></ul><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">limit_req_zone $binary_remote_addr </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">mylimit:10m </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">rate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">2r/s</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">server { </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    location / { </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">     limit_req </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">mylimit</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">     }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°è§„åˆ™é™åˆ¶äº†æ¯ä¸ªIPè®¿é—®çš„é€Ÿåº¦ä¸º2r/sï¼Œå¹¶å°†è¯¥è§„åˆ™ä½œç”¨äºæ ¹ç›®å½•ã€‚å¦‚æœå•ä¸ªIPåœ¨éå¸¸çŸ­çš„æ—¶é—´å†…å¹¶å‘å‘é€å¤šä¸ªè¯·æ±‚ï¼Œç»“æœä¼šæ€æ ·å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ä½¿ç”¨å•ä¸ªIPåœ¨10mså†…å‘å¹¶å‘é€äº†6ä¸ªè¯·æ±‚ï¼Œåªæœ‰1ä¸ªæˆåŠŸï¼Œå‰©ä¸‹çš„5ä¸ªéƒ½è¢«æ‹’ç»ã€‚æˆ‘ä»¬è®¾ç½®çš„é€Ÿåº¦æ˜¯2r/sï¼Œä¸ºä»€ä¹ˆåªæœ‰1ä¸ªæˆåŠŸå‘¢ï¼Œæ˜¯ä¸æ˜¯Nginxé™åˆ¶é”™äº†ï¼Ÿå½“ç„¶ä¸æ˜¯ï¼Œæ˜¯å› ä¸ºNginxçš„é™æµç»Ÿè®¡æ˜¯åŸºäºæ¯«ç§’çš„ï¼Œæˆ‘ä»¬è®¾ç½®çš„é€Ÿåº¦æ˜¯2r/sï¼Œè½¬æ¢ä¸€ä¸‹å°±æ˜¯500mså†…å•ä¸ªIPåªå…è®¸é€šè¿‡1ä¸ªè¯·æ±‚ï¼Œä»501mså¼€å§‹æ‰å…è®¸é€šè¿‡ç¬¬äºŒä¸ªè¯·æ±‚ã€‚</p><h4 id="b-burstç¼“å­˜å¤„ç†" tabindex="-1"><a class="header-anchor" href="#b-burstç¼“å­˜å¤„ç†"><span>b.burstç¼“å­˜å¤„ç†</span></a></h4><ul><li>å¤„ç†çªå‘æµé‡ ï¼ˆbrustï¼‰ åœ¨è¶…è¿‡1ä¸ªè¯·æ±‚å°±ä¸¢å¼ƒï¼Œæ²¡æœ‰â€œæ¡¶â€çš„æ¦‚å¿µï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªâ€œæ¡¶â€</li></ul><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œæˆ‘ä»¬çŸ­æ—¶é—´å†…å‘é€äº†å¤§é‡è¯·æ±‚ï¼ŒNginxæŒ‰ç…§<mark>æ¯«ç§’çº§ç²¾åº¦ç»Ÿè®¡</mark>ï¼Œè¶…å‡ºé™åˆ¶çš„è¯·æ±‚ç›´æ¥æ‹’ç»ã€‚è¿™åœ¨å®é™…åœºæ™¯ä¸­æœªå…è¿‡äºè‹›åˆ»ï¼ŒçœŸå®ç½‘ç»œç¯å¢ƒä¸­è¯·æ±‚åˆ°æ¥ä¸æ˜¯åŒ€é€Ÿçš„ï¼Œå¾ˆå¯èƒ½æœ‰è¯·æ±‚â€œçªå‘â€çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯â€œä¸€è‚¡å­ä¸€è‚¡å­â€çš„ã€‚Nginxè€ƒè™‘åˆ°äº†è¿™ç§æƒ…å†µï¼Œå¯ä»¥é€šè¿‡burstå…³é”®å­—å¼€å¯å¯¹çªå‘è¯·æ±‚çš„ç¼“å­˜å¤„ç†ï¼Œè€Œä¸æ˜¯ç›´æ¥æ‹’ç»ã€‚</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">limit_req_zone $binary_remote_addr </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">mylimit:10m </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">rate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">2r/s</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">server { </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    location / { </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> 	limit_req </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">mylimit </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">burst</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">4</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬åŠ å…¥äº†burst=4ï¼Œæ„æ€æ˜¯æ¯ä¸ªkey(æ­¤å¤„æ˜¯æ¯ä¸ªIP)æœ€å¤šå…è®¸4ä¸ªçªå‘è¯·æ±‚çš„åˆ°æ¥ã€‚å¦‚æœå•ä¸ªIPåœ¨10mså†…å‘é€6ä¸ªè¯·æ±‚ï¼Œç»“æœä¼šæ€æ ·å‘¢ï¼Ÿ</p><p><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_burstTest1.png" alt="img" loading="lazy">ç›¸æ¯”å®ä¾‹ä¸€æˆåŠŸæ•°å¢åŠ äº†4ä¸ªï¼Œè¿™ä¸ªæˆ‘ä»¬è®¾ç½®çš„burstæ•°ç›®æ˜¯ä¸€è‡´çš„ã€‚å…·ä½“å¤„ç†æµç¨‹æ˜¯ï¼š1ä¸ªè¯·æ±‚è¢«ç«‹å³å¤„ç†ï¼Œ4ä¸ªè¯·æ±‚è¢«æ”¾åˆ°bursté˜Ÿåˆ—é‡Œï¼Œå¦å¤–ä¸€ä¸ªè¯·æ±‚è¢«æ‹’ç»ã€‚é€šè¿‡burstå‚æ•°ï¼Œæˆ‘ä»¬ä½¿å¾—Nginxé™æµå…·å¤‡äº†ç¼“å­˜å¤„ç†çªå‘æµé‡çš„èƒ½åŠ›ã€‚</p><p>ä½†æ˜¯è¯·æ³¨æ„ï¼šburstçš„ä½œç”¨æ˜¯è®©å¤šä½™çš„è¯·æ±‚å¯ä»¥å…ˆæ”¾åˆ°é˜Ÿåˆ—é‡Œï¼Œæ…¢æ…¢å¤„ç†ã€‚å¦‚æœä¸åŠ nodelayå‚æ•°ï¼Œé˜Ÿåˆ—é‡Œçš„è¯·æ±‚ä¸ä¼šç«‹å³å¤„ç†ï¼Œè€Œæ˜¯æŒ‰ç…§rateè®¾ç½®çš„é€Ÿåº¦ï¼Œä»¥æ¯«ç§’çº§ç²¾ç¡®çš„é€Ÿåº¦æ…¢æ…¢å¤„ç†ã€‚</p><h4 id="c-nodelayé™ä½æ’é˜Ÿæ—¶é—´" tabindex="-1"><a class="header-anchor" href="#c-nodelayé™ä½æ’é˜Ÿæ—¶é—´"><span>c.nodelayé™ä½æ’é˜Ÿæ—¶é—´</span></a></h4><p>åœ¨ä½¿ç”¨burstç¼“å­˜å¤„ç†ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œé€šè¿‡è®¾ç½®burstå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å…è®¸Nginxç¼“å­˜å¤„ç†ä¸€å®šç¨‹åº¦çš„çªå‘ï¼Œå¤šä½™çš„è¯·æ±‚å¯ä»¥å…ˆæ”¾åˆ°é˜Ÿåˆ—é‡Œï¼Œæ…¢æ…¢å¤„ç†ï¼Œè¿™èµ·åˆ°äº†å¹³æ»‘æµé‡çš„ä½œç”¨ã€‚ä½†æ˜¯å¦‚æœé˜Ÿåˆ—è®¾ç½®çš„æ¯”è¾ƒå¤§ï¼Œè¯·æ±‚æ’é˜Ÿçš„æ—¶é—´å°±ä¼šæ¯”è¾ƒé•¿ï¼Œç”¨æˆ·è§’åº¦çœ‹æ¥å°±æ˜¯RTå˜é•¿äº†ï¼Œè¿™å¯¹ç”¨æˆ·å¾ˆä¸å‹å¥½ã€‚æœ‰ä»€ä¹ˆè§£å†³åŠæ³•å‘¢ï¼Ÿnodelayå‚æ•°å…è®¸è¯·æ±‚åœ¨æ’é˜Ÿçš„æ—¶å€™å°±ç«‹å³è¢«å¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦è¯·æ±‚èƒ½å¤Ÿè¿›å…¥bursté˜Ÿåˆ—ï¼Œå°±ä¼šç«‹å³è¢«åå°workerå¤„ç†ï¼Œè¯·æ³¨æ„ï¼Œè¿™æ„å‘³ç€burstè®¾ç½®äº†nodelayæ—¶ï¼Œç³»ç»Ÿç¬é—´çš„QPSå¯èƒ½ä¼šè¶…è¿‡rateè®¾ç½®çš„é˜ˆå€¼ã€‚nodelayå‚æ•°è¦è·Ÿburstä¸€èµ·ä½¿ç”¨æ‰æœ‰ä½œç”¨ã€‚</p><p>å»¶ç»­burstç¼“å­˜å¤„ç†çš„é…ç½®ï¼Œæˆ‘ä»¬åŠ å…¥nodelayé€‰é¡¹ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>limit_req_zone $binary_remote_addr zone=mylimit:10m rate=2r/s;</span></span>
<span class="line"><span>server { </span></span>
<span class="line"><span>    location / { </span></span>
<span class="line"><span> 		limit_req zone=mylimit burst=4 nodelay;</span></span>
<span class="line"><span>	 }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å•ä¸ªIP 10mså†…å¹¶å‘å‘é€6ä¸ªè¯·æ±‚ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_burstTest2.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>è·Ÿburstç¼“å­˜å¤„ç†ç›¸æ¯”ï¼Œè¯·æ±‚æˆåŠŸç‡æ²¡å˜åŒ–ï¼Œä½†æ˜¯æ€»ä½“è€—æ—¶å˜çŸ­äº†ã€‚è¿™æ€ä¹ˆè§£é‡Šå‘¢ï¼Ÿåœ¨burstç¼“å­˜å¤„ç†ä¸­ï¼Œæœ‰4ä¸ªè¯·æ±‚è¢«æ”¾åˆ°bursté˜Ÿåˆ—å½“ä¸­ï¼Œå·¥ä½œè¿›ç¨‹æ¯éš”500ms(rate=2r/s)å–ä¸€ä¸ªè¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œæœ€åä¸€ä¸ªè¯·æ±‚è¦æ’é˜Ÿ2sæ‰ä¼šè¢«å¤„ç†ï¼›è¿™é‡Œï¼Œè¯·æ±‚æ”¾å…¥é˜Ÿåˆ—è·Ÿburstç¼“å­˜å¤„ç†æ˜¯ä¸€æ ·çš„ï¼Œä½†ä¸åŒçš„æ˜¯ï¼Œé˜Ÿåˆ—ä¸­çš„è¯·æ±‚åŒæ—¶å…·æœ‰äº†è¢«å¤„ç†çš„èµ„æ ¼ï¼Œæ‰€ä»¥è¿™é‡Œçš„5ä¸ªè¯·æ±‚å¯ä»¥è¯´æ˜¯åŒæ—¶å¼€å§‹è¢«å¤„ç†çš„ï¼ŒèŠ±è´¹æ—¶é—´è‡ªç„¶å˜çŸ­äº†ã€‚</p><p>ä½†æ˜¯è¯·æ³¨æ„ï¼Œè™½ç„¶è®¾ç½®burstå’Œnodelayèƒ½å¤Ÿé™ä½çªå‘è¯·æ±‚çš„å¤„ç†æ—¶é—´ï¼Œä½†æ˜¯é•¿æœŸæ¥çœ‹å¹¶ä¸ä¼šæé«˜ååé‡çš„ä¸Šé™ï¼Œé•¿æœŸååé‡çš„ä¸Šé™æ˜¯ç”±rateå†³å®šçš„ï¼Œå› ä¸ºnodelayåªèƒ½ä¿è¯burstçš„è¯·æ±‚è¢«ç«‹å³å¤„ç†ï¼Œä½†Nginxä¼šé™åˆ¶é˜Ÿåˆ—å…ƒç´ é‡Šæ”¾çš„é€Ÿåº¦ï¼Œå°±åƒæ˜¯é™åˆ¶äº†ä»¤ç‰Œæ¡¶ä¸­ä»¤ç‰Œäº§ç”Ÿçš„é€Ÿåº¦ã€‚</p><p>çœ‹åˆ°è¿™é‡Œä½ å¯èƒ½ä¼šé—®ï¼ŒåŠ å…¥äº†nodelayå‚æ•°ä¹‹åçš„é™é€Ÿç®—æ³•ï¼Œåˆ°åº•ç®—æ˜¯å“ªä¸€ä¸ªâ€œæ¡¶â€ï¼Œæ˜¯æ¼æ¡¶ç®—æ³•è¿˜æ˜¯ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Ÿå½“ç„¶è¿˜ç®—æ˜¯æ¼æ¡¶ç®—æ³•ã€‚è€ƒè™‘ä¸€ç§æƒ…å†µï¼Œä»¤ç‰Œæ¡¶ç®—æ³•çš„tokenä¸ºè€—å°½æ—¶ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿç”±äºå®ƒæœ‰ä¸€ä¸ªè¯·æ±‚é˜Ÿåˆ—ï¼Œæ‰€ä»¥ä¼šæŠŠæ¥ä¸‹æ¥çš„è¯·æ±‚ç¼“å­˜ä¸‹æ¥ï¼Œç¼“å­˜å¤šå°‘å—é™äºé˜Ÿåˆ—å¤§å°ã€‚ä½†æ­¤æ—¶ç¼“å­˜è¿™äº›è¯·æ±‚è¿˜æœ‰æ„ä¹‰å—ï¼Ÿå¦‚æœserverå·²ç»è¿‡è½½ï¼Œç¼“å­˜é˜Ÿåˆ—è¶Šæ¥è¶Šé•¿ï¼ŒRTè¶Šæ¥è¶Šé«˜ï¼Œå³ä½¿è¿‡äº†å¾ˆä¹…è¯·æ±‚è¢«å¤„ç†äº†ï¼Œå¯¹ç”¨æˆ·æ¥è¯´ä¹Ÿæ²¡ä»€ä¹ˆä»·å€¼äº†ã€‚æ‰€ä»¥å½“tokenä¸å¤Ÿç”¨æ—¶ï¼Œæœ€æ˜æ™ºçš„åšæ³•å°±æ˜¯ç›´æ¥æ‹’ç»ç”¨æˆ·çš„è¯·æ±‚ï¼Œè¿™å°±æˆäº†æ¼æ¡¶ç®—æ³•ã€‚</p><h4 id="d-è‡ªå®šä¹‰è¿”å›å€¼" tabindex="-1"><a class="header-anchor" href="#d-è‡ªå®šä¹‰è¿”å›å€¼"><span>d.è‡ªå®šä¹‰è¿”å›å€¼</span></a></h4><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">limit_req_zone $binary_remote_addr </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">mylimit:10m </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">rate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">2r/s</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">server { </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    location / { </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">       limit_req </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">mylimit </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">burst</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">4 nodelay</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">       limit_req_status 598</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é»˜è®¤æƒ…å†µä¸‹ æ²¡æœ‰é…ç½® status è¿”å›å€¼çš„çŠ¶æ€ï¼š</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_burstTest4.png" alt="v2-112645b48dc2a53020cd20daee904ab9_720w" tabindex="0" loading="lazy"><figcaption>v2-112645b48dc2a53020cd20daee904ab9_720w</figcaption></figure><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_burstTest3.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h4 id="f-åŸºäºé“¾æ¥é™æµ" tabindex="-1"><a class="header-anchor" href="#f-åŸºäºé“¾æ¥é™æµ"><span>f.åŸºäºé“¾æ¥é™æµ</span></a></h4><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#user  nobody;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">worker_processes  1</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#error_log  logs/error.log;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#error_log  logs/error.log  notice;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#error_log  logs/error.log  info;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#pid        logs/nginx.pid;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">events {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    worker_connections  1024</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">http {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    include       mime.types</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    default_type  application/octet-stream</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #access_log  logs/access.log  main;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    sendfile        on</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #tcp_nopush     on;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #keepalive_timeout  0;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    keepalive_timeout  65</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #gzip  on;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #01ã€æ ¹æ®ipåœ°å€é™åˆ¶é€Ÿåº¦</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # $binary_remote_addr æ˜¯å†…å­˜å ç”¨é€šè¿‡ç”¨æˆ·çš„è®¿é—®ipåœ°å€æ¥é™æµ</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # zone=iplimit:20m ä¹Ÿå°±æ˜¯è¯´æˆ‘ç”³è¯·ä¸€å—20må†…å­˜å¤§å°çš„å†…å­˜åŒºåŸŸå‘½åä¸ºï¼šiplimit,è¿™å—åŒºåŸŸä¸“é—¨ç”¨æ¥è®°å½•ä½ çš„è®¿é—®é¢‘ç‡ä¿¡æ¯ã€‚</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # rate=1r/s æ¯ç§’æ”¾è¡Œä¸€ä¸ªè¯·æ±‚  100r/m æ¯åˆ†é’Ÿæ”¾100ä¸ªè¯·æ±‚è¿›å…¥nginx,ç”¨æ¥æ ‡è¯†è®¿é—®çš„é™æµé¢‘ç‡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    limit_req_zone $binary_remote_addr </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">iplimit:20m </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">rate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">10r/s</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #02ã€æ ¹æ®æœåŠ¡å™¨çº§åˆ«é™æµï¼Œå¯¹æ‰€æœ‰çš„è¯·æ±‚éƒ½è¿›è¡Œé™æµå¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    limit_req_zone $server_name </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">serverlimit:10m </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">rate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">100r/s</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # å¦‚æœä¸Šé¢ä¸¤è€…è§„åˆ™éƒ½è¿›è¡Œäº†é…ç½®ã€‚åªè¦è¯·æ±‚è¸©åˆ°çº¢çº¿éƒ½ä¼šç”Ÿæ•ˆï¼Œè¿™é‡Œçš„æ¯ä¸€ä¸ªè§„åˆ™å°±å¥½æ¯”æœ¨æ¡¶åŸç†ä¸€æ ·ï¼Œè¿™é‡Œçš„æ¯ä¸ªè§„åˆ™éƒ½æ˜¯æœ¨æ¡¶çš„æœ¨æ¿</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # ä½ å¾€é‡Œé¢å€’æ°´ï¼Œå–å†³äºä½ æœ¨æ¡¶ä¸­æœ€çŸ­çš„æœ¨æ¿ã€‚</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 03ã€åŸºäºè¿æ¥æ•°çš„é™æµè§„åˆ™ï¼Œæ³¨æ„åŸºäºé“¾æ¥æ²¡æœ‰é€Ÿç‡çš„æ¦‚å¿µã€‚å®ƒæ˜¯æŒ‡å½“å‰ç°åœ¨çš„ä¿æŒçš„activeé“¾æ¥çš„æ•°é‡é™åˆ¶ã€‚</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    limit_conn_zone $binary_remote_addr </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">perip:20m</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    limit_conn_zone $server_name </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">perserver:20m</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    server {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">        listen       80</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">        server_name  localhost</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">        location / {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">            root   html</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">            index  index.html index.htm</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">        error_page   500 502 503 504  /50x.html</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">        location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> /50x.html {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">            root   html</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">        location /limit/ {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">            proxy_pass http://127.0.0.1:8080/</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            # åŸºäºipåœ°å€çš„é™åˆ¶ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            # zone=iplimit å¼•å…¥ä½ è¦é™æµçš„è§„åˆ™</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            # burst=2,è®¾ç½®ä¸€ä¸ªå¤§å°ä¸º2çš„ç¼“å†²åŒºåŸŸã€‚å½“å¤§é‡çš„è¯·æ±‚åˆ°æ¥çš„æ—¶å€™ï¼Œè¯·æ±‚æ•°é‡è¶…è¿‡é™æµé¢‘ç‡æ—¶ï¼Œå°†å…¶æ”¾å…¥ç¼“å­˜åŒºåŸŸ</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            # nodelay: å¦‚æœç¼“å­˜åŒºæ»¡äº†ä»¥åç›´æ¥è¿”å›503å¼‚å¸¸ã€‚</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">            limit_req </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">iplimit </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">burst</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">2 nodelay</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            # åŸºäºæœåŠ¡å™¨çº§åˆ«çš„é™åˆ¶</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            # æ˜¯å®é™…ç”Ÿäº§ä¸­ï¼ŒserveræœåŠ¡å™¨çº§åˆ«çš„é™æµçš„æ¯ç§’çš„é€Ÿç‡è‚¯å®šæ˜¯æ¯”è¾ƒå¤§çš„ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æµ‹è¯•æŸ¥çœ‹æ•ˆæœæ‰€ä»¥è°ƒå°ã€‚</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">            limit_req </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">zone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">serverlimit </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">burst</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">100 nodelay</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">            </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">            </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            # åŸºäºconnçš„é™æµå¼•ç”¨</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            # æ¯ä¸ªserveræœ€å¤šä¿æŒ100ä¸ªè¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">            limit_conn perserver 100</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            # æ¯ä¸ªipæœ€å¤šä¿æŒ1ä¸ªé“¾æ¥</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            #limit_conn perip 1;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">            limit_conn perip 10</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            # å¼‚å¸¸æƒ…å†µï¼Œè¿”å›504ï¼Œé»˜è®¤æƒ…å†µæ˜¯è¿”å›ï¼š503</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">            limit_req_status 504</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">            limit_conn_status 504</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_08-nginxçš„è´Ÿè½½å‡è¡¡-upstream" tabindex="-1"><a class="header-anchor" href="#_08-nginxçš„è´Ÿè½½å‡è¡¡-upstream"><span>08ï¼šNginxçš„è´Ÿè½½å‡è¡¡&amp;upstream</span></a></h2><p>åœ¨æœåŠ¡å™¨é›†ç¾¤ä¸­ï¼ŒNginxèµ·åˆ°ä¸€ä¸ªä»£ç†æœåŠ¡å™¨çš„è§’è‰²ï¼ˆå³åå‘ä»£ç†ï¼‰ï¼Œä¸ºäº†é¿å…å•ç‹¬ä¸€ä¸ªæœåŠ¡å™¨å‹åŠ›è¿‡å¤§ï¼Œå°†æ¥è‡ªç”¨æˆ·çš„è¯·æ±‚è½¬å‘ç»™ä¸åŒçš„æœåŠ¡å™¨ã€‚</p><h3 id="ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#ç›®æ ‡"><span>ç›®æ ‡</span></a></h3><p>jemterå‹åŠ›è½¯ä»¶è¿›è¡Œå•å°tomcatå‹åŠ›çš„çº¿ç¨‹æµ‹è¯•</p><p>jemterå‹åŠ›è½¯ä»¶è¿›è¡Œnginx + 3tomcatå‹åŠ›çš„çº¿ç¨‹æµ‹è¯•</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> tomcatservers {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8080;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8081;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8082;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æœåŠ¡è™šæ‹Ÿä¸»æœºé…ç½®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      80</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # ç›‘å¬æœåŠ¡å™¨ipï¼ŒåŸŸåï¼Œæˆ–è€…localhost</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> localhost;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #access_log  logs/host.access.log  main;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       proxy_pass </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">http://tomcatservers;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   error_page </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  500</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 502</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 503</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 504</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  /50x.html;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#E06C75;">/50x.html </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  html;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> xxx {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8080 ç­–ç•¥;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8081 ç­–ç•¥;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8082 ç­–ç•¥;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      80</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> x</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;x&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">x;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       proxy_pass </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">http://xxx;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™å°±æ˜¯æœ€åŸºæœ¬çš„è´Ÿè½½å‡è¡¡å®ä¾‹ï¼Œä½†è¿™ä¸è¶³ä»¥æ»¡è¶³å®é™…éœ€æ±‚ï¼›ç›®å‰NginxæœåŠ¡å™¨çš„upstreamæ¨¡å—æ”¯æŒ6ç§æ–¹å¼çš„åˆ†é…ï¼š</p><table><thead><tr><th>è½®è¯¢</th><th>é»˜è®¤æ–¹å¼</th></tr></thead><tbody><tr><td>weight</td><td>æƒé‡æ–¹å¼</td></tr><tr><td>ip_hash</td><td>ä¾æ®ipåˆ†é…æ–¹å¼ï¼ˆå­˜åœ¨éšæ‚£ï¼‰</td></tr><tr><td>least_conn</td><td>æœ€å°‘è¿æ¥æ–¹å¼</td></tr><tr><td>fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰</td><td>å“åº”æ—¶é—´æ–¹å¼</td></tr><tr><td>url_hashï¼ˆç¬¬ä¸‰æ–¹ï¼‰</td><td>ä¾æ®URLåˆ†é…æ–¹å¼</td></tr></tbody></table><p>åœ¨è¿™é‡Œï¼Œåªè¯¦ç»†è¯´æ˜Nginxè‡ªå¸¦çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œç¬¬ä¸‰æ–¹ä¸å¤šæè¿°ã€‚</p><h3 id="_01ã€è½®è¯¢" tabindex="-1"><a class="header-anchor" href="#_01ã€è½®è¯¢"><span>01ã€ğŸŒŸè½®è¯¢</span></a></h3><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workPoll.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>æœ€åŸºæœ¬çš„é…ç½®æ–¹æ³•ï¼Œä¸Šé¢çš„ä¾‹å­å°±æ˜¯è½®è¯¢çš„æ–¹å¼ï¼Œ<mark>å®ƒæ˜¯upstreamæ¨¡å—é»˜è®¤çš„è´Ÿè½½å‡è¡¡é»˜è®¤ç­–ç•¥</mark>ã€‚æ¯ä¸ªè¯·æ±‚ä¼šæŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ã€‚</p><p>æœ‰å¦‚ä¸‹å‚æ•°ï¼š</p><p>fail_timeoutä¸max_failsç»“åˆä½¿ç”¨ã€‚max_failsè®¾ç½®fail_timeoutå‚æ•°è®¾ç½®çš„æ—¶é—´å†…æœ€å¤§å¤±è´¥æ¬¡æ•°ï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…ï¼Œæ‰€æœ‰é’ˆå¯¹è¯¥æœåŠ¡å™¨çš„è¯·æ±‚éƒ½å¤±è´¥äº†ï¼Œé‚£ä¹ˆè®¤ä¸ºè¯¥æœåŠ¡å™¨ä¼šè¢«è®¤ä¸ºæ˜¯åœæœºäº†ï¼Œfail_timeæœåŠ¡å™¨ä¼šè¢«è®¤ä¸ºåœæœºçš„æ—¶é—´é•¿åº¦,é»˜è®¤ä¸º10sã€‚backupæ ‡è®°è¯¥æœåŠ¡å™¨ä¸ºå¤‡ç”¨æœåŠ¡å™¨ã€‚å½“ä¸»æœåŠ¡å™¨åœæ­¢æ—¶ï¼Œè¯·æ±‚ä¼šè¢«å‘é€åˆ°å®ƒè¿™é‡Œã€‚downæ ‡è®°æœåŠ¡å™¨æ°¸ä¹…åœæœºäº†ã€‚</p><p>æ³¨æ„ï¼š</p><ul><li>åœ¨è½®è¯¢ä¸­ï¼Œå¦‚æœæœåŠ¡å™¨downæ‰äº†ï¼Œä¼šè‡ªåŠ¨å‰”é™¤è¯¥æœåŠ¡å™¨ã€‚</li><li>ç¼ºçœé…ç½®å°±æ˜¯è½®è¯¢ç­–ç•¥ã€‚</li><li>æ­¤ç­–ç•¥é€‚åˆæœåŠ¡å™¨é…ç½®ç›¸å½“ï¼Œæ— çŠ¶æ€ä¸”çŸ­å¹³å¿«çš„æœåŠ¡ä½¿ç”¨ã€‚</li></ul><h3 id="_02ã€weight-é‡é‡-æƒé‡-åŠ æƒè½®è¯¢" tabindex="-1"><a class="header-anchor" href="#_02ã€weight-é‡é‡-æƒé‡-åŠ æƒè½®è¯¢"><span>02ã€ğŸŒŸweight(é‡é‡ï¼Œæƒé‡ï¼ŒåŠ æƒè½®è¯¢)</span></a></h3><p>åŠ æƒé‡æ–¹å¼ï¼Œåœ¨è½®è¯¢ç­–ç•¥çš„åŸºç¡€ä¸ŠæŒ‡å®šè½®è¯¢çš„å‡ ç‡ã€‚ä¾‹å­å¦‚ä¸‹ï¼š</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workWeight.png" alt="image-20210823165956196" tabindex="0" loading="lazy"><figcaption>image-20210823165956196</figcaption></figure><p>æƒé‡æ–¹å¼ï¼Œåœ¨è½®è¯¢ç­–ç•¥çš„åŸºç¡€ä¸ŠæŒ‡å®šè½®è¯¢çš„å‡ ç‡ã€‚ä¾‹å­å¦‚ä¸‹ï¼š</p><p>åœ¨è¯¥ä¾‹å­ä¸­ï¼Œweightå‚æ•°ç”¨äºæŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightçš„é»˜è®¤å€¼ä¸º1,ï¼›weightçš„æ•°å€¼ä¸è®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œæ¯”å¦‚Tomcat 7.0è¢«è®¿é—®çš„å‡ ç‡ä¸ºå…¶ä»–æœåŠ¡å™¨çš„ä¸¤å€ã€‚</p><p>å®˜ç½‘åœ°å€ï¼š<a href="http://nginx.org/en/docs/stream/ngx_stream_upstream_module.html" target="_blank" rel="noopener noreferrer">http://nginx.org/en/docs/stream/ngx_stream_upstream_module.html</a></p><p>weighté»˜è®¤å€¼æ˜¯ï¼š1</p><p>æ³¨æ„ï¼š</p><ul><li>æƒé‡è¶Šé«˜åˆ†é…åˆ°éœ€è¦å¤„ç†çš„è¯·æ±‚è¶Šå¤šã€‚</li><li>æ­¤ç­–ç•¥å¯ä»¥ä¸least_connå’Œip_hashç»“åˆä½¿ç”¨ã€‚</li><li>æ­¤ç­–ç•¥æ¯”è¾ƒé€‚åˆæœåŠ¡å™¨çš„ç¡¬ä»¶é…ç½®å·®åˆ«æ¯”è¾ƒå¤§çš„æƒ…å†µã€‚</li></ul><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> tomcatservers {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8080 </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">weight</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  server 127.0.0.1:8081 </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">weight</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  server 127.0.0.1:8082 </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">weight</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_03ã€upstream" tabindex="-1"><a class="header-anchor" href="#_03ã€upstream"><span>03ã€upStream</span></a></h3><p>å®˜ç½‘å‚è€ƒï¼š<a href="http://nginx.org/en/docs/stream/ngx_stream_upstream_module.html" target="_blank" rel="noopener noreferrer">http://nginx.org/en/docs/stream/ngx_stream_upstream_module.html</a></p><p>serverç›¸å…³å‚æ•°ï¼š</p><p>upstreamæŒ‡ä»¤å­˜åœ¨ä¸€äº›å‚æ•°ï¼š</p><ul><li><p>max_connsï¼šï¼ˆä¿æŠ¤æœåŠ¡èµ„æºï¼‰</p><ul><li><p>å¯ä»¥é™åˆ¶ä¸€å°æœåŠ¡å™¨çš„æœ€å¤§è®¿é—®è¿æ¥æ•°ã€‚é»˜è®¤å€¼æ˜¯ï¼š0ã€‚ä»£è¡¨ä¸é™åˆ¶ã€‚</p></li><li><p>å…¶å®ä¹Ÿå°±æ˜¯é™æµçš„å«ä¹‰ã€‚</p></li><li><p>ä»€ä¹ˆæ ·å­çš„æƒ…å†µä¸‹ä¼šä½¿ç”¨max_conns: æ¯”å¦‚ä¸´æ—¶å¢åŠ ä¸€å°æœåŠ¡å™¨ï¼Œä½†æ˜¯è¿™ä¸ªæœåŠ¡å™¨è¿˜è¿è¡Œç€åˆ«äººæœåŠ¡ï¼Œä½ æœ‰ä¸æƒ³è¿‡å¤šæ¶ˆè€—æœåŠ¡å™¨çš„èµ„æºï¼Œè€Œæ˜¯ä¸´æ—¶é¡¶æ›¿è¯·æ±‚ï¼Œè¿™ä¸ªå¯ä»¥è€ƒè™‘ä½¿ç”¨max_connè¿›è¡Œé…ç½®ï¼Œ</p></li></ul><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> tomcatservers {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8080  max_conns=100;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8081  max_conns=2;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8082  max_conns=2;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>slow_start(å•†ä¸šç‰ˆä½¿ç”¨)</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">sets the time during which the server will recover its weight from zero to a nominal value, when unhealthy server becomes healthy, or when the server becomes available after a period of time it was considered unavailable. Default value is zero, i.e. slow start is disabled.</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">ç¿»è¯‘ï¼šå½“ä½ è®¾ç½®è¿™ä¸ªå€¼ä»¥åï¼Œä½ çš„æƒé‡weightä¼šä»0æ…¢æ…¢å‡çº§åˆ°ä¸€ä¸ªæ­£å¸¸çš„valueï¼Œå¯ä»¥æŠŠä¸€ä¸ªä¸å¥åº·çš„æœåŠ¡å™¨ç¼–ç¨‹å¥åº·çš„æœåŠ¡å™¨ï¼Œå®ƒæ˜¯åœ¨ä¸€æ®µæ—¶é—´ä»¥ååœ¨å»å¯åŠ¨ã€‚é»˜è®¤æ˜¯ï¼š0ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ï¼šå…³é—­çš„</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¯ä»¥è®©ä¸€ä¸ªæœåŠ¡å™¨æ…¢æ…¢çš„åŠ å…¥åˆ°é›†ç¾¤ä¸­</li><li>è¿™ä¸ªå‚æ•°ä¸èƒ½ä½¿ç”¨åˆ°ï¼šhashå’Œrandomçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸­</li><li>å¦‚æœåœ¨ upstream ä¸­åªæœ‰ä¸€å° serverï¼Œåˆ™è¯¥å‚æ•°å¤±æ•ˆ</li></ul><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> tomcatservers {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8080  </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">weight</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> slow_start=60s;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8081  </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">weight</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  server 127.0.0.1:8082  </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">weight</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ ¡éªŒå‡ºç°é”™è¯¯</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">iZuf62zev3la2ivndnxra5Z</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> web1]</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># nginx -t</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">nginx: [emerg] </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">invalid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> parameter </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;slow_start=60s&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> in /usr/local/nginx/nginx/conf/yykk.conf:2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">nginx: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">configuration</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> file /usr/local/nginx/nginx/conf/nginx.conf test failed</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŸå› æ˜¯å‘Šè¯‰ä½ ï¼šslow_start åªèƒ½ä½¿ç”¨æ˜¯å•†ä¸šç‰ˆæœ¬nginxä¸­ã€‚</p></li><li><p>down</p><ul><li>ä½œç”¨ï¼šç”¨äºæ ‡è¯†æœåŠ¡å™¨å½“å‰çš„çŠ¶æ€ã€‚</li><li>å¦‚æœç”¨downè¿›è¡ŒæœåŠ¡å™¨æ ‡è®°å°±å‘Šè¯‰å½“å‰æœåŠ¡å™¨ä¸å¯ç”¨çš„çŠ¶æ€ã€‚</li></ul><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> tomcatservers {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8080  </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">weight</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> down;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8081  </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">weight</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  server 127.0.0.1:8082  </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">weight</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šè¿°çš„é…ç½®ä»¥åï¼Œ8080çš„æœåŠ¡å™¨å°±è¢«åœæ­¢ä½¿ç”¨äº†ã€‚åªèƒ½è®¿é—®åˆ°8081å’Œ8082ã€‚</p></li><li><p>backup(é‡è¦)</p><ul><li>ä½œç”¨ï¼šå¤‡æœº</li><li>backup è¡¨ç¤ºå½“å‰æœåŠ¡å™¨èŠ‚ç‚¹æ˜¯å¤‡ç”¨æœºï¼Œ<mark>åªæœ‰åœ¨å…¶ä»–çš„æœåŠ¡å™¨éƒ½å®•æœºä»¥å</mark>ï¼Œè‡ªå·±æ‰ä¼šåŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œè¢«ç”¨æˆ·è®¿é—®åˆ°</li><li>ç”¨å¤„ï¼šå¯ä»¥ç”¨äºç°åº¦éƒ¨ç½²æ—¶å€™çš„ä¸€ç§æ›´æ›¿æ•ˆæœã€‚</li></ul><p><strong>é—®é¢˜ï¼šä»€ä¹ˆæ ·å­çš„æƒ…å†µä¸‹è½½ä¼šå‡ºç°å…¨éƒ¨å®•æœºå‘¢ï¼Ÿ</strong></p><ul><li>åœ¨å‘å¸ƒé¡¹ç›®çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šæŠŠç½‘ç«™å…³åœ</li><li>é«˜å¹¶å‘æŠŠç½‘ç«™å†²å®äº†ã€‚</li></ul><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> tomcatservers {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8080  </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">weight</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> backup;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8081  </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">weight</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  server 127.0.0.1:8082  </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">weight</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™ä¸ªæ—¶å€™æ­£å¸¸è®¿é—®åªèƒ½è®¿é—®åˆ°8081å’Œ8082æœåŠ¡å™¨ï¼Œ8080æœåŠ¡å™¨ä½œä¸ºå¤‡æœº</li><li>å¯ä»¥å°è¯•å§8081å’Œ8082æœåŠ¡æŒ‚æ‰ï¼Œè¿™ä¸ª8080æœåŠ¡å™¨ç”Ÿæ•ˆ</li><li>åœ¨æŠŠ8081å’Œ8082æœåŠ¡å¯åŠ¨ï¼Œè¿™ä¸ªæ—¶å€™8080åˆè¢«æŒ‚èµ·å½“åšå¤‡ç”¨æœº</li></ul></li><li><p>max_fails å’Œ fail_timeout</p><ul><li>ä¸¤ä¸ªå‚æ•°éœ€è¦é…åˆä¸€èµ·ä½¿ç”¨æ‰æœ‰æ„ä¹‰ã€‚max_fails ï¼šè¡¨ç¤ºå¤±è´¥å‡ æ¬¡ï¼Œåˆ™æ ‡è®°serverå·²å®•æœºï¼Œå‰”å‡ºä¸Šæ¸¸æœåŠ¡ã€‚fail_timeout ï¼šè¡¨ç¤ºå¤±è´¥çš„é‡è¯•æ—¶é—´ã€‚</li><li>max_fails ï¼šæœ€å¤§çš„å¤±è´¥æ¬¡æ•°ï¼Œå¦‚æœæœåŠ¡å™¨è®¿é—®çš„æ¬¡æ•°è¶…è¿‡è¿™ä¸ªæ¬¡æ•°å°±ä¼šå‰”é™¤æœåŠ¡ï¼Œnginxå°±ä¼šè®¤ä¸ºè¿™ä¸ªæœåŠ¡å™¨æ˜¯æŒ‚æ‰çš„æœåŠ¡ã€‚</li><li>fail_timeoutï¼šå¤±è´¥çš„æ—¶é—´ç‰‡æ®µï¼Œå¦‚æœé…ç½®fail_timeout=10s,max_fails=5æ¬¡ï¼Œä»£è¡¨çš„å«ä¹‰æ˜¯ï¼šåœ¨10sä¹‹å†…å¦‚æœå‡ºç°çš„é”™è¯¯æ¬¡æ•°å¤§äºç­‰äº5æ¬¡çš„æ—¶å€™ï¼Œå°±ä¼šè®¤ä¸ºè¿™ä¸ªæœåŠ¡å™¨æ˜¯ä¸€ä¸ªæŒ‚æ‰çš„æœåŠ¡ï¼Œnginxä¼šå‰”é™¤è¯¥æœåŠ¡ã€‚</li><li>max_failsï¼šé»˜è®¤å€¼æ˜¯ï¼š1</li><li>fail_timeoutçš„é»˜è®¤å€¼æ˜¯ï¼š10s</li></ul></li></ul><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> tomcatservers {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8080  </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">max_fails</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> fail_timeout=5s; // </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">è¿™äº›é…ç½®ä¸€å®šè¦å’Œä½ ç¨‹åºæ¯æ¯ç›¸å…³</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8081  </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">weight</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  server 127.0.0.1:8082  </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">weight</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ™ä»£è¡¨åœ¨1ç§’å†…è¯·æ±‚æŸä¸€serverå¤±è´¥è¾¾åˆ°2æ¬¡åï¼Œåˆ™è®¤ä¸ºè¯¥serverå·²ç»æŒ‚äº†æˆ–è€…å®•æœºäº†ï¼Œéšåå†è¿‡1ç§’ï¼Œè¿™1ç§’å†…ä¸ä¼šæœ‰æ–°çš„è¯·æ±‚åˆ°è¾¾åˆšåˆšæŒ‚æ‰çš„èŠ‚ç‚¹ä¸Šï¼Œè€Œæ˜¯ä¼š è¿ä½œçš„serverï¼Œ1ç§’åä¼šå†æœ‰æ–°è¯·æ±‚å°è¯•è¿æ¥æŒ‚æ‰çš„serverï¼Œå¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œé‡å¤ä¸Šä¸€è¿‡ç¨‹ï¼Œç›´åˆ°æ¢å¤ã€‚</p><h3 id="_04ã€ip-hash" tabindex="-1"><a class="header-anchor" href="#_04ã€ip-hash"><span>04ã€ip_hash</span></a></h3><p>æŒ‡å®šè´Ÿè½½å‡è¡¡å™¨æŒ‰ç…§åŸºäºå®¢æˆ·ç«¯IPçš„åˆ†é…æ–¹å¼ï¼Œè¿™ä¸ªæ–¹æ³•ç¡®ä¿äº†ç›¸åŒçš„å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸€ç›´å‘é€åˆ°ç›¸åŒçš„æœåŠ¡å™¨ï¼Œä»¥ä¿è¯sessionä¼šè¯ã€‚è¿™æ ·æ¯ä¸ªè®¿å®¢éƒ½å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œ<mark>å¯ä»¥è§£å†³sessionä¸èƒ½è·¨æœåŠ¡å™¨çš„é—®é¢˜ã€‚</mark></p><ul><li><p>åœ¨nginxç‰ˆæœ¬1.3.1ä¹‹å‰ï¼Œä¸èƒ½åœ¨ip_hashä¸­ä½¿ç”¨æƒé‡ï¼ˆweightï¼‰ã€‚</p></li><li><p>ip_hashä¸èƒ½ä¸backupåŒæ—¶ä½¿ç”¨ã€‚</p></li><li><p>æ­¤ç­–ç•¥é€‚åˆæœ‰çŠ¶æ€æœåŠ¡ï¼Œæ¯”å¦‚sessionã€‚</p></li><li><p>å½“æœ‰æœåŠ¡å™¨éœ€è¦å‰”é™¤ï¼Œå¿…é¡»æ‰‹åŠ¨downæ‰ã€‚</p></li></ul><p>æ–‡æ¡£ï¼š<a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#ip_hash" target="_blank" rel="noopener noreferrer">https://nginx.org/en/docs/http/ngx_http_upstream_module.html#ip_hash</a></p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workIp_hash.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>é…ç½®å¦‚ä¸‹ï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> backend {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    ip_hash</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> backend1.example.com;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> backend2.example.com;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> backend3.example.com down;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> backend4.example.com;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æºç åˆ†æ</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * Copyright (C) Igor Sysoev</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * Copyright (C) Nginx, Inc.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &lt;ngx_config.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &lt;ngx_core.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &lt;ngx_http.h&gt;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    /* the round robin data must be first */</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    ngx_http_upstream_rr_peer_data_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   rrp;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    ngx_uint_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                         hash;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    u_char</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                             addrlen;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    u_char</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                            *</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">addr;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    u_char</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                             tries;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ngx_event_get_peer_pt              get_rr_peer;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ngx_http_upstream_ip_hash_peer_data_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ngx_int_t</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ngx_http_upstream_init_ip_hash_peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ngx_http_request_t</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">r</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    ngx_http_upstream_srv_conf_t</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">us</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ngx_int_t</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ngx_http_upstream_get_ip_hash_peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ngx_peer_connection_t</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">pc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> char</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx_http_upstream_ip_hash</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ngx_conf_t</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ngx_command_t</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cmd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">conf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ngx_command_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  ngx_http_upstream_ip_hash_commands</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">[]</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    { </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx_string</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ip_hash&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      NGX_HTTP_UPS_CONF</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">|</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">NGX_CONF_NOARGS,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      ngx_http_upstream_ip_hash,</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      ngx_null_command</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ngx_http_module_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  ngx_http_upstream_ip_hash_module_ctx </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                  /* preconfiguration */</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                  /* postconfiguration */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                  /* create main configuration */</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                  /* init main configuration */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                  /* create server configuration */</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                  /* merge server configuration */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                  /* create location configuration */</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    NULL</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                   /* merge location configuration */</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ngx_module_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  ngx_http_upstream_ip_hash_module </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    NGX_MODULE_V1,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    &amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ngx_http_upstream_ip_hash_module_ctx,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> /* module context */</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ngx_http_upstream_ip_hash_commands,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    /* module directives */</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    NGX_HTTP_MODULE,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                       /* module type */</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                  /* init master */</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                  /* init module */</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                  /* init process */</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                  /* init thread */</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                  /* exit thread */</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                  /* exit process */</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                  /* exit master */</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    NGX_MODULE_V1_PADDING</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> u_char</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ngx_http_upstream_ip_hash_pseudo_addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ngx_int_t</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx_http_upstream_init_ip_hash</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ngx_conf_t</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ngx_http_upstream_srv_conf_t</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">us</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx_http_upstream_init_round_robin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(cf, us) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">!=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> NGX_OK) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> NGX_ERROR;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    us</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">init</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ngx_http_upstream_init_ip_hash_peer;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> NGX_OK;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ngx_int_t</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx_http_upstream_init_ip_hash_peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ngx_http_request_t</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">r</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    ngx_http_upstream_srv_conf_t</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">us</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> sockaddr_in                     </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">sin;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NGX_HAVE_INET6</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> sockaddr_in6                    </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">sin6;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#endif</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    ngx_http_upstream_ip_hash_peer_data_t</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  *</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">iphp;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    iphp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ngx_palloc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">r</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pool</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">sizeof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ngx_http_upstream_ip_hash_peer_data_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (iphp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> NGX_ERROR;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    r</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">rrp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx_http_upstream_init_round_robin_peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(r, us) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">!=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> NGX_OK) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> NGX_ERROR;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    r</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">get</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ngx_http_upstream_get_ip_hash_peer;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    switch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">r</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">connection</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sockaddr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sa_family</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    case</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> AF_INET:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        sin </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> sockaddr_in </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">r</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">connection</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sockaddr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">addr</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">u_char</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">sin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">sin_addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">s_addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">addrlen</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        break</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NGX_HAVE_INET6</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    case AF_INET6:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        sin6 </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> sockaddr_in6 </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) r</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">connection</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">sockaddr;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        iphp</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">addr </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">u_char</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">sin6</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">sin6_addr.s6_addr;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        iphp</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">addrlen </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 16</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        break</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    default</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">addr</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ngx_http_upstream_ip_hash_pseudo_addr;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">addrlen</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">hash</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 89</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tries</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">get_rr_peer</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ngx_http_upstream_get_round_robin_peer;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> NGX_OK;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ngx_int_t</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx_http_upstream_get_ip_hash_peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ngx_peer_connection_t</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">pc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    ngx_http_upstream_ip_hash_peer_data_t</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  *</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">iphp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> data;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    time_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                        now;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    ngx_int_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                     w;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    uintptr_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                     m;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    ngx_uint_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    i, n, p, hash;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    ngx_http_upstream_rr_peer_t</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  *</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">peer;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ngx_log_debug1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(NGX_LOG_DEBUG_HTTP, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">pc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                   &quot;get ip hash peer, try: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%u</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">i&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">pc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tries</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    /* TODO: cached */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ngx_http_upstream_rr_peers_rlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rrp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">peers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tries</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 20</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;"> ||</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rrp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">peers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">single</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        ngx_http_upstream_rr_peers_unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rrp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">peers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get_rr_peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(pc, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">rrp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    now </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ngx_time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    pc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cached</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    pc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">connection</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    hash </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">hash</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ( ;; ) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (i </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; i </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ngx_uint_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">addrlen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; i</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            hash </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (hash </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 113</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> +</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[i]) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">%</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6271</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        w </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> hash </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">%</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rrp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">peers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">total_weight</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        peer </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rrp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">peers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        p </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        while</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (w </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&gt;=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">weight</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            w </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">-=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">weight</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            peer </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">next</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            p</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        n </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> p </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> sizeof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">uintptr_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        m </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">uintptr_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &lt;&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> p </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">%</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> sizeof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">uintptr_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rrp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tried</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[n] </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> m) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            goto</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> next;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        ngx_log_debug2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(NGX_LOG_DEBUG_HTTP, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">pc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                       &quot;get ip hash peer, hash: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%u</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">i </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%04X</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">L&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, p, (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">uint64_t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) m);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        ngx_http_upstream_rr_peer_lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rrp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">peers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, peer);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">down</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            ngx_http_upstream_rr_peer_unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rrp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">peers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, peer);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            goto</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> next;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">max_fails</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">            &amp;&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">fails</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &gt;=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">max_fails</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">            &amp;&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> now </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">-</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">checked</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &lt;=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">fail_timeout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            ngx_http_upstream_rr_peer_unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rrp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">peers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, peer);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            goto</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> next;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">max_conns</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">conns</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &gt;=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">max_conns</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            ngx_http_upstream_rr_peer_unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rrp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">peers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, peer);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            goto</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> next;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        break</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    next:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">++</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tries</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 20</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            ngx_http_upstream_rr_peers_unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rrp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">peers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get_rr_peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(pc, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">rrp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rrp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">current</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> peer;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    pc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sockaddr</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sockaddr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    pc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">socklen</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">socklen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    pc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">conns</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (now </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">-</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">checked</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">fail_timeout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">checked</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> now;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ngx_http_upstream_rr_peer_unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rrp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">peers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, peer);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ngx_http_upstream_rr_peers_unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rrp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">peers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">rrp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tried</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[n] </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">|=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> m;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    iphp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">hash</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> hash;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> NGX_OK;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> char</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ngx_http_upstream_ip_hash</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">ngx_conf_t</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ngx_command_t</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cmd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">conf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    ngx_http_upstream_srv_conf_t</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  *</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">uscf;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    uscf </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ngx_http_conf_get_module_srv_conf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(cf, ngx_http_upstream_module);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">uscf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">init_upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        ngx_conf_log_error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(NGX_LOG_WARN, cf, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                           &quot;load balancing method redefined&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    uscf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">peer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">init_upstream</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ngx_http_upstream_init_ip_hash;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    uscf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">flags</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> NGX_HTTP_UPSTREAM_CREATE</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                  |</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">NGX_HTTP_UPSTREAM_WEIGHT</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                  |</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">NGX_HTTP_UPSTREAM_MAX_CONNS</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                  |</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">NGX_HTTP_UPSTREAM_MAX_FAILS</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                  |</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">NGX_HTTP_UPSTREAM_FAIL_TIMEOUT</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                  |</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">NGX_HTTP_UPSTREAM_DOWN;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> NGX_CONF_OK;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å›¾è§£è¯´æ˜ï¼š</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workOnlyhash.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>å¦‚æœæ˜¯åœ¨åŒä¸€å±€åŸŸç½‘å†…ï¼Œç®—å‡ºçš„hashæ˜¯ä¸€è‡´çš„ï¼Œè¿™æ ·ä»–ä»¬å°±ä¼šå‡ºç°ç›¸åŒçš„hashã€‚</p><h3 id="_05ã€ä¸€è‡´æ€§hash" tabindex="-1"><a class="header-anchor" href="#_05ã€ä¸€è‡´æ€§hash"><span>05ã€ä¸€è‡´æ€§hash</span></a></h3><p>ip_hashå­˜åœ¨çš„é—®é¢˜å¦‚ä¸‹ï¼š</p><ul><li>ä¸Šé¢çš„hashè´Ÿè½½å‡è¡¡å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœä¸€ä¸ªæœåŠ¡å™¨æŒ‚æ‰äº†ï¼Œhashçš„è®¡ç®—å°±éœ€è¦å…¨éƒ¨é‡æ–°è®¡ç®—ï¼Œå¦‚æœæ˜¯åœ¨å¹¶å‘éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œç”¨è¿™ç§ç®—æ³•æ¥å®ç°çš„è¯ï¼Œå¯èƒ½ä¼šé€ æˆå¤§é‡çš„è¯·æ±‚åœ¨æŸä¸€ä¸ªæ—¶åˆ»å¤±è´¥ã€‚</li><li>æˆ–è€…èŠ‚ç‚¹å¢åŠ ä¹Ÿä¼šå‘ç”Ÿè¿™ç§é—®é¢˜çš„å‡ºç°</li><li>hashç®—æ³•è¿˜ä¼šé€ æˆæ•°æ®çš„æœåŠ¡çš„å€¾æ–œ</li></ul><p>è§£å†³ä¸Šé¢çš„é—®é¢˜å¯ä»¥ä½¿ç”¨ï¼šä¸€è‡´æ€§hashç®—æ³•ã€‚</p><p>ä¸€ç›´æ€§Hashç®—æ³•åœ¨å¾ˆå¤šåœºæ™¯ä¸‹éƒ½æœ‰åº”ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨åˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿä¸­ï¼Œç»å¸¸ç”¨å…¶æ¥è¿›è¡Œç¼“å­˜çš„è®¿é—®çš„è´Ÿè½½å‡è¡¡ï¼Œæ¯”å¦‚ï¼šredisç­‰&lt;k,v&gt;éå…³ç³»æ•°æ®åº“ä½œä¸ºç¼“å­˜ç³»ç»Ÿã€‚æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹é‡‡ç”¨å–æ¨¡æ–¹å¼è¿›è¡Œç¼“å­˜çš„é—®é¢˜ã€‚</p><p><strong>ä¸€è‡´æ€§Hashç®—æ³•çš„ä½¿ç”¨åœºæ™¯</strong></p><p>å‡è®¾æˆ‘ä»¬çš„å°†10å°rediséƒ¨ç½²ä¸ºæˆ‘ä»¬çš„ç¼“å­˜ç³»ç»Ÿï¼Œå­˜å‚¨&lt;k,v&gt;æ•°æ®ï¼Œå­˜å‚¨æ–¹å¼æ˜¯ï¼šhash(k)%10ï¼Œç”¨æ¥å°†æ•°æ®åˆ†æ•£åˆ°å„ä¸ªrediså­˜å‚¨ç³»ç»Ÿä¸­ã€‚è¿™æ ·åšï¼Œæœ€å¤§çš„é—®é¢˜å°±åœ¨äºï¼šå¦‚æœæ­¤ç¼“å­˜ç³»ç»Ÿæ‰©å±•ï¼ˆæ¯”å¦‚ï¼šå¢åŠ æˆ–å‡å°‘redisæœåŠ¡å™¨çš„æ•°é‡ï¼‰ï¼ŒèŠ‚ç‚¹æ•…éšœå®•æœºç­‰å°†ä¼šå¸¦æ¥å¾ˆé«˜çš„ä»£ä»·ã€‚æ¯”å¦‚ï¼šæˆ‘ä»¬ä¸šåŠ¡é‡å¢å¤§äº†ï¼Œéœ€è¦æ‰©å±•æˆ‘ä»¬çš„ç¼“å­˜ç³»ç»Ÿï¼Œå†å¢åŠ ä¸€å°redisä½œä¸ºç¼“å­˜æœåŠ¡å™¨ï¼Œé‚£ä¹ˆåæ¥çš„æ•°æ®&lt;k,v&gt;çš„æ•£åˆ—æ–¹å¼å˜ä¸ºäº†ï¼šhash(k)%11ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæˆ‘ä»¬è¦æŸ¥æ‰¾æ‰©å±•ä¹‹å‰çš„æ•°æ®ï¼Œåˆ©ç”¨hash(k)%11ï¼Œåˆ™ä¼šæ‰¾ä¸åˆ°å¯¹åº”çš„å­˜å‚¨æœåŠ¡å™¨ã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™å¤§é‡çš„æ•°æ®å¤±æ•ˆäº†ï¼ˆè®¿é—®ä¸åˆ°äº†ï¼‰ã€‚<br> è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±è¦è¿›è¡Œæ•°æ®çš„é‡ç°æ•£åˆ—ï¼Œå¦‚æœæ˜¯å°†redisä½œä¸ºå­˜å‚¨ç³»ç»Ÿï¼Œåˆ™éœ€è¦è¿›è¡Œæ•°æ®è¿ç§»ï¼Œç„¶åè¿›è¡Œæ¢å¤ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™å°±æ„å‘³ç€æ¯æ¬¡å¢å‡æœåŠ¡å™¨çš„æ—¶å€™ï¼Œé›†ç¾¤å°±éœ€è¦å¤§é‡çš„é€šä¿¡ï¼Œè¿›è¡Œæ•°æ®è¿ç§»ï¼Œè¿™ä¸ªå¼€é”€æ˜¯éå¸¸å¤§çš„ã€‚å¦‚æœåªæ˜¯ç¼“å­˜ï¼Œé‚£ä¹ˆç¼“å­˜å°±éƒ½å¤±æ•ˆäº†ã€‚è¿™ä¼šå½¢æˆç¼“å­˜å‡»ç©¿ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›å·¨å¤§ï¼Œå¯èƒ½ä¼šå¯¼è‡´åº”ç”¨çš„å´©æºƒã€‚</p><p>å› ä¸ºå¯¹äºhash(k)çš„èŒƒå›´åœ¨intèŒƒå›´ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†0~2^32ä½œä¸ºä¸€ä¸ªç¯ã€‚å…¶æ­¥éª¤ä¸ºï¼š<br> 1ï¼Œæ±‚å‡ºæ¯ä¸ªæœåŠ¡å™¨çš„hashï¼ˆæœåŠ¡å™¨ipï¼‰å€¼ï¼Œå°†å…¶é…ç½®åˆ°ä¸€ä¸ª 0~2^n çš„åœ†ç¯ä¸Šï¼ˆné€šå¸¸å–32ï¼‰ã€‚<br> 2ï¼Œç”¨åŒæ ·çš„æ–¹æ³•æ±‚å‡ºå¾…å­˜å‚¨å¯¹è±¡çš„ä¸»é”® hashå€¼ï¼Œä¹Ÿå°†å…¶é…ç½®åˆ°è¿™ä¸ªåœ†ç¯ä¸Šï¼Œç„¶åä»æ•°æ®æ˜ å°„åˆ°çš„ä½ç½®å¼€å§‹é¡ºæ—¶é’ˆæŸ¥æ‰¾ï¼Œå°†æ•°æ®åˆ†å¸ƒåˆ°æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šã€‚<br> å…¶åˆ†å¸ƒå¦‚å›¾ï¼š</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workHash.png" alt="1501874-20190328153045991-59319015" tabindex="0" loading="lazy"><figcaption>1501874-20190328153045991-59319015</figcaption></figure><p>è¿™æ˜¯ä¸€è‡´æ€§hashç®—æ³•çš„åŸºæœ¬åŸç†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹ï¼Œæ­¤ç®—æ³•æ˜¯å¦‚ä½•è§£å†³ æˆ‘ä»¬ä¸Šè¾¹ è¯´çš„ ç¼“å­˜ç³»ç»Ÿçš„æ‰©å±•æˆ–è€…èŠ‚ç‚¹å®•æœºå¯¼è‡´çš„ç¼“å­˜å¤±æ•ˆçš„é—®é¢˜ã€‚æ¯”å¦‚:å†åŠ å…¥ä¸€ä¸ªredisèŠ‚ç‚¹ï¼š</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workHashAddRedis2.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p><strong>é›ªå´©æ•ˆåº”</strong></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œå½“æœ‰èŠ‚ç‚¹å®•æœºæ—¶ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ã€‚å¦‚ä¸‹å›¾ï¼š</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workHashAddRedis.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>å¦‚ä¸Šå›¾ï¼Œå½“BèŠ‚ç‚¹å®•æœºåï¼ŒåŸæœ¬å­˜å‚¨åœ¨BèŠ‚ç‚¹çš„k1ï¼Œk2å°†ä¼šè¿ç§»åˆ°èŠ‚ç‚¹Cä¸Šï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å¾ˆå¤§çš„é—®é¢˜ã€‚å¦‚æœBä¸Šå­˜å‚¨çš„æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œå°†æ•°æ®è¿ç§»åˆ°CèŠ‚ç‚¹ä¸Šï¼Œç„¶åCéœ€è¦æ‰¿å—B+Cçš„æ•°æ®ï¼Œä¹Ÿæ‰¿å—ä¸ä½ï¼Œä¹ŸæŒ‚äº†ã€‚ã€‚ã€‚ã€‚ç„¶åç»§ç»­CDéƒ½æŒ‚äº†ã€‚è¿™å°±é€ æˆäº†é›ªå´©æ•ˆåº”ã€‚<br> ä¸Šé¢ä¼šé€ æˆé›ªå´©æ•ˆåº”çš„åŸå› åˆ†æï¼š<br> å¦‚æœä¸å­˜åœ¨çƒ­ç‚¹æ•°æ®çš„æ—¶å€™ï¼Œæ¯å°æœºå™¨çš„æ‰¿å—çš„å‹åŠ›æ˜¯M/2(å‡è®¾æ¯å°æœºå™¨çš„æœ€é«˜è´Ÿè½½èƒ½åŠ›ä¸ºM)ï¼ŒåŸæœ¬æ˜¯ä¸ä¼šæœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯ï¼Œè¿™ä¸ªæ—¶å€™AæœåŠ¡å™¨ç”±äºæœ‰çƒ­ç‚¹æ•°æ®æŒ‚äº†ï¼Œç„¶åAçš„æ•°æ®è¿ç§»è‡³Bï¼Œå¯¼è‡´Bæ‰€éœ€è¦æ‰¿å—çš„å‹åŠ›å˜ä¸ºMï¼ˆè¿˜ä¸è€ƒè™‘çƒ­ç‚¹æ•°æ®è®¿é—®çš„å‹åŠ›ï¼‰ï¼Œæ‰€ä»¥è¿™ä¸ªå¤±è´¥Bæ˜¯å¿…æŒ‚çš„ï¼Œç„¶åCè‡³å°‘éœ€è¦æ‰¿å—1.5Mçš„å‹åŠ›ã€‚ã€‚ã€‚ã€‚ç„¶åå¤§å®¶ä¸€èµ·æŒ‚ã€‚ã€‚ã€‚<br> æ‰€ä»¥æˆ‘ä»¬é€šè¿‡ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œä¹‹æ‰€ä»¥ä¼šå¤§å®¶ä¸€èµ·æŒ‚ï¼ŒåŸå› åœ¨äºå¦‚æœä¸€å°æœºå™¨æŒ‚äº†ï¼Œé‚£ä¹ˆå®ƒçš„å‹åŠ›å…¨éƒ¨è¢«åˆ†é…åˆ°ä¸€å°æœºå™¨ä¸Šï¼Œå¯¼è‡´é›ªå´©ã€‚</p><p>æ€ä¹ˆè§£å†³é›ªå´©é—®é¢˜å‘¢ï¼Œè¿™æ—¶å€™éœ€è¦å¼•å…¥è™šæ‹ŸèŠ‚ç‚¹æ¥è¿›è¡Œè§£å†³ã€‚<br> è™šæ‹ŸèŠ‚ç‚¹</p><p>è™šæ‹ŸèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹æ¯ä¸ªå®é™…çš„èŠ‚ç‚¹ï¼Œè™šæ‹Ÿå‡ºå¤šä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œç”¨æ¥æ˜ å°„åˆ°åœˆä¸Šçš„ä½ç½®ï¼Œè¿›è¡Œå­˜å‚¨å¯¹åº”çš„æ•°æ®ã€‚å¦‚ä¸‹å›¾ï¼š</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workHashMoreNode.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>å¦‚ä¸Šå›¾ï¼šAèŠ‚ç‚¹å¯¹åº”A1ï¼ŒA2ï¼ŒBCDèŠ‚ç‚¹åŒç†ã€‚è¿™æ—¶å€™ï¼Œå¦‚æœAèŠ‚ç‚¹æŒ‚äº†ï¼ŒAèŠ‚ç‚¹çš„æ•°æ®è¿ç§»æƒ…å†µæ˜¯:A1æ•°æ®ä¼šè¿ç§»åˆ°C2ï¼ŒA2æ•°æ®è¿ç§»åˆ°D1ã€‚è¿™å°±ç›¸å½“äºAçš„æ•°æ®è¢«Cå’ŒDåˆ†æ‹…äº†ï¼Œè¿™å°±é¿å…äº†é›ªå´©æ•ˆåº”çš„å‘é€ï¼Œè€Œä¸”è™šæ‹ŸèŠ‚ç‚¹æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰è®¾ç½®ï¼Œä½¿å…¶é€‚ç”¨äºæˆ‘ä»¬çš„åº”ç”¨ã€‚</p><p>å­˜åœ¨çš„é—®é¢˜<br> â¼€è‡´æ€§å“ˆå¸Œç®—æ³•åœ¨æœåŠ¡èŠ‚ç‚¹å¤ªå°‘æ—¶ï¼Œå®¹æ˜“å› ä¸ºèŠ‚ç‚¹åˆ†éƒ¨ä¸å‡åŒ€â½½é€ æˆæ•°æ®å€¾æ–œé—®é¢˜ã€‚ä¾‹å¦‚ç³»ç»Ÿä¸­åªæœ‰ä¸¤å°æœåŠ¡å™¨ï¼Œå…¶ç¯åˆ†å¸ƒå¦‚ä¸‹ï¼ŒèŠ‚ç‚¹2åªèƒ½è´Ÿè´£â¾®å¸¸â¼©çš„â¼€æ®µï¼Œâ¼¤é‡çš„å®¢æˆ·ç«¯è¯·æ±‚è½åœ¨äº†èŠ‚ç‚¹1ä¸Šï¼Œè¿™å°±æ˜¯æ•°æ®ï¼ˆè¯·æ±‚ï¼‰å€¾æ–œé—®é¢˜ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ç§æ•°æ®å€¾æ–œé—®é¢˜ï¼Œâ¼€è‡´æ€§å“ˆå¸Œç®—æ³•å¼•â¼Šäº†è™šæ‹ŸèŠ‚ç‚¹æœºåˆ¶ï¼Œå³å¯¹æ¯â¼€ä¸ªæœåŠ¡èŠ‚ç‚¹è®¡ç®—å¤šä¸ªå“ˆå¸Œï¼Œæ¯ä¸ªè®¡ç®—ç»“æœä½ç½®éƒ½æ”¾ç½®â¼€ä¸ªæ­¤æœåŠ¡èŠ‚ç‚¹ï¼Œç§°ä¸ºè™šæ‹ŸèŠ‚ç‚¹ã€‚</p><p>å…·ä½“åšæ³•å¯ä»¥åœ¨æœåŠ¡å™¨ipæˆ–ä¸»æœºåçš„åâ¾¯å¢åŠ å…¶ä»–å­—ç¬¦æ¥å®ç°ã€‚â½å¦‚ï¼Œå¯ä»¥ä¸ºæ¯å°æœåŠ¡å™¨è®¡ç®—ä¸‰ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œäºæ˜¯å¯ä»¥åˆ†åˆ«è®¡ç®— â€œèŠ‚ç‚¹1çš„ip#1â€ã€â€œèŠ‚ç‚¹1çš„ip#2â€ã€â€œèŠ‚ç‚¹1çš„ip#3â€ã€â€œèŠ‚ç‚¹2çš„ip#1â€ã€â€œèŠ‚ç‚¹2çš„ip#2â€ã€â€œèŠ‚ç‚¹2çš„ip#3â€çš„å“ˆå¸Œå€¼ï¼Œäºæ˜¯å½¢æˆå…­ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œå½“å®¢æˆ·ç«¯è¢«è·¯ç”±åˆ°è™šæ‹ŸèŠ‚ç‚¹çš„æ—¶å€™å…¶å®æ˜¯è¢«è·¯ç”±åˆ°è¯¥è™šæ‹ŸèŠ‚ç‚¹æ‰€å¯¹åº”çš„çœŸå®èŠ‚ç‚¹ã€‚<br><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_workHash11.png" alt="image" loading="lazy"></p><p>è‡ªå®šä¹‰ä¸€è‡´æ€§hashç®—æ³•ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> java.util.SortedMap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> java.util.TreeMap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // å®šä¹‰æœåŠ¡å™¨ip</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tomcatServers</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;192.222.1.30&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;19.16.1.2&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;192.168.1.13&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        SortedMap</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">serverMap</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TreeMap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // å®šä¹‰é’ˆå¯¹æ¯ä¸ªçœŸå®æœåŠ¡å™¨è™šæ‹Ÿå‡ºæ¥â¼ä¸ªèŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        int</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> virtaulCount</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tomcatServer</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> tomcatServers) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            int</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> hash</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Math</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">abs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">tomcatServer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">hashCode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            serverMap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(hash,tomcatServer);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            //åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; i </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> virtaulCount; i++) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                int</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> virtaulHash</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Math</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">abs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">((tomcatServer</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;a&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">hashCode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                serverMap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(virtaulHash,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ç”±&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">tomcatServer</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;çš„è™šæ‹ŸèŠ‚ç‚¹å¤„ç†&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        //å®šä¹‰å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">userServers</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;19.11.12.1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;10.113.120.79&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;107.180.13.5&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> userServer</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> userServers){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            int</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> userhash</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Math</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">abs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">userServer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">hashCode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            //è·å–åˆ°æ‰€æœ‰keyå¤§äºç”¨æˆ·hashå€¼çš„mapé›†åˆ</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">            SortedMap</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sortedMap</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> serverMap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tailMap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(userhash);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">sortedMap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">isEmpty</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()){</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                //å¦‚æœä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºå½“å‰ç”¨æˆ·èŠ‚ç‚¹åæ²¡æœ‰æœåŠ¡å™¨èŠ‚ç‚¹ï¼Œåˆ™ä½¿ç”¨åœ†ç¯ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">                Integer</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> firstKey</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> serverMap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">firstKey</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;å®¢æˆ·ç«¯&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">userServer</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ä½¿ç”¨æœåŠ¡å™¨&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">serverMap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(firstKey));</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                //ä¸ä¸ºç©ºåˆ™å¯»æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç”¨æˆ·hashçš„key</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">                Integer</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> firstKey</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> sortedMap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">firstKey</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;å®¢æˆ·ç«¯&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">userServer</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ä½¿ç”¨æœåŠ¡å™¨&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">serverMap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(firstKey));</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®ä¸€è‡´æ€§hashç­–ç•¥</p><p>nginxçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸­ä¸åŒ…å«ä¸€è‡´æ€§hashï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®‰è£…ngx_http_upstream_consistent_hashæ¨¡å—åˆ°æˆ‘ä»¬çš„nginxä¸­</p><p>å¯ä»¥åˆ°nginxçš„src/http/modulesä¸‹æŸ¥çœ‹å·²ç»å®‰è£…çš„æ¨¡å—ï¼Œæ¯”å¦‚ip_hashç­–ç•¥</p><p>ngx_http_upstream_consistent_hash æ¨¡å—æ˜¯â¼€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼Œä½¿â½¤â¼€ä¸ªå†…éƒ¨â¼€è‡´æ€§hashç®—æ³•æ¥é€‰æ‹©åˆé€‚çš„åç«¯èŠ‚ç‚¹ã€‚è¯¥æ¨¡å—å¯ä»¥æ ¹æ®é…ç½®å‚æ•°é‡‡å–ä¸åŒçš„â½…å¼å°†è¯·æ±‚å‡åŒ€æ˜ å°„åˆ°åç«¯æœºå™¨ï¼Œ<br> consistent_hash $remote_addrï¼šå¯ä»¥æ ¹æ®å®¢æˆ·ç«¯ipæ˜ å°„<br> consistent_hash $request_uriï¼šæ ¹æ®å®¢æˆ·ç«¯è¯·æ±‚çš„uriæ˜ å°„<br> consistent_hash $argsï¼šæ ¹æ®å®¢æˆ·ç«¯æºå¸¦çš„å‚æ•°è¿›â¾æ˜ </p><p>å®‰è£…æ­¥éª¤ï¼š</p><p>1ï¼‰githubä¸‹è½½nginxâ¼€è‡´æ€§hashè´Ÿè½½å‡è¡¡æ¨¡å— <a href="https://github.com/replay/ngx_http_consistent_hash" target="_blank" rel="noopener noreferrer">https://github.com/replay/ngx_http_consistent_hash</a></p><p>2ï¼‰å°†ä¸‹è½½çš„å‹ç¼©åŒ…ä¸Šä¼ åˆ°nginxæœåŠ¡å™¨ï¼Œå¹¶è§£å‹<br> 3ï¼‰æˆ‘ä»¬å·²ç»ç¼–è¯‘å®‰è£…è¿‡nginxï¼Œæ­¤æ—¶è¿›â¼Šå½“æ—¶nginxçš„å®‰è£…ç›®å½•â½¬å½•ï¼Œæ‰§â¾å¦‚ä¸‹å‘½ä»¤ï¼Œç­‰å·åè¾¹ä¸ºä¸‹è½½çš„æ’ä»¶çš„è§£å‹ç›®å½•</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./configure</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --add-module=/www/kuangstudy/nignx/ngx_http_consistent_hash-master</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>4ï¼‰ç¼–è¯‘å’Œå®‰è£…</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>5ï¼‰åœ¨nginx.confâ½‚ä»¶ä¸­é…ç½®</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>upstream somestream {</span></span>
<span class="line"><span>  consistent_hash $request_uri;</span></span>
<span class="line"><span>  server 10.50.1.3:11211;</span></span>
<span class="line"><span>  server 10.50.1.4:11211;</span></span>
<span class="line"><span>  server 10.50.1.5:11211;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_06ã€url-hash-ç»†ç²’åº¦çš„è´Ÿè½½å‡è¡¡" tabindex="-1"><a class="header-anchor" href="#_06ã€url-hash-ç»†ç²’åº¦çš„è´Ÿè½½å‡è¡¡"><span>06ã€url_hash(ç»†ç²’åº¦çš„è´Ÿè½½å‡è¡¡)</span></a></h3><ul><li>ç¬¬ä¸‰æ–¹çš„è´Ÿè½½å‡è¡¡ç­–ç•¥çš„å®ç°éœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹æ’ä»¶ã€‚</li><li>æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œè¦é…åˆç¼“å­˜å‘½ä¸­æ¥ä½¿ç”¨ã€‚åŒä¸€ä¸ªèµ„æºå¤šæ¬¡è¯·æ±‚ï¼Œå¯èƒ½ä¼šåˆ°è¾¾ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå¯¼è‡´ä¸å¿…è¦çš„å¤šæ¬¡ä¸‹è½½ï¼Œç¼“å­˜å‘½ä¸­ç‡ä¸é«˜ï¼Œä»¥åŠä¸€äº›èµ„æºæ—¶é—´çš„æµªè´¹ã€‚è€Œä½¿ç”¨url_hashï¼Œå¯ä»¥ä½¿å¾—åŒä¸€ä¸ªurlï¼ˆä¹Ÿå°±æ˜¯åŒä¸€ä¸ªèµ„æºè¯·æ±‚ï¼‰ä¼šåˆ°è¾¾åŒä¸€å°æœåŠ¡å™¨ï¼Œä¸€æ—¦ç¼“å­˜ä½äº†èµ„æºï¼Œå†æ­¤æ”¶åˆ°è¯·æ±‚ï¼Œå°±å¯ä»¥ä»ç¼“å­˜ä¸­è¯»å–ã€‚</li></ul><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> dynamic_zuoyu {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    hash </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">request_uri</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å®ç°æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> localhost:8080;  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> localhost:8081;  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> localhost:8082;  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> localhost:8083;  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>javaä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> com.kuang.contorller</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> com.kuang.utils.ip.IpUtils</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.beans.factory.annotation.Value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.web.bind.annotation.GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.web.bind.annotation.RestController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> javax.servlet.http.HttpServletRequest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> java.util.HashMap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> java.util.Map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/**</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * </span><span style="--shiki-light:#A626A4;--shiki-light-font-style:italic;--shiki-dark:#C678DD;--shiki-dark-font-style:italic;">@author</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> é£å“¥</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * @Title: å­¦ç›¸ä¼´å‡ºå“</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * @Description: æˆ‘ä»¬æœ‰ä¸€ä¸ªå­¦ä¹ ç½‘ç«™ï¼šhttps://www.kuangstudy.com</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> * @date 2021/8/23 12:31</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RestController</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TestController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Value</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;${server.port}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/nginx/test&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> test</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        Map</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">map</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> HashMap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ipAddr</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> IpUtils</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getIpAddr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(request);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;port1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getLocalPort</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;port2&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getServerPort</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;port3&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getRemotePort</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;url&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getRequestURL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;port4&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, port);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ipAddr&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, ipAddr);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> map;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/c/list&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//8081</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> courselist</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        Map</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">map</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> HashMap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ipAddr</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> IpUtils</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getIpAddr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(request);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;port1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getLocalPort</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;port2&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getServerPort</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;port3&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getRemotePort</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;url&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getRequestURL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;port4&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, port);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ipAddr&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, ipAddr);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> map;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/u/info&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//8080</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> userlist</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        Map</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">map</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> HashMap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ipAddr</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> IpUtils</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getIpAddr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(request);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;port1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getLocalPort</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;port2&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getServerPort</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;port3&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getRemotePort</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;url&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getRequestURL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;port4&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, port);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ipAddr&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, ipAddr);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> map;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è®¿é—®åœ°å€ï¼š</p><p><a href="http://139.224.164.101/c/list" target="_blank" rel="noopener noreferrer">http://139.224.164.101/c/list</a></p><p><a href="http://139.224.164.101/u/info" target="_blank" rel="noopener noreferrer">http://139.224.164.101/u/info</a></p><p><a href="http://139.224.164.101/nginx/test" target="_blank" rel="noopener noreferrer">http://139.224.164.101/nginx/test</a></p><h3 id="_07ã€least-conn" tabindex="-1"><a class="header-anchor" href="#_07ã€least-conn"><span>07ã€least_conn</span></a></h3><p>æŠŠè¯·æ±‚è½¬å‘ç»™è¿æ¥æ•°è¾ƒå°‘çš„åç«¯æœåŠ¡å™¨ã€‚è½®è¯¢ç®—æ³•æ˜¯æŠŠè¯·æ±‚å¹³å‡çš„è½¬å‘ç»™å„ä¸ªåç«¯ï¼Œä½¿å®ƒä»¬çš„è´Ÿè½½å¤§è‡´ç›¸åŒï¼›ä½†æ˜¯ï¼Œæœ‰äº›è¯·æ±‚å ç”¨çš„æ—¶é—´å¾ˆé•¿ï¼Œä¼šå¯¼è‡´å…¶æ‰€åœ¨çš„åç«¯è´Ÿè½½è¾ƒé«˜ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œleast_connè¿™ç§æ–¹å¼å°±å¯ä»¥è¾¾åˆ°æ›´å¥½çš„è´Ÿè½½å‡è¡¡æ•ˆæœã€‚</p><p>é…ç½®å¦‚ä¸‹ï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> tomcatservers {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #æŠŠè¯·æ±‚è½¬å‘ç»™è¿æ¥æ•°è¾ƒå°‘çš„åç«¯æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  least_conn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8080;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8081;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8082;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼š</p><ul><li>æ­¤è´Ÿè½½å‡è¡¡ç­–ç•¥é€‚åˆè¯·æ±‚å¤„ç†æ—¶é—´é•¿çŸ­ä¸ä¸€é€ æˆæœåŠ¡å™¨è¿‡è½½çš„æƒ…å†µã€‚</li></ul><h3 id="_08ã€fair-æ”¶è´¹" tabindex="-1"><a class="header-anchor" href="#_08ã€fair-æ”¶è´¹"><span>08ã€fair (æ”¶è´¹)</span></a></h3><p>æŒ‰ç…§æœåŠ¡å™¨ç«¯çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> dynamic_zuoyu {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8080 fair;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> 	server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8081; </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  	server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:8082;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_09ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_09ã€æ€»ç»“"><span>09ã€æ€»ç»“</span></a></h3><p>ä»¥ä¸Šä¾¿æ˜¯6ç§è´Ÿè½½å‡è¡¡ç­–ç•¥çš„å®ç°æ–¹å¼ï¼Œå…¶ä¸­é™¤äº†è½®è¯¢å’Œè½®è¯¢æƒé‡å¤–ï¼Œéƒ½æ˜¯Nginxæ ¹æ®ä¸åŒçš„ç®—æ³•å®ç°çš„ã€‚åœ¨å®é™…è¿ç”¨ä¸­ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„åœºæ™¯é€‰æ‹©æ€§è¿ç”¨ï¼Œå¤§éƒ½æ˜¯å¤šç§ç­–ç•¥ç»“åˆä½¿ç”¨ä»¥è¾¾åˆ°å®é™…éœ€æ±‚ã€‚</p><h2 id="_09ã€æ‚é¡¹" tabindex="-1"><a class="header-anchor" href="#_09ã€æ‚é¡¹"><span>09ã€æ‚é¡¹</span></a></h2><h3 id="_1ã€nginxå¯åŠ¨å¤±è´¥æ‰¾ä¸åˆ°-pidæ–‡ä»¶å¦‚ä½•å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_1ã€nginxå¯åŠ¨å¤±è´¥æ‰¾ä¸åˆ°-pidæ–‡ä»¶å¦‚ä½•å¤„ç†"><span>1ã€Nginxå¯åŠ¨å¤±è´¥æ‰¾ä¸åˆ° pidæ–‡ä»¶å¦‚ä½•å¤„ç†</span></a></h3><p>1ã€åœ¨å¯åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‡ºç°äº†&quot;/var/run/nginx/nginx.pid failed &quot;é”™è¯¯ä¿¡æ¯çš„æ—¶å€™ã€‚</p><ul><li><p>ä¸€èˆ¬æ˜¯æ–‡ä»¶ç›®å½•ä¸å­˜åœ¨</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/run/nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>æˆ–è€…æ–‡ä»¶è¢«è¯¯åˆ </p></li></ul><p>2ã€è§£å†³æ–¹æ¡ˆï¼š</p><ul><li><p>é‡æ–°åˆ›å»ºæ­¤ç›®å½•å³å¯</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/run/nginx/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>å¦‚æœé‡å¯è¿‡ç¨‹ä¸­æŠ¥é”™å¦‚ä¸‹å¼‚å¸¸ï¼š</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">nginx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> -s reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>å°±ç”¨æŒ‡å®šçš„nginx.confæ–‡ä»¶è¿›è¡Œå¯åŠ¨</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/local/nginx/conf/nginx.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>ç„¶ååœ¨é‡å¯å¯åŠ¨nginxæœåŠ¡</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><h3 id="_2ã€ä¼˜é›…çš„å…³é—­nginxæœåŠ¡" tabindex="-1"><a class="header-anchor" href="#_2ã€ä¼˜é›…çš„å…³é—­nginxæœåŠ¡"><span>2ã€ä¼˜é›…çš„å…³é—­nginxæœåŠ¡</span></a></h3><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¼ºåˆ¶å…³é—­</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¦‚æœç”¨æˆ·è¯·æ±‚è¿˜æ­£åœ¨ä¸nginx æœåŠ¡æ­£åœ¨æ‰“äº¤é“ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯ä¸ä¼šé€€å‡ºnginxæœåŠ¡ã€‚ç›´åˆ°ç”¨æˆ·çš„è¿æ¥å“åº”å®Œæ¯•æ‰å…³é—­</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> quit</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3ã€æŸ¥çœ‹nginxçš„é…ç½®" tabindex="-1"><a class="header-anchor" href="#_3ã€æŸ¥çœ‹nginxçš„é…ç½®"><span>3ã€æŸ¥çœ‹Nginxçš„é…ç½®</span></a></h3><p>æŸ¥çœ‹nginxå®‰è£…ç›®å½•å’Œæ—¥å¿—çš„ç›®å½•ï¼Œå°±ä½¿ç”¨nginx -V</p><p>ä½†æ˜¯å‰ææ˜¯ï¼šä½ å¿…é¡»æ˜¯ä½¿ç”¨<code>./configuration</code>çš„æŒ‡å®šç›®å½•å®‰å…¨ã€‚</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -V</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@iZuf62zev3la2ivndnxra5Z nginx]# nginx -V</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> version:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx/1.20.1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">built</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> by</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gcc</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4.8.5</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 20150623</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (Red </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Hat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 4.8.5-44</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) (</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">GCC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">built</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> with</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OpenSSL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1.0.2k-fips</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  26</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Jan</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2017</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">TLS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SNI</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> support</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enabled</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">configure</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> arguments:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --prefix=/usr/local/nginx/nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --pid-path=/var/run/nginx/nginx.pid</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --lock-path=/var/lock/nginx.lock</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --error-log-path=/var/log/nginx/error.log</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --http-log-path=/var/log/nginx/access.log</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --with-http_gzip_static_module</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --http-client-body-temp-path=/var/temp/nginx/client</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --http-proxy-temp-path=/var/temp/nginx/proxy</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --http-fastcgi-temp-path=/var/temp/nginx/fastgi</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --http-uwsgi-temp-path=/var/temp/nginx/uwsgi</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --http-scgi-temp-path=/var/temp/nginx/scgi</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --with-http_stub_status_module</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --with-http_ssl_module</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4ã€nginxæ—¥å¿—æ–‡ä»¶åˆ†å‰²" tabindex="-1"><a class="header-anchor" href="#_4ã€nginxæ—¥å¿—æ–‡ä»¶åˆ†å‰²"><span>4ã€Nginxæ—¥å¿—æ–‡ä»¶åˆ†å‰²</span></a></h3><p>ç°æœ‰çš„æ—¥å¿—éƒ½ä¼šå­˜åœ¨ access.log æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ä¼šè¶Šæ¥è¶Šå¤šï¼Œä½“ç§¯ä¼šè¶Šæ¥è¶Šå¤§ï¼Œä¸ä¾¿äºè¿ç»´äººå‘˜æŸ¥çœ‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æŠŠ</p><p>æ–‡ä»¶åˆ‡å‰²ä¸ºå¤šä»½ä¸åŒçš„å°æ–‡ä»¶ä½œä¸ºæ—¥å¿—ï¼Œåˆ‡å‰²è§„åˆ™å¯ä»¥ä»¥ å¤© ä¸ºå•ä½ï¼Œå¦‚æœæ¯å¤©æœ‰å‡ ç™¾Gæˆ–è€…å‡ ä¸ªTçš„æ—¥å¿—çš„è¯ï¼Œåˆ™å¯ä»¥æŒ‰éœ€ä»¥ æ¯åŠå¤©</p><p>æˆ–è€… æ¯å°æ—¶ å¯¹æ—¥å¿—åˆ‡å‰²ä¸€</p><p><strong>å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</strong></p><ol><li><p>åˆ›å»ºä¸€ä¸ªshellå¯æ‰§è¡Œæ–‡ä»¶ï¼š <a href="http://cutlogs.sh" target="_blank" rel="noopener noreferrer">cutlogs.sh</a> ï¼Œå†…å®¹ä¸ºï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/bash </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LOG_PATH</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/var/log/nginx&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">RECORD_TIME</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">date</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;yesterday&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +%Y-%m-%d+%H:%M</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">PID</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/usr/local/nginx/logs/nginx.pid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mv</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> ${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LOG_PATH</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/access.log</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> ${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LOG_PATH</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/access.</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">RECORD_TIME</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mv</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> ${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LOG_PATH</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/error.log</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> ${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LOG_PATH</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/error.</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">RECORD_TIME</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">kill</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -USR1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $PID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä¸º <a href="http://cutlogs.sh" target="_blank" rel="noopener noreferrer">cutlogs.sh</a> æ·»åŠ å¯æ‰§è¡Œçš„æƒé™</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">chmod</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +x</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cutlogs.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>æµ‹è¯•æ—¥å¿—åˆ‡å‰²åçš„ç»“æœ:</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./cutlogs.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_log1.png" alt="log" tabindex="0" loading="lazy"><figcaption>log</figcaption></figure></li></ol><h3 id="_5ã€nginxçš„æ—¥å¿—æ–‡ä»¶è‡ªåŠ¨åˆ‡å‰²" tabindex="-1"><a class="header-anchor" href="#_5ã€nginxçš„æ—¥å¿—æ–‡ä»¶è‡ªåŠ¨åˆ‡å‰²"><span>5ã€Nginxçš„æ—¥å¿—æ–‡ä»¶è‡ªåŠ¨åˆ‡å‰²</span></a></h3><p><strong>Nginx</strong> <strong>æ—¥å¿—åˆ‡å‰²</strong>**-**<strong>å®šæ—¶</strong></p><p><strong>ä½¿ç”¨å®šæ—¶ä»»åŠ¡</strong></p><ol><li>å®‰è£…å®šæ—¶ä»»åŠ¡ï¼š</li></ol><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> crontabs</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>crontab -e ç¼–è¾‘å¹¶ä¸”æ·»åŠ ä¸€è¡Œæ–°çš„ä»»åŠ¡ï¼š</li></ol><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">crontab</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*/1 * * * * /usr/local/nginx/cutlogs.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="3"><li>é‡å¯å®šæ—¶ä»»åŠ¡ï¼š</li></ol><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> crond</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>é™„ï¼šå¸¸ç”¨å®šæ—¶ä»»åŠ¡å‘½ä»¤ï¼š</li></ul><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> crond</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> //å¯åŠ¨æœåŠ¡</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> crond</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> //å…³é—­æœåŠ¡</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> crond</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> //é‡å¯æœåŠ¡</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> crond</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reload</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> //é‡æ–°è½½å…¥é…ç½®</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">crontab</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> //</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ç¼–è¾‘ä»»åŠ¡</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">crontab</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -l</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> //</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å®šæ—¶ä»»åŠ¡è¡¨è¾¾å¼ï¼š</strong></p><p>Cronè¡¨è¾¾å¼æ˜¯ï¼Œåˆ†ä¸º5æˆ–6ä¸ªåŸŸï¼Œæ¯ä¸ªåŸŸä»£è¡¨ä¸€ä¸ªå«ä¹‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure><img src="https://gavvy-cloud.oss-cn-shenzhen.aliyuncs.com/web/nginx_cronTime.png" alt="time" tabindex="0" loading="lazy"><figcaption>time</figcaption></figure><p><strong>å¸¸ç”¨è¡¨è¾¾å¼ï¼š</strong></p><p>æ¯åˆ†é’Ÿæ‰§è¡Œï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">*/1 * * * *</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ¯æ—¥å‡Œæ™¨ï¼ˆæ¯å¤©æ™šä¸Š23:59ï¼‰æ‰§è¡Œï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">59</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 23</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ¯æ—¥å‡Œæ™¨1ç‚¹æ‰§è¡Œï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>æ¯å¤©å®šæ—¶ä¸ºæ•°æ®åº“å¤‡ä»½ï¼š<a href="https://www.cnblogs.com/leechenxiang/p/7110382.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/leechenxiang/p/7110382.html</a></p></blockquote></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/Cospk/edit/main/src/middleware/ç½‘å…³/Nginx.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><span class="vp-meta-info" data-allow-mismatch="text">2025/1/17 08:43:17</span></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: xie18115@outlook.com">xiaoxie001</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><!----><a class="route-link auto-link next" href="/vuepress-app/middleware/%E7%BD%91%E5%85%B3/Kong.html" aria-label="Kong"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Kong<!----></div></a></nav><div id="comment" class="giscus-wrapper input-top vp-comment" vp-comment style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">é»˜è®¤é¡µè„š</div><div class="vp-copyright">Copyright Â© 2025 xiaoxie </div></footer></div><!--]--><!--[--><!----><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/vuepress-app/assets/app-DQYOo4w9.js" defer></script>
  </body>
</html>
