import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as r,a,o as i}from"./app-DIJDtupu.js";const n={};function s(o,e){return i(),r("div",null,e[0]||(e[0]=[a('<p>æ¬¢è¿æ¥åˆ° [Golang ç³»åˆ—æ•™ç¨‹](<a href="https://studygolang.com/subject/2" target="_blank" rel="noopener noreferrer">https://studygolang.com/subject/2</a>)çš„ç¬¬ 29 ç¯‡ã€‚ ## ä»€ä¹ˆæ˜¯ deferï¼Ÿ `defer` è¯­å¥çš„ç”¨é€”æ˜¯ï¼šå«æœ‰ `defer` è¯­å¥çš„å‡½æ•°ï¼Œä¼šåœ¨è¯¥å‡½æ•°å°†è¦è¿”å›ä¹‹å‰ï¼Œè°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå®šä¹‰å¯èƒ½çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç¤ºä¾‹å°±å¾ˆå®¹æ˜“æ˜ç™½äº†ã€‚ ## ç¤ºä¾‹</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>go package main import ( &quot;fmt&quot; ) func finished() { fmt.Println(&quot;Finished finding largest&quot;) } func largest(nums \\[\\]int) { defer finished() fmt.Println(&quot;Started finding largest&quot;) max := nums\\[0\\] for \\_, v := range nums { if v &gt; max { max = v } } fmt.Println(&quot;Largest number in&quot;, nums, &quot;is&quot;, max) } func main() { nums := \\[\\]int{78, 109, 2, 563, 300} largest(nums) }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>[åœ¨ playground ä¸Šè¿è¡Œ](<a href="https://play.golang.org/p/IlccOsuSUE" target="_blank" rel="noopener noreferrer">https://play.golang.org/p/IlccOsuSUE</a>) ä¸Šé¢çš„ç¨‹åºå¾ˆç®€å•ï¼Œå°±æ˜¯æ‰¾å‡ºä¸€ä¸ªç»™å®šåˆ‡ç‰‡çš„æœ€å¤§å€¼ã€‚`largest` å‡½æ•°æ¥æ”¶ä¸€ä¸ª int ç±»å‹çš„[åˆ‡ç‰‡](<a href="https://studygolang.com/articles/12121" target="_blank" rel="noopener noreferrer">https://studygolang.com/articles/12121</a>)ä½œä¸ºå‚æ•°ï¼Œç„¶åæ‰“å°å‡ºè¯¥åˆ‡ç‰‡ä¸­çš„æœ€å¤§å€¼ã€‚`largest` å‡½æ•°çš„ç¬¬ä¸€è¡Œçš„è¯­å¥ä¸º `defer finished()`ã€‚è¿™è¡¨ç¤ºåœ¨ `finished()` å‡½æ•°å°†è¦è¿”å›ä¹‹å‰ï¼Œä¼šè°ƒç”¨ `finished()` å‡½æ•°ã€‚è¿è¡Œè¯¥ç¨‹åºï¼Œä½ ä¼šçœ‹åˆ°æœ‰å¦‚ä¸‹è¾“å‡ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span> Started finding largest Largest number in \\[78 109 2 563 300\\] is 563 Finished finding largest</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>`largest` å‡½æ•°å¼€å§‹æ‰§è¡Œåï¼Œä¼šæ‰“å°ä¸Šé¢çš„ä¸¤è¡Œè¾“å‡ºã€‚è€Œå°±åœ¨ `largest` å°†è¦è¿”å›çš„æ—¶å€™ï¼Œåˆè°ƒç”¨äº†æˆ‘ä»¬çš„å»¶è¿Ÿå‡½æ•°ï¼ˆDeferred Functionï¼‰ï¼Œæ‰“å°å‡º `Finished finding largest` çš„æ–‡æœ¬ã€‚ğŸ˜ƒ ## å»¶è¿Ÿæ–¹æ³• `defer` ä¸ä»…é™äº[å‡½æ•°](<a href="https://studygolang.com/articles/11892" target="_blank" rel="noopener noreferrer">https://studygolang.com/articles/11892</a>)çš„è°ƒç”¨ï¼Œè°ƒç”¨[æ–¹æ³•](<a href="https://studygolang.com/articles/12264" target="_blank" rel="noopener noreferrer">https://studygolang.com/articles/12264</a>)ä¹Ÿæ˜¯åˆæ³•çš„ã€‚æˆ‘ä»¬å†™ä¸€ä¸ªå°ç¨‹åºæ¥æµ‹è¯•å§ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>go package main import ( &quot;fmt&quot; ) type person struct { firstName string lastName string } func (p person) fullName() { fmt.Printf(&quot;%s %s&quot;,p.firstName,p.lastName) } func main() { p := person { firstName: &quot;John&quot;, lastName: &quot;Smith&quot;, } defer p.fullName() fmt.Printf(&quot;Welcome &quot;) }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>[åœ¨ playground ä¸Šè¿è¡Œ](<a href="https://play.golang.org/p/lZ74OAwnRD" target="_blank" rel="noopener noreferrer">https://play.golang.org/p/lZ74OAwnRD</a>) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨ç¬¬ 22 è¡Œå»¶è¿Ÿäº†ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ã€‚è€Œå…¶ä»–çš„ä»£ç å¾ˆç›´è§‚ï¼Œè¿™é‡Œä¸å†è§£é‡Šã€‚è¯¥ç¨‹åºè¾“å‡ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span> Welcome John Smith</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="å®å‚å–å€¼-arguments-evaluation-åœ¨-go-è¯­è¨€ä¸­-å¹¶éåœ¨è°ƒç”¨å»¶è¿Ÿå‡½æ•°çš„æ—¶å€™æ‰ç¡®å®šå®å‚-è€Œæ˜¯å½“æ‰§è¡Œ-defer-è¯­å¥çš„æ—¶å€™-å°±ä¼šå¯¹å»¶è¿Ÿå‡½æ•°çš„å®å‚è¿›è¡Œæ±‚å€¼ã€‚-é€šè¿‡ä¸€ä¸ªä¾‹å­å°±èƒ½å¤Ÿç†è§£äº†ã€‚" tabindex="-1"><a class="header-anchor" href="#å®å‚å–å€¼-arguments-evaluation-åœ¨-go-è¯­è¨€ä¸­-å¹¶éåœ¨è°ƒç”¨å»¶è¿Ÿå‡½æ•°çš„æ—¶å€™æ‰ç¡®å®šå®å‚-è€Œæ˜¯å½“æ‰§è¡Œ-defer-è¯­å¥çš„æ—¶å€™-å°±ä¼šå¯¹å»¶è¿Ÿå‡½æ•°çš„å®å‚è¿›è¡Œæ±‚å€¼ã€‚-é€šè¿‡ä¸€ä¸ªä¾‹å­å°±èƒ½å¤Ÿç†è§£äº†ã€‚"><span>å®å‚å–å€¼ï¼ˆArguments Evaluationï¼‰ åœ¨ Go è¯­è¨€ä¸­ï¼Œå¹¶éåœ¨è°ƒç”¨å»¶è¿Ÿå‡½æ•°çš„æ—¶å€™æ‰ç¡®å®šå®å‚ï¼Œè€Œæ˜¯å½“æ‰§è¡Œ `defer` è¯­å¥çš„æ—¶å€™ï¼Œå°±ä¼šå¯¹å»¶è¿Ÿå‡½æ•°çš„å®å‚è¿›è¡Œæ±‚å€¼ã€‚ é€šè¿‡ä¸€ä¸ªä¾‹å­å°±èƒ½å¤Ÿç†è§£äº†ã€‚</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>go package main import ( &quot;fmt&quot; ) func printA(a int) { fmt.Println(&quot;value of a in deferred function&quot;, a) } func main() { a := 5 defer printA(a) a = 10 fmt.Println(&quot;value of a before deferred function call&quot;, a) }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>[åœ¨ playground ä¸Šè¿è¡Œ](<a href="https://play.golang.org/p/sBnwrUgObd" target="_blank" rel="noopener noreferrer">https://play.golang.org/p/sBnwrUgObd</a>) åœ¨ä¸Šé¢çš„ç¨‹åºé‡Œçš„ç¬¬ 11 è¡Œï¼Œ`a` çš„åˆå§‹å€¼ä¸º 5ã€‚åœ¨ç¬¬ 12 è¡Œæ‰§è¡Œ `defer` è¯­å¥çš„æ—¶å€™ï¼Œç”±äº `a` ç­‰äº 5ï¼Œå› æ­¤å»¶è¿Ÿå‡½æ•° `printA` çš„å®å‚ä¹Ÿç­‰äº 5ã€‚æ¥ç€æˆ‘ä»¬åœ¨ç¬¬ 13 è¡Œå°† `a` çš„å€¼ä¿®æ”¹ä¸º 10ã€‚ä¸‹ä¸€è¡Œä¼šæ‰“å°å‡º `a` çš„å€¼ã€‚è¯¥ç¨‹åºè¾“å‡ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span> value of a before deferred function call 10 value of a in deferred function 5</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä»ä¸Šé¢çš„è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œåœ¨è°ƒç”¨äº† `defer` è¯­å¥åï¼Œè™½ç„¶æˆ‘ä»¬å°† `a` ä¿®æ”¹ä¸º 10ï¼Œä½†è°ƒç”¨å»¶è¿Ÿå‡½æ•° `printA(a)`åï¼Œä»ç„¶æ‰“å°çš„æ˜¯ 5ã€‚ ## defer æ ˆ å½“ä¸€ä¸ªå‡½æ•°å†…å¤šæ¬¡è°ƒç”¨ `defer` æ—¶ï¼ŒGo ä¼šæŠŠ `defer` è°ƒç”¨æ”¾å…¥åˆ°ä¸€ä¸ªæ ˆä¸­ï¼ŒéšåæŒ‰ç…§åè¿›å…ˆå‡ºï¼ˆLast In First Out, LIFOï¼‰çš„é¡ºåºæ‰§è¡Œã€‚ æˆ‘ä»¬ä¸‹é¢ç¼–å†™ä¸€ä¸ªå°ç¨‹åºï¼Œä½¿ç”¨ `defer` æ ˆï¼Œå°†ä¸€ä¸ªå­—ç¬¦ä¸²é€†åºæ‰“å°ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>go package main import ( &quot;fmt&quot; ) func main() { name := &quot;Naveen&quot; fmt.Printf(&quot;Orignal String: %s\\\\n&quot;, string(name)) fmt.Printf(&quot;Reversed String: &quot;) for \\_, v := range \\[\\]rune(name) { defer fmt.Printf(&quot;%c&quot;, v) } }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>[åœ¨ playground ä¸Šè¿è¡Œ](<a href="https://play.golang.org/p/HDk623ozuw" target="_blank" rel="noopener noreferrer">https://play.golang.org/p/HDk623ozuw</a>) åœ¨ä¸Šè¿°ç¨‹åºä¸­çš„ç¬¬ 11 è¡Œï¼Œ`for range` å¾ªç¯ä¼šéå†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶åœ¨ç¬¬ 12 è¡Œè°ƒç”¨äº† `defer fmt.Printf(&quot;%c&quot;, v)`ã€‚è¿™äº›å»¶è¿Ÿè°ƒç”¨ä¼šæ·»åŠ åˆ°ä¸€ä¸ªæ ˆä¸­ï¼ŒæŒ‰ç…§åè¿›å…ˆå‡ºçš„é¡ºåºæ‰§è¡Œï¼Œå› æ­¤ï¼Œè¯¥å­—ç¬¦ä¸²ä¼šé€†åºæ‰“å°å‡ºæ¥ã€‚è¯¥ç¨‹åºä¼šè¾“å‡ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span> Orignal String: Naveen Reversed String: neevaN</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="defer-çš„å®é™…åº”ç”¨-ç›®å‰ä¸ºæ­¢-æˆ‘ä»¬çœ‹åˆ°çš„ä»£ç ç¤ºä¾‹-éƒ½æ²¡æœ‰ä½“ç°å‡º-defer-çš„å®é™…ç”¨é€”ã€‚æœ¬èŠ‚æˆ‘ä»¬ä¼šçœ‹çœ‹-defer-çš„å®é™…åº”ç”¨ã€‚-å½“ä¸€ä¸ªå‡½æ•°åº”è¯¥åœ¨ä¸å½“å‰ä»£ç æµ-code-flow-æ— å…³çš„ç¯å¢ƒä¸‹è°ƒç”¨æ—¶-å¯ä»¥ä½¿ç”¨-defer-ã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç”¨åˆ°äº†-waitgroup-https-studygolang-com-articles-12512-ä»£ç ç¤ºä¾‹æ¥ç†è§£è¿™å¥è¯çš„å«ä¹‰ã€‚æˆ‘ä»¬é¦–å…ˆä¼šå†™ä¸€ä¸ªæ²¡æœ‰ä½¿ç”¨-defer-çš„ç¨‹åº-ç„¶åæˆ‘ä»¬ä¼šç”¨-defer-æ¥ä¿®æ”¹-çœ‹åˆ°-defer-å¸¦æ¥çš„å¥½å¤„ã€‚" tabindex="-1"><a class="header-anchor" href="#defer-çš„å®é™…åº”ç”¨-ç›®å‰ä¸ºæ­¢-æˆ‘ä»¬çœ‹åˆ°çš„ä»£ç ç¤ºä¾‹-éƒ½æ²¡æœ‰ä½“ç°å‡º-defer-çš„å®é™…ç”¨é€”ã€‚æœ¬èŠ‚æˆ‘ä»¬ä¼šçœ‹çœ‹-defer-çš„å®é™…åº”ç”¨ã€‚-å½“ä¸€ä¸ªå‡½æ•°åº”è¯¥åœ¨ä¸å½“å‰ä»£ç æµ-code-flow-æ— å…³çš„ç¯å¢ƒä¸‹è°ƒç”¨æ—¶-å¯ä»¥ä½¿ç”¨-defer-ã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç”¨åˆ°äº†-waitgroup-https-studygolang-com-articles-12512-ä»£ç ç¤ºä¾‹æ¥ç†è§£è¿™å¥è¯çš„å«ä¹‰ã€‚æˆ‘ä»¬é¦–å…ˆä¼šå†™ä¸€ä¸ªæ²¡æœ‰ä½¿ç”¨-defer-çš„ç¨‹åº-ç„¶åæˆ‘ä»¬ä¼šç”¨-defer-æ¥ä¿®æ”¹-çœ‹åˆ°-defer-å¸¦æ¥çš„å¥½å¤„ã€‚"><span>defer çš„å®é™…åº”ç”¨ ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„ä»£ç ç¤ºä¾‹ï¼Œéƒ½æ²¡æœ‰ä½“ç°å‡º `defer` çš„å®é™…ç”¨é€”ã€‚æœ¬èŠ‚æˆ‘ä»¬ä¼šçœ‹çœ‹ `defer` çš„å®é™…åº”ç”¨ã€‚ å½“ä¸€ä¸ªå‡½æ•°åº”è¯¥åœ¨ä¸å½“å‰ä»£ç æµï¼ˆCode Flowï¼‰æ— å…³çš„ç¯å¢ƒä¸‹è°ƒç”¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `defer`ã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç”¨åˆ°äº† [`WaitGroup`](<a href="https://studygolang.com/articles/12512" target="_blank" rel="noopener noreferrer">https://studygolang.com/articles/12512</a>) ä»£ç ç¤ºä¾‹æ¥ç†è§£è¿™å¥è¯çš„å«ä¹‰ã€‚æˆ‘ä»¬é¦–å…ˆä¼šå†™ä¸€ä¸ªæ²¡æœ‰ä½¿ç”¨ `defer` çš„ç¨‹åºï¼Œç„¶åæˆ‘ä»¬ä¼šç”¨ `defer` æ¥ä¿®æ”¹ï¼Œçœ‹åˆ° `defer` å¸¦æ¥çš„å¥½å¤„ã€‚</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>go package main import ( &quot;fmt&quot; &quot;sync&quot; ) type rect struct { length int width int } func (r rect) area(wg \\*sync.WaitGroup) { if r.length &lt; 0 { fmt.Printf(&quot;rect %v&#39;s length should be greater than zero\\\\n&quot;, r) wg.Done() return } if r.width &lt; 0 { fmt.Printf(&quot;rect %v&#39;s width should be greater than zero\\\\n&quot;, r) wg.Done() return } area := r.length \\* r.width fmt.Printf(&quot;rect %v&#39;s area %d\\\\n&quot;, r, area) wg.Done() } func main() { var wg sync.WaitGroup r1 := rect{-67, 89} r2 := rect{5, -67} r3 := rect{8, 9} rects := \\[\\]rect{r1, r2, r3} for \\_, v := range rects { wg.Add(1) go v.area(&amp;wg) } wg.Wait() fmt.Println(&quot;All go routines finished executing&quot;) }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>[åœ¨ playground ä¸Šè¿è¡Œ](<a href="https://play.golang.org/p/kXL85U0Dd%5C_" target="_blank" rel="noopener noreferrer">https://play.golang.org/p/kXL85U0Dd\\_</a>) åœ¨ä¸Šé¢çš„ç¨‹åºé‡Œï¼Œæˆ‘ä»¬åœ¨ç¬¬ 8 è¡Œåˆ›å»ºäº† `rect` ç»“æ„ä½“ï¼Œå¹¶åœ¨ç¬¬ 13 è¡Œåˆ›å»ºäº† `rect` çš„æ–¹æ³• `area`ï¼Œè®¡ç®—å‡ºçŸ©å½¢çš„é¢ç§¯ã€‚`area` æ£€æŸ¥äº†çŸ©å½¢çš„é•¿å®½æ˜¯å¦å°äºé›¶ã€‚å¦‚æœçŸ©å½¢çš„é•¿å®½å°äºé›¶ï¼Œå®ƒä¼šæ‰“å°å‡ºå¯¹åº”çš„æç¤ºä¿¡æ¯ï¼Œè€Œå¦‚æœå¤§äºé›¶ï¼Œå®ƒä¼šæ‰“å°å‡ºçŸ©å½¢çš„é¢ç§¯ã€‚ `main` å‡½æ•°åˆ›å»ºäº† 3 ä¸ª `rect` ç±»å‹çš„å˜é‡ï¼š`r1`ã€`r2` å’Œ `r3`ã€‚åœ¨ç¬¬ 34 è¡Œï¼Œæˆ‘ä»¬æŠŠè¿™ 3 ä¸ªå˜é‡æ·»åŠ åˆ°äº† `rects` åˆ‡ç‰‡é‡Œã€‚è¯¥åˆ‡ç‰‡æ¥ç€ä½¿ç”¨ `for range` å¾ªç¯éå†ï¼ŒæŠŠ `area` æ–¹æ³•ä½œä¸ºä¸€ä¸ªå¹¶å‘çš„ Go åç¨‹è¿›è¡Œè°ƒç”¨ï¼ˆç¬¬ 37 è¡Œï¼‰ã€‚æˆ‘ä»¬ç”¨ `WaitGroup wg` æ¥ç¡®ä¿ `main` å‡½æ•°åœ¨å…¶ä»–åç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œï¿½ï¿½ï¿½ä¼šç»“æŸæ‰§è¡Œã€‚`WaitGroup` ä½œä¸ºå‚æ•°ä¼ é€’ç»™ `area` æ–¹æ³•åï¼Œåœ¨ç¬¬ 16 è¡Œã€ç¬¬ 21 è¡Œå’Œç¬¬ 26 è¡Œé€šçŸ¥ `main` å‡½æ•°ï¼Œè¡¨ç¤ºç°åœ¨åç¨‹å·²ç»å®Œæˆæ‰€æœ‰ä»»åŠ¡ã€‚**å¦‚æœä½ ä»”ç»†è§‚å¯Ÿï¼Œä¼šå‘ç° `wg.Done()` åªåœ¨ `area` å‡½æ•°è¿”å›çš„æ—¶å€™æ‰ä¼šè°ƒç”¨ã€‚`wg.Done()` åº”è¯¥åœ¨ `area` å°†è¦è¿”å›ä¹‹å‰è°ƒç”¨ï¼Œå¹¶ä¸”ä¸ä»£ç æµçš„è·¯å¾„ï¼ˆPathï¼‰æ— å…³ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åªè°ƒç”¨ä¸€æ¬¡ `defer`ï¼Œæ¥æœ‰æ•ˆåœ°æ›¿æ¢æ‰ `wg.Done()` çš„å¤šæ¬¡è°ƒç”¨**ã€‚ æˆ‘ä»¬æ¥ç”¨ `defer` æ¥é‡å†™ä¸Šé¢çš„ä»£ç ã€‚ åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ç§»é™¤äº†åŸå…ˆç¨‹åºä¸­çš„ 3 ä¸ª `wg.Done` çš„è°ƒç”¨ï¼Œè€Œæ˜¯ç”¨ä¸€ä¸ªå•ç‹¬çš„ `defer wg.Done()` æ¥å–ä»£å®ƒï¼ˆç¬¬ 14 è¡Œï¼‰ã€‚è¿™ä½¿å¾—æˆ‘ä»¬çš„ä»£ç æ›´åŠ ç®€æ´æ˜“æ‡‚ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>go package main import ( &quot;fmt&quot; &quot;sync&quot; ) type rect struct { length int width int } func (r rect) area(wg \\*sync.WaitGroup) { defer wg.Done() if r.length &lt; 0 { fmt.Printf(&quot;rect %v&#39;s length should be greater than zero\\\\n&quot;, r) return } if r.width &lt; 0 { fmt.Printf(&quot;rect %v&#39;s width should be greater than zero\\\\n&quot;, r) return } area := r.length \\* r.width fmt.Printf(&quot;rect %v&#39;s area %d\\\\n&quot;, r, area) } func main() { var wg sync.WaitGroup r1 := rect{-67, 89} r2 := rect{5, -67} r3 := rect{8, 9} rects := \\[\\]rect{r1, r2, r3} for \\_, v := range rects { wg.Add(1) go v.area(&amp;wg) } wg.Wait() fmt.Println(&quot;All go routines finished executing&quot;) }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>[åœ¨ playground ä¸Šè¿è¡Œ](<a href="https://play.golang.org/p/JuUvytLfBv" target="_blank" rel="noopener noreferrer">https://play.golang.org/p/JuUvytLfBv</a>) è¯¥ç¨‹åºä¼šè¾“å‡ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span> rect {8 9}&#39;s area 72 rect {-67 89}&#39;s length should be greater than zero rect {5 -67}&#39;s width should be greater than zero All go routines finished executing</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ç¨‹åºä¸­ï¼Œä½¿ç”¨ `defer` è¿˜æœ‰ä¸€ä¸ªå¥½å¤„ã€‚å‡è®¾æˆ‘ä»¬ä½¿ç”¨ `if` æ¡ä»¶è¯­å¥ï¼Œåˆç»™ `area` æ–¹æ³•æ·»åŠ äº†ä¸€æ¡è¿”å›è·¯å¾„ï¼ˆReturn Pathï¼‰ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨ `defer` æ¥è°ƒç”¨ `wg.Done()`ï¼Œæˆ‘ä»¬å°±å¾—å¾ˆå°å¿ƒäº†ï¼Œç¡®ä¿åœ¨è¿™æ¡æ–°æ·»çš„è¿”å›è·¯å¾„é‡Œè°ƒç”¨äº† `wg.Done()`ã€‚ç”±äºç°åœ¨æˆ‘ä»¬å»¶è¿Ÿè°ƒç”¨äº† `wg.Done()`ï¼Œå› æ­¤æ— éœ€å†ä¸ºè¿™æ¡æ–°çš„è¿”å›è·¯å¾„æ·»åŠ  `wg.Done()` äº†ã€‚ æœ¬æ•™ç¨‹åˆ°æ­¤ç»“æŸã€‚ç¥ä½ æ„‰å¿«ã€‚ **ä¸Šä¸€æ•™ç¨‹ - [å¤šæ€](<a href="https://studygolang.com/articles/12681" target="_blank" rel="noopener noreferrer">https://studygolang.com/articles/12681</a>)** **ä¸‹ä¸€æ•™ç¨‹ - [é”™è¯¯å¤„ç†](<a href="https://studygolang.com/articles/12724" target="_blank" rel="noopener noreferrer">https://studygolang.com/articles/12724</a>)**</p>',23)]))}const g=t(n,[["render",s],["__file","29-Defer.html.vue"]]),h=JSON.parse('{"path":"/golang/%E5%9F%BA%E7%A1%80/29-Defer.html","title":"Go ç³»åˆ—æ•™ç¨‹ â€”â€” 29. Defer","lang":"zh-CN","frontmatter":{"title":"Go ç³»åˆ—æ•™ç¨‹ â€”â€” 29. Defer","source_url":"https://studygolang.com/articles/12719","category":"Goç³»åˆ—æ•™ç¨‹","description":"æ¬¢è¿æ¥åˆ° [Golang ç³»åˆ—æ•™ç¨‹](https://studygolang.com/subject/2)çš„ç¬¬ 29 ç¯‡ã€‚ ## ä»€ä¹ˆæ˜¯ deferï¼Ÿ `defer` è¯­å¥çš„ç”¨é€”æ˜¯ï¼šå«æœ‰ `defer` è¯­å¥çš„å‡½æ•°ï¼Œä¼šåœ¨è¯¥å‡½æ•°å°†è¦è¿”å›ä¹‹å‰ï¼Œè°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå®šä¹‰å¯èƒ½çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç¤ºä¾‹å°±å¾ˆå®¹æ˜“æ˜ç™½äº†ã€‚ ## ç¤ºä¾‹ [åœ¨ playground...","head":[["meta",{"property":"og:url","content":"https://Cospk.github.io/vuepress-app/golang/%E5%9F%BA%E7%A1%80/29-Defer.html"}],["meta",{"property":"og:site_name","content":"Golangå…¨æ ˆæŒ‡å—"}],["meta",{"property":"og:title","content":"Go ç³»åˆ—æ•™ç¨‹ â€”â€” 29. Defer"}],["meta",{"property":"og:description","content":"æ¬¢è¿æ¥åˆ° [Golang ç³»åˆ—æ•™ç¨‹](https://studygolang.com/subject/2)çš„ç¬¬ 29 ç¯‡ã€‚ ## ä»€ä¹ˆæ˜¯ deferï¼Ÿ `defer` è¯­å¥çš„ç”¨é€”æ˜¯ï¼šå«æœ‰ `defer` è¯­å¥çš„å‡½æ•°ï¼Œä¼šåœ¨è¯¥å‡½æ•°å°†è¦è¿”å›ä¹‹å‰ï¼Œè°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå®šä¹‰å¯èƒ½çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç¤ºä¾‹å°±å¾ˆå®¹æ˜“æ˜ç™½äº†ã€‚ ## ç¤ºä¾‹ [åœ¨ playground..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-08-27T12:02:38.000Z"}],["meta",{"property":"article:modified_time","content":"2025-08-27T12:02:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Go ç³»åˆ—æ•™ç¨‹ â€”â€” 29. Defer\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-08-27T12:02:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Cospk\\",\\"url\\":\\"https://savvygo.cn\\"}]}"]]},"headers":[{"level":2,"title":"å®å‚å–å€¼ï¼ˆArguments Evaluationï¼‰ åœ¨ Go è¯­è¨€ä¸­ï¼Œå¹¶éåœ¨è°ƒç”¨å»¶è¿Ÿå‡½æ•°çš„æ—¶å€™æ‰ç¡®å®šå®å‚ï¼Œè€Œæ˜¯å½“æ‰§è¡Œ `defer` è¯­å¥çš„æ—¶å€™ï¼Œå°±ä¼šå¯¹å»¶è¿Ÿå‡½æ•°çš„å®å‚è¿›è¡Œæ±‚å€¼ã€‚ é€šè¿‡ä¸€ä¸ªä¾‹å­å°±èƒ½å¤Ÿç†è§£äº†ã€‚","slug":"å®å‚å–å€¼-arguments-evaluation-åœ¨-go-è¯­è¨€ä¸­-å¹¶éåœ¨è°ƒç”¨å»¶è¿Ÿå‡½æ•°çš„æ—¶å€™æ‰ç¡®å®šå®å‚-è€Œæ˜¯å½“æ‰§è¡Œ-defer-è¯­å¥çš„æ—¶å€™-å°±ä¼šå¯¹å»¶è¿Ÿå‡½æ•°çš„å®å‚è¿›è¡Œæ±‚å€¼ã€‚-é€šè¿‡ä¸€ä¸ªä¾‹å­å°±èƒ½å¤Ÿç†è§£äº†ã€‚","link":"#å®å‚å–å€¼-arguments-evaluation-åœ¨-go-è¯­è¨€ä¸­-å¹¶éåœ¨è°ƒç”¨å»¶è¿Ÿå‡½æ•°çš„æ—¶å€™æ‰ç¡®å®šå®å‚-è€Œæ˜¯å½“æ‰§è¡Œ-defer-è¯­å¥çš„æ—¶å€™-å°±ä¼šå¯¹å»¶è¿Ÿå‡½æ•°çš„å®å‚è¿›è¡Œæ±‚å€¼ã€‚-é€šè¿‡ä¸€ä¸ªä¾‹å­å°±èƒ½å¤Ÿç†è§£äº†ã€‚","children":[]},{"level":2,"title":"defer çš„å®é™…åº”ç”¨ ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„ä»£ç ç¤ºä¾‹ï¼Œéƒ½æ²¡æœ‰ä½“ç°å‡º `defer` çš„å®é™…ç”¨é€”ã€‚æœ¬èŠ‚æˆ‘ä»¬ä¼šçœ‹çœ‹ `defer` çš„å®é™…åº”ç”¨ã€‚ å½“ä¸€ä¸ªå‡½æ•°åº”è¯¥åœ¨ä¸å½“å‰ä»£ç æµï¼ˆCode Flowï¼‰æ— å…³çš„ç¯å¢ƒä¸‹è°ƒç”¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `defer`ã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç”¨åˆ°äº† [`WaitGroup`](https://studygolang.com/articles/12512) ä»£ç ç¤ºä¾‹æ¥ç†è§£è¿™å¥è¯çš„å«ä¹‰ã€‚æˆ‘ä»¬é¦–å…ˆä¼šå†™ä¸€ä¸ªæ²¡æœ‰ä½¿ç”¨ `defer` çš„ç¨‹åºï¼Œç„¶åæˆ‘ä»¬ä¼šç”¨ `defer` æ¥ä¿®æ”¹ï¼Œçœ‹åˆ° `defer` å¸¦æ¥çš„å¥½å¤„ã€‚","slug":"defer-çš„å®é™…åº”ç”¨-ç›®å‰ä¸ºæ­¢-æˆ‘ä»¬çœ‹åˆ°çš„ä»£ç ç¤ºä¾‹-éƒ½æ²¡æœ‰ä½“ç°å‡º-defer-çš„å®é™…ç”¨é€”ã€‚æœ¬èŠ‚æˆ‘ä»¬ä¼šçœ‹çœ‹-defer-çš„å®é™…åº”ç”¨ã€‚-å½“ä¸€ä¸ªå‡½æ•°åº”è¯¥åœ¨ä¸å½“å‰ä»£ç æµ-code-flow-æ— å…³çš„ç¯å¢ƒä¸‹è°ƒç”¨æ—¶-å¯ä»¥ä½¿ç”¨-defer-ã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç”¨åˆ°äº†-waitgroup-https-studygolang-com-articles-12512-ä»£ç ç¤ºä¾‹æ¥ç†è§£è¿™å¥è¯çš„å«ä¹‰ã€‚æˆ‘ä»¬é¦–å…ˆä¼šå†™ä¸€ä¸ªæ²¡æœ‰ä½¿ç”¨-defer-çš„ç¨‹åº-ç„¶åæˆ‘ä»¬ä¼šç”¨-defer-æ¥ä¿®æ”¹-çœ‹åˆ°-defer-å¸¦æ¥çš„å¥½å¤„ã€‚","link":"#defer-çš„å®é™…åº”ç”¨-ç›®å‰ä¸ºæ­¢-æˆ‘ä»¬çœ‹åˆ°çš„ä»£ç ç¤ºä¾‹-éƒ½æ²¡æœ‰ä½“ç°å‡º-defer-çš„å®é™…ç”¨é€”ã€‚æœ¬èŠ‚æˆ‘ä»¬ä¼šçœ‹çœ‹-defer-çš„å®é™…åº”ç”¨ã€‚-å½“ä¸€ä¸ªå‡½æ•°åº”è¯¥åœ¨ä¸å½“å‰ä»£ç æµ-code-flow-æ— å…³çš„ç¯å¢ƒä¸‹è°ƒç”¨æ—¶-å¯ä»¥ä½¿ç”¨-defer-ã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç”¨åˆ°äº†-waitgroup-https-studygolang-com-articles-12512-ä»£ç ç¤ºä¾‹æ¥ç†è§£è¿™å¥è¯çš„å«ä¹‰ã€‚æˆ‘ä»¬é¦–å…ˆä¼šå†™ä¸€ä¸ªæ²¡æœ‰ä½¿ç”¨-defer-çš„ç¨‹åº-ç„¶åæˆ‘ä»¬ä¼šç”¨-defer-æ¥ä¿®æ”¹-çœ‹åˆ°-defer-å¸¦æ¥çš„å¥½å¤„ã€‚","children":[]}],"git":{"createdTime":1756202807000,"updatedTime":1756296158000,"contributors":[{"name":"shiwei","username":"shiwei","email":"xie@gmail.com","commits":2,"url":"https://github.com/shiwei"}]},"readingTime":{"minutes":5.99,"words":1797},"filePathRelative":"golang/åŸºç¡€/29-Defer.md","localizedDate":"2025å¹´8æœˆ26æ—¥","autoDesc":true,"excerpt":"<p>æ¬¢è¿æ¥åˆ° [Golang ç³»åˆ—æ•™ç¨‹](<a href=\\"https://studygolang.com/subject/2\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://studygolang.com/subject/2</a>)çš„ç¬¬ 29 ç¯‡ã€‚ ## ä»€ä¹ˆæ˜¯ deferï¼Ÿ `defer` è¯­å¥çš„ç”¨é€”æ˜¯ï¼šå«æœ‰ `defer` è¯­å¥çš„å‡½æ•°ï¼Œä¼šåœ¨è¯¥å‡½æ•°å°†è¦è¿”å›ä¹‹å‰ï¼Œè°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå®šä¹‰å¯èƒ½çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç¤ºä¾‹å°±å¾ˆå®¹æ˜“æ˜ç™½äº†ã€‚ ## ç¤ºä¾‹</p>\\n<div class=\\"language- line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"\\" data-title=\\"\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span>go package main import ( \\"fmt\\" ) func finished() { fmt.Println(\\"Finished finding largest\\") } func largest(nums \\\\[\\\\]int) { defer finished() fmt.Println(\\"Started finding largest\\") max := nums\\\\[0\\\\] for \\\\_, v := range nums { if v &gt; max { max = v } } fmt.Println(\\"Largest number in\\", nums, \\"is\\", max) } func main() { nums := \\\\[\\\\]int{78, 109, 2, 563, 300} largest(nums) }</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div></div></div>"}');export{g as comp,h as data};
